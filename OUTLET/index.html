<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Outlet de mármol y granito de alta calidad. Amplia variedad en materiales, acabados y medidas para proyectos arquitectónicos y decorativos. Precios outlet especiales.">
    <meta name="keywords" content="mármol, granito, piedra natural, distribuidora, outlet, materiales construcción, acabados, encimeras, pisos, revestimientos, precios, ofertas">
    <meta name="author" content="Gallos Mármol">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Gallos Mármol - Outlet de Mármol y Granito 2025">
    <meta property="og:description" content="Outlet especial de mármoles y granitos con precios exclusivos. Calidad premium a precios outlet.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1544923246-773f2b38b0e3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80">
    <meta property="og:url" content="https://gallosmarmol.pe">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Gallos Mármol - Piedra Natural a Precios Outlet">
    <meta name="twitter:description" content="Outlet de mármol y granito para proyectos arquitectónicos y decorativos">
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1544923246-773f2b38b0e3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80">
    
    <link rel="icon" type="image/x-icon" href="FOTO/ICONO/Icono_01.ico">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3097/3097143.png">
    
    <title>Gallos Mármol - Outlet 2025</title>
    
    <!-- Preloads -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" as="style">
    
    <!-- Fuentes y estilos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Schema Markup para SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "HomeGoodsStore",
        "name": "Gallos Mármol",
        "description": "Outlet especializado en mármol y granito de alta calidad a precios exclusivos",
        "url": "https://gallosmarmol.pe",
        "address": {
            "@type": "PostalAddress",
            "addressCountry": "PE",
            "addressLocality": "Lima",
            "addressRegion": "Lima"
        },
        "openingHours": "Mo-Sa 08:00-18:00",
        "priceRange": "$$-$$$",
        "currenciesAccepted": "PEN"
    }
    </script>
    
    <style>
        /* ===== RESET Y BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            font-weight: 400;
            overflow-x: hidden;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* ===== VARIABLES CSS ===== */
        :root {
            /* Nueva paleta de colores */
            --primary-color: #6b0000;      /* Rojo vino */
            --primary-dark: #4a0000;
            --secondary-color: #584038;    /* Marrón */
            --secondary-dark: #3d2c25;
            --accent-color: #e8e4d2;       /* Beige claro */
            --accent-dark: #d1cdbb;
            --highlight-color: #6b0000;    /* Rojo vino */
            --highlight-dark: #4a0000;
            
            /* Colores para precios */
            --price-color: #e63946;
            --price-bg: rgba(230, 57, 70, 0.1);
            --discount-color: #2a9d8f;
            --discount-bg: rgba(42, 157, 143, 0.1);
            
            --dark-color: #2d3047;
            --dark-light: #3a3e5c;
            --light-color: #ffffff;
            --background-color: #f8f9fa;
            --gray-light: #f1f3f5;
            --gray-medium: #dee2e6;
            --gray-dark: #868e96;
            --text-color: #343a40;
            --text-light: #6c757d;
            --success-color: #40c057;
            --warning-color: #fab005;
            --error-color: #fa5252;
            
            /* Sombras */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 12px 32px rgba(0, 0, 0, 0.15);
            
            /* Bordes redondeados */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-full: 50%;
            
            /* Transiciones */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            
            /* Layout */
            --header-height: 80px;
            --mobile-menu-height: 65px;
            --container-padding: clamp(16px, 4vw, 24px);
        }
        
        /* ===== MODO OSCURO ===== */
        body.dark-mode {
            --primary-color: #8b0000;
            --primary-dark: #6b0000;
            --secondary-color: #6d5b43;
            --secondary-dark: #584038;
            --accent-color: #d1cdbb;
            --accent-dark: #b8b4a0;
            --highlight-color: #8b0000;
            --highlight-dark: #6b0000;
            
            --price-color: #ff6b6b;
            --price-bg: rgba(255, 107, 107, 0.15);
            --discount-color: #4ecdc4;
            --discount-bg: rgba(78, 205, 196, 0.15);
            
            --dark-color: #ffffff;
            --dark-light: #f0f0f0;
            --light-color: #1a1d20;
            --background-color: #121212;
            --gray-light: #2a2d32;
            --gray-medium: #3a3f45;
            --gray-dark: #6a6f76;
            --text-color: #e9ecef;
            --text-light: #adb5bd;
            
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 12px 32px rgba(0, 0, 0, 0.6);
        }
        
        /* ===== ACCESIBILIDAD ===== */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        :focus-visible {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
            border-radius: var(--radius-sm);
        }
        
        /* ===== TIPOGRAFÍA ===== */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', 'Inter', sans-serif;
            font-weight: 600;
            line-height: 1.3;
        }
        
        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.25rem; }
        
        p {
            margin-bottom: 1rem;
        }
        
        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        
        a:hover, a:focus {
            color: var(--primary-dark);
        }
        
        /* ===== LAYOUT ===== */
        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 var(--container-padding);
        }
        
        /* ===== HEADER ===== */
        header {
            background-color: var(--background-color);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
            height: var(--header-height);
            display: flex;
            align-items: center;
            border-bottom: 3px solid var(--primary-color);
            transition: all var(--transition-normal);
        }
        
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            gap: 16px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 16px;
            min-width: 0;
            flex-shrink: 0;
        }
        
        .logo-image {
            height: 60px;
            width: auto;
            object-fit: contain;
            border-radius: var(--radius-sm);
        }
        
        .logo-text h1 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1.2;
            margin-bottom: 4px;
        }
        
        .logo-text span {
            display: block;
            font-size: 0.8rem;
            color: var(--secondary-color);
            font-weight: 500;
        }
        
        /* ===== BÚSQUEDA ===== */
        .search-section {
            flex: 1;
            max-width: 600px;
            margin: 0 20px;
            position: relative;
        }
        
        .search-container {
            position: relative;
            width: 100%;
        }
        
        .search-input {
            width: 100%;
            padding: 16px 24px 16px 52px;
            border: 2px solid var(--gray-medium);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            background-color: var(--light-color);
            color: var(--text-color);
            transition: all var(--transition-normal);
            font-family: 'Inter', sans-serif;
            box-shadow: var(--shadow-sm);
        }
        
        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(107, 0, 0, 0.15);
            outline: none;
        }
        
        .search-input::placeholder {
            color: var(--gray-dark);
            font-weight: 400;
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: 1.1rem;
            pointer-events: none;
        }
        
        .search-results {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background-color: var(--light-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            border: 1px solid var(--gray-medium);
        }
        
        .search-results.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .search-result-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: background-color var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .search-result-item:hover,
        .search-result-item:focus {
            background-color: var(--gray-light);
        }
        
        .search-result-item img {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
            background-color: var(--gray-light);
        }
        
        .search-result-info h4 {
            font-size: 0.95rem;
            margin-bottom: 4px;
            color: var(--dark-color);
        }
        
        .search-result-info p {
            font-size: 0.85rem;
            color: var(--text-light);
            margin: 0;
        }
        
        .search-result-code {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .no-results {
            padding: 20px;
            text-align: center;
            color: var(--text-light);
        }
        
        /* ===== ACCIONES HEADER ===== */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }
        
        .header-icon {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            box-shadow: var(--shadow-sm);
            border: none;
        }
        
        .header-icon:hover,
        .header-icon:focus {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .header-icon.whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
        }
        
        .header-icon-text {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--highlight-color);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            min-width: 20px;
            height: 20px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
        }
        
        .theme-toggle {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            width: 44px;
            height: 44px;
            border-radius: var(--radius-full);
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-fast);
        }
        
        .theme-toggle:hover,
        .theme-toggle:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Animaciones para actualización del modal */
        .producto-seleccionado-item {
            transition: all 0.3s ease;
            animation: slideInItem 0.3s ease;
        }

        @keyframes slideInItem {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Animación al eliminar */
        .producto-seleccionado-item.removing {
            animation: slideOutItem 0.3s ease forwards;
        }

        @keyframes slideOutItem {
            to {
                opacity: 0;
                transform: translateX(10px);
                height: 0;
                padding: 0;
                margin: 0;
                border: none;
            }
        }        

        /* ===== BOTÓN WHATSAPP FLOTANTE ===== */
        .whatsapp-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px; 
            height: 70px; 
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            border-radius: var(--radius-full);
            text-align: center;
            font-size: 34px; /* Aumentado de 30px */
            box-shadow: var(--shadow-lg);
            z-index: 999;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            animation: pulse 2s infinite;
        }
        
        .whatsapp-float:hover,
        .whatsapp-float:focus {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }
        
        .whatsapp-float-count {
            position: absolute;
            top: -10px; /* Ajustado */
            right: -10px; /* Ajustado */
            background-color: var(--primary-color);
            color: white;
            font-size: 0.9rem; /* Aumentado */
            min-width: 26px; /* Aumentado */
            height: 26px; /* Aumentado */
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(37, 211, 102, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0);
            }
        }
        
        /* ===== HERO SECTION ===== */
        .hero {
            background: linear-gradient(135deg, 
                rgba(107, 0, 0, 0.85) 0%, 
                rgba(88, 64, 56, 0.85) 100%),
                url('FOTO/OTROS/Foto_1.webp');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            /* ⬇️ AJUSTAR PADDING (reducir si es necesario) ⬇️ */
            padding: 80px 0; /* Cambiado de 100px 0 */
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            border-radius: 0 0 40px 40px;
            box-shadow: var(--shadow-xl);
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }
        
        .hero h2 {
            font-size: clamp(2.2rem, 6vw, 3.5rem);
            color: white;
            margin-bottom: 25px;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            line-height: 1.2;
            animation: fadeInUp 1s ease-out;
        }
        
        .hero p {
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            opacity: 0.95;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            animation: fadeInUp 1s ease-out 0.3s both;
        }
                
        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            /* ⬇️ CAMBIAR DE 0.9s a 0.6s (más rápido) ⬇️ */
            animation: fadeInUp 1s ease-out 0.6s both;
            margin-top: 40px; /* ⬅️ Añadir margen superior para separar del texto */
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 32px;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-normal);
            border: none;
            text-decoration: none;
            min-height: 56px;
        }
        
        .btn-primary {
            background: var(--accent-color);
            box-shadow: var(--shadow-md);       
        }
        
        .btn-primary:hover,
        .btn-primary:focus {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(107, 0, 0, 0.4);
        }
        
        /* ===== BARRA DE FILTROS FIJOS ===== */
        .barra-filtros-fija {
            position: sticky;
            top: var(--header-height);
            background-color: var(--accent-color);
            z-index: 900;
            padding: 15px 0;
            box-shadow: var(--shadow-md);
            border-bottom: 1px solid var(--gray-light);
            backdrop-filter: blur(10px);
            background-color: rgba(232, 228, 210, 0.95);
            margin-bottom: 20px;
        }
        
        body.dark-mode .barra-filtros-fija {
            background-color: rgba(30, 30, 30, 0.95);
        }
        
        .filtros-horizontal {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) var(--gray-light);
        }
        
        .filtros-horizontal::-webkit-scrollbar {
            height: 4px;
        }
        
        .filtros-horizontal::-webkit-scrollbar-track {
            background: var(--gray-light);
            border-radius: 2px;
        }
        
        .filtros-horizontal::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 2px;
        }
        
        .btn-filtro-grupo {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--light-color);
            border: 2px solid var(--primary-color);
            border-radius: var(--radius-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            color: var(--text-color);
        }
        
        .btn-filtro-grupo:hover,
        .btn-filtro-grupo:focus {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .btn-filtro-grupo.activo {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: var(--primary-color);
        }
        
        /* ===== FILTROS OPCIONES ===== */
        .filtros-opciones-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--light-color);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 20px;
            display: none;
            z-index: 999;
            border-top: 2px solid var(--primary-color);
            max-height: 400px;
            overflow-y: auto;
        }
        
        .filtros-opciones-container.visible {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .filtro-opcion {
            margin-bottom: 20px;
        }
        
        .filtro-opcion h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--dark-color);
            font-size: 1rem;
        }
        
        .filtro-opciones {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .filtro-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            background: var(--gray-light);
            cursor: pointer;
            transition: background var(--transition-fast);
        }
        
        .filtro-checkbox:hover {
            background: var(--gray-medium);
        }
        
        .filtro-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
        }
        
        .filtros-acciones {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-light);
        }
                
        /* ===== FILTROS MÓVIL MEJORADO ===== */
        .filtros-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .filtros-overlay.activo {
            display: flex;
            opacity: 1;
            align-items: center;
            justify-content: center;
        }
        
        .filtros-contenedor-movil {
            width: 95%;
            max-width: 500px;
            height: 85vh;
            background: var(--light-color);
            border-radius: var(--radius-lg);
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            display: flex;
            flex-direction: column;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .filtros-overlay.activo .filtros-contenedor-movil {
            transform: translateY(0);
            opacity: 1;
        }
        
        .filtros-header-movil {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .filtros-content-movil {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .filter-group-mobile {
            background: var(--gray-light);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
        }
        
        .filter-group-mobile h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--dark-color);
            font-size: 1.1rem;
        }
        
        .filter-options-mobile {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .filter-option-mobile {
            padding: 10px 16px;
            border-radius: var(--radius-full);
            background: var(--light-color);
            cursor: pointer;
            border: 2px solid var(--gray-medium);
            transition: all var(--transition-fast);
            font-size: 0.9rem;
            white-space: nowrap;
            color: var(--text-color);
        }
        
        .filter-option-mobile:hover,
        .filter-option-mobile:focus {
            transform: scale(1.05);
            border-color: var(--primary-color);
        }
        
        .filter-option-mobile.selected {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: var(--primary-color);
        }
        
        .filter-option-mobile input[type="checkbox"] {
            display: none;
        }
        
        .filtros-footer-movil {
            padding: 20px;
            border-top: 1px solid var(--gray-light);
            background: var(--gray-light);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }
        
        .filtros-acciones-movil {
            display: flex;
            gap: 15px;
        }
        
        .btn-filtros-flotante {
            position: fixed;
            bottom: 160px; /* Cambiado de 90px para separarlo */
            right: 30px; /* Mantener derecha */
            width: 70px; /* Aumentado de 60px */
            height: 70px; /* Aumentado de 60px */
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 28px; /* Aumentado de 24px */
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-filtros-flotante:hover,
        .btn-filtros-flotante:focus {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }
        
        .btn-filtros-flotante .contador {
            position: absolute;
            top: -8px; /* Ajustado */
            right: -8px; /* Ajustado */
            background: var(--highlight-color);
            color: white;
            font-size: 0.85rem; /* Aumentado */
            min-width: 24px; /* Aumentado */
            height: 24px; /* Aumentado */
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }
     
        /* Asegurar que el modal siempre muestre el inicio */
        .detalle-producto-contenido {
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            /* ⬇️ AÑADIR ESTO ⬇️ */
            scroll-behavior: auto !important;
            overscroll-behavior: contain;
        }

        /* Forzar que el scroll esté al inicio cuando se muestra */
        .modal.activo .detalle-producto-contenido {
            animation: scrollToTop 0.1s ease forwards;
        }

        @keyframes scrollToTop {
            from {
                scroll-top: var(--current-scroll, 0);
            }
            to {
                scroll-top: 0;
            }
        }        

        /* ===== PRODUCTOS ===== */
        .products-section {
            margin: 40px 0;
        }
        
        .section-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-light);
        }
        
        .section-title {
            font-size: 1.8rem;
            color: var(--dark-color);
            position: relative;
            padding-bottom: 10px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .products-stats {
            color: var(--text-light);
            font-size: 0.95rem;
        }
        
        /* ===== PRECIOS ===== */
        .product-price-container {
            margin: 15px 0;
            padding: 15px;
            background: var(--price-bg);
            border-radius: var(--radius-md);
            border: 2px solid var(--price-color);
            text-align: center;
        }
        
        .product-price {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--price-color);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: -0.5px;
        }
        
        .product-price-unit {
            font-size: 1rem;
            color: var(--text-color);
            margin-top: 5px;
            font-weight: 600;
        }
        
        .product-price-consult {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
            background: rgba(107, 0, 0, 0.1);
            padding: 12px;
            border-radius: var(--radius-md);
            border: 2px dashed var(--primary-color);
        }
        
        .price-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--discount-color), var(--primary-color));
            color: white;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 700;
            margin-top: 8px;
            letter-spacing: 0.5px;
        }
        
        /* ===== SKELETON LOADING ===== */
        .skeleton {
            background: linear-gradient(90deg, var(--gray-light) 25%, var(--gray-medium) 50%, var(--gray-light) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
        }
        
        .skeleton-card {
            background-color: var(--gray-light);
            border-radius: var(--radius-md);
            overflow: hidden;
            height: 500px;
        }
        
        .skeleton-image {
            height: 250px;
            background-color: var(--gray-medium);
        }
        
        .skeleton-content {
            padding: 20px;
        }
        
        .skeleton-title {
            height: 24px;
            background-color: var(--gray-medium);
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
            width: 80%;
        }
        
        .skeleton-text {
            height: 16px;
            background-color: var(--gray-medium);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            width: 100%;
        }
        
        .skeleton-text:last-child {
            width: 60%;
        }
        
        /* ===== PRODUCTOS GRID ===== */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }
        
        .product-card {
            background-color: var(--light-color);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
            border: 1px solid var(--gray-light);
        }
        
        .product-card:hover,
        .product-card:focus-within {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }
        
        .product-badge {
            position: absolute;
            top: 16px;
            left: 16px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }
        
        .product-badge.nuevo {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }
        
        .product-badge.oferta {
            background: linear-gradient(135deg, var(--discount-color), var(--primary-color));
        }
        
        .product-badge.disponible {
            background: linear-gradient(135deg, var(--success-color), #2b8a3e);
        }
        
        .product-badge.agotado {
            background: linear-gradient(135deg, var(--error-color), #c92a2a);
        }
        
        .product-image-container {
            position: relative;
            overflow: hidden;
            background: var(--gray-light);
            min-height: 250px;
        }
        
        .product-image {
            width: 100%;
            height: 100%;
            min-height: 250px;
            object-fit: contain;
            transition: transform var(--transition-slow);
            background-color: var(--gray-light);
        }
        
        .product-card:hover .product-image {
            transform: scale(1.05);
        }
        
        .product-wishlist {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 40px;
            height: 40px;
            background-color: var(--light-color);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text-light);
            cursor: pointer;
            transition: all var(--transition-fast);
            z-index: 2;
            border: none;
            box-shadow: var(--shadow-sm);
        }
        
        .product-wishlist:hover,
        .product-wishlist:focus {
            color: var(--primary-color);
            background-color: rgba(107, 0, 0, 0.1);
            transform: scale(1.1);
        }
        
        .product-wishlist.activo {
            color: var(--primary-color);
        }
        
        .product-info {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .product-code {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary-color);
            background-color: rgba(107, 0, 0, 0.1);
            padding: 4px 10px;
            border-radius: 50px;
            margin-bottom: 12px;
            align-self: flex-start;
            letter-spacing: 0.5px;
        }
        
        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark-color);
            line-height: 1.4;
            flex-grow: 1;
        }
        
        .product-details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 16px;
            font-size: 0.85rem;
        }
        
        .product-detail-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .product-detail-label {
            color: var(--text-light);
            font-weight: 500;
            font-size: 0.75rem;
        }
        
        .product-detail-value {
            color: var(--text-color);
            font-weight: 600;
        }
        
        .product-unidad {
            color: var(--text-light);
            font-size: 0.8rem;
            margin-top: 4px;
        }
        
        .product-colors {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        .product-color-dot {
            width: 20px;
            height: 20px;
            border-radius: var(--radius-full);
            border: 2px solid var(--light-color);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: transform var(--transition-fast);
        }
        
        .product-color-dot:hover {
            transform: scale(1.2);
        }
        
        .product-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: auto;
        }
        
        .product-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .product-btn.asesor {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }
        
        .product-btn.asesor:hover:not(:disabled),
        .product-btn.asesor:focus:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .product-btn.asesor:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .product-btn.view {
            background: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
            color: white;
        }
        
        .product-btn.view:hover,
        .product-btn.view:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        /* ===== PAGINACIÓN ===== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        .page-btn {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-medium);
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-weight: 500;
            color: var(--text-color);
            border: none;
        }
        
        .page-btn:hover,
        .page-btn:focus,
        .page-btn.active {
            background: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
            color: white;
            border-color: var(--secondary-color);
        }
        
        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        /* ===== MODALES ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.activo {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: var(--light-color);
            border-radius: var(--radius-lg);
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.3s ease;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-light);
        }
        
        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--dark-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--gray-dark);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }
        
        .modal-close:hover,
        .modal-close:focus {
            background-color: var(--gray-light);
            color: var(--dark-color);
        }
      
        .seleccion-acciones{
            text-align: center;
        }        

        /* ===== MODAL PRODUCTOS SELECCIONADOS ===== */
        .productos-seleccionados-container {
            max-width: 600px;
        }
        
        .productos-seleccionados-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-md);
            padding: 10px;
        }
        
        .producto-seleccionado-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--gray-light);
            transition: all var(--transition-fast);
        }
        
        .producto-seleccionado-item:hover {
            background-color: var(--gray-light);
        }
        
        .producto-seleccionado-item:last-child {
            border-bottom: none;
        }
        
        .producto-seleccionado-item img {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-sm);
            object-fit: cover;
            background-color: var(--gray-light);
        }
        
        .producto-seleccionado-info {
            flex: 1;
        }
        
        .producto-seleccionado-info h5 {
            font-size: 0.9rem;
            margin-bottom: 4px;
            color: var(--dark-color);
        }
        
        .producto-seleccionado-info p {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 4px;
        }
        
        .producto-seleccionado-price {
            font-weight: 600;
            color: var(--price-color);
            font-size: 0.85rem;
        }
        
        .producto-seleccionado-remover {
            background: none;
            border: none;
            color: var(--error-color);
            cursor: pointer;
            padding: 5px;
            border-radius: var(--radius-full);
            transition: background 0.2s;
        }
        
        .producto-seleccionado-remover:hover,
        .producto-seleccionado-remover:focus {
            background: rgba(250, 82, 82, 0.1);
        }
        
        .productos-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--gray-light);
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .productos-total .total {
            font-size: 1.2rem;
            color: var(--primary-color);
        }
        
        /* ===== MODAL SELECCIÓN ASESOR ===== */
        .asesor-seleccion-container {
            max-width: 500px;
        }
        
        .asesor-seleccion-titulo {
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: var(--dark-color);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .cliente-tipo-seleccion {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--gray-light);
            border-radius: var(--radius-md);
        }
        
        .cliente-tipo-seleccion h4 {
            margin-bottom: 15px;
            font-size: 1rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cliente-opciones {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .cliente-opcion {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--light-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid transparent;
        }
        
        .cliente-opcion:hover,
        .cliente-opcion:focus {
            border-color: var(--primary-color);
            background: rgba(107, 0, 0, 0.05);
        }
        
        .cliente-opcion input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
        }
        
        .cliente-opcion .opcion-info h5 {
            font-size: 0.9rem;
            margin-bottom: 4px;
            color: var(--dark-color);
        }
        
        .cliente-opcion .opcion-info p {
            font-size: 0.8rem;
            color: var(--text-light);
            margin: 0;
        }
        
        /* ===== MODAL ASESORES ===== */
        .asesor-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            transition: all var(--transition-fast);
            cursor: pointer;
        }
        
        .asesor-card:hover,
        .asesor-card:focus {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .asesor-card.selected {
            border-color: var(--primary-color);
            background: rgba(107, 0, 0, 0.05);
        }
        
        .asesor-avatar {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-full);
            object-fit: cover;
            border: 3px solid var(--primary-color);
            background-color: var(--gray-light);
        }
        
        .asesor-info {
            flex: 1;
        }
        
        .asesor-info h4 {
            margin-bottom: 4px;
            font-size: 1.1rem;
            color: var(--dark-color);
        }
        
        .asesor-info p {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-whatsapp:hover,
        .btn-whatsapp:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        /* ===== MODAL COMPARTIR PRODUCTO ===== */
        .compartir-modal-content {
            max-width: 450px;
            text-align: center;
        }
        
        .compartir-opciones {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .compartir-opcion {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            background: var(--light-color);
        }
        
        .compartir-opcion:hover,
        .compartir-opcion:focus {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        
        .compartir-opcion i {
            font-size: 2rem;
            color: var(--primary-color);
        }
        
        .compartir-opcion span {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .compartir-url-container {
            margin: 20px 0;
        }
        
        .compartir-url {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .compartir-url input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--gray-medium);
            border-radius: var(--radius-md);
            background: var(--light-color);
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
        }
        
        .compartir-url input:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .compartir-url button {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: all var(--transition-fast);
        }
        
        .compartir-url button:hover,
        .compartir-url button:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        
        /* ===== MODAL FAVORITOS ===== */
        .favoritos-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .favorito-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border-bottom: 1px solid var(--gray-light);
            transition: all 0.2s ease;
        }
        
        .favorito-item:hover,
        .favorito-item:focus {
            background: var(--gray-light);
        }
        
        .favorito-item:last-child {
            border-bottom: none;
        }
        
        .favorito-item img {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-sm);
            object-fit: cover;
            background-color: var(--gray-light);
        }
        
        .favorito-info {
            flex: 1;
        }
        
        .favorito-info h4 {
            font-size: 1rem;
            margin-bottom: 4px;
            color: var(--dark-color);
        }
        
        .favorito-info p {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .favorito-code {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.85rem;
        }
        
        .favorito-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .favorito-btn {
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .favorito-btn.consultar {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }
        
        .favorito-btn.consultar:hover,
        .favorito-btn.consultar:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        
        .favorito-remove {
            background: var(--gray-light);
            color: var(--text-color);
        }
        
        .favorito-remove:hover,
        .favorito-remove:focus {
            background: var(--gray-medium);
            transform: translateY(-2px);
        }
        
        /* ===== MODAL DETALLE PRODUCTO ===== */
        .detalle-producto-contenido {
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .detalle-producto-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            border-bottom: 2px solid var(--gray-light);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .detalle-producto-header h3 {
            font-size: 1.5rem;
            color: white;
        }
        
        .detalle-producto-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .producto-slider {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-md);
            background: var(--gray-light);
        }
        
        .slider-container {
            position: relative;
            height: 400px;
            overflow: hidden;
        }
        
        .slider-track {
            display: flex;
            transition: transform 0.5s ease;
            height: 100%;
        }
        
        .slider-slide {
            min-width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .slider-slide img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .slider-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.8);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            color: var(--text-color);
        }
        
        .slider-btn:hover,
        .slider-btn:focus {
            background: var(--light-color);
            transform: translateY(-50%) scale(1.1);
        }
        
        .slider-prev {
            left: 15px;
        }
        
        .slider-next {
            right: 15px;
        }
        
        .slider-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 15px;
            background: var(--gray-light);
        }
        
        .slider-dot {
            width: 10px;
            height: 10px;
            border-radius: var(--radius-full);
            background: var(--gray-medium);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .slider-dot.active {
            background: var(--primary-color);
            transform: scale(1.3);
        }
        
        .producto-detalle-info {
            padding: 10px;
        }
        
        .producto-detalle-code {
            display: inline-block;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-color);
            background-color: rgba(107, 0, 0, 0.1);
            padding: 6px 12px;
            border-radius: var(--radius-full);
            margin-bottom: 15px;
            letter-spacing: 0.5px;
        }
        
        .producto-detalle-titulo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 15px;
            line-height: 1.3;
        }
        
        /* PRECIO EN DETALLE */
        .detalle-price-container {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, rgba(230, 57, 70, 0.1), rgba(107, 0, 0, 0.1));
            border-radius: var(--radius-lg);
            border: 3px solid var(--price-color);
            text-align: center;
            animation: pulsePrice 2s infinite;
        }
        
        @keyframes pulsePrice {
            0% {
                box-shadow: 0 0 0 0 rgba(230, 57, 70, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(230, 57, 70, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(230, 57, 70, 0);
            }
        }
        
        .detalle-price {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--price-color);
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .detalle-price-unit {
            font-size: 1.2rem;
            color: var(--text-color);
            font-weight: 700;
        }
        
        .detalle-price-consult {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary-color);
            background: linear-gradient(135deg, rgba(107, 0, 0, 0.1), rgba(88, 64, 56, 0.1));
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 3px dashed var(--primary-color);
        }
        
        .producto-detalle-descripcion {
            font-size: 1rem;
            color: var(--text-color);
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .producto-detalle-especificaciones {
            background: var(--gray-light);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .especificacion-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .especificacion-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .especificacion-label {
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 500;
        }
        
        .especificacion-valor {
            font-size: 1rem;
            color: var(--text-color);
            font-weight: 600;
        }
        
        .detalle-acciones {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }
        
        /* ===== BOTÓN VOLVER ARRIBA ===== */
        .btn-volver-arriba {
            position: fixed;
            bottom: 110px; 
            right: 30px; 
            width: 70px; 
            height: 70px; 
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 28px; /* Aumentado de 24px */
            cursor: pointer;
            transition: all 0.3s ease;
        }

        
        .btn-volver-arriba.visible {
            display: flex;
        }
        
        .btn-volver-arriba:hover,
        .btn-volver-arriba:focus {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }
        
        /* ===== MENÚ MÓVIL ===== */
        .mobile-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--accent-color);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            height: var(--mobile-menu-height);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            backdrop-filter: blur(10px);
            background-color: rgba(232, 228, 210, 0.97);
            border-top: 2px solid var(--primary-color);
        }
        
        body.dark-mode .mobile-menu {
            background-color: rgba(30, 30, 30, 0.97);
        }
        
        .mobile-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 12px 8px;
            border-radius: var(--radius-md);
            text-decoration: none;
            color: var(--text-color);
            transition: all var(--transition-fast);
            flex: 1;
            max-width: 80px;
            min-height: 56px;
            position: relative;
            /* ⬇️ AÑADIR ESTAS PROPIEDADES ⬇️ */
            background: transparent !important; /* Fondo transparente */
            border: none !important; /* Sin borde */
            cursor: pointer; /* Cursor de puntero */
            font-family: inherit; /* Heredar fuente */
            font-size: inherit; /* Heredar tamaño de fuente */
        }
       
        /* Para los enlaces <a> también asegurar fondo transparente */
        .mobile-menu-item[href] {
            background: transparent;
            border: none;
        }        

        .mobile-menu-item.active,
        .mobile-menu-item:focus {
        color: var(--primary-color);
        background-color: rgba(107, 0, 0, 0.1) !important;
        }
        
        .mobile-menu-item i {
            font-size: 1.3rem;
        }
        
        .mobile-menu-item span {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .mobile-menu-badge {
            position: absolute;
            top: 8px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            font-size: 0.7rem;
            min-width: 18px;
            height: 18px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }
        
        /* ===== ESTADOS VACÍOS ===== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }
        
        .empty-state i {
            font-size: 3rem;
            color: var(--gray-medium);
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--text-light);
        }
        
        .empty-state p {
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 16px 24px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideUp 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
            max-width: 90%;
        }
        
        /* ===== ANIMACIONES ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeOut {
            to { 
                opacity: 0; 
                transform: translateX(-50%) translateY(20px); 
            }
        }
        
        @keyframes skeleton-loading {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            body {
                padding-bottom: var(--mobile-menu-height);
            }
            
            .mobile-menu {
                display: flex;
            }
            
            .search-section {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background-color: var(--accent-color);
                padding: 15px;
                box-shadow: var(--shadow-lg);
                z-index: 999;
                margin: 0;
                max-width: none;
                transform: translateY(-100%);
                transition: transform 0.3s ease;
            }
            
            .search-section.active {
                display: block;
                transform: translateY(0);
            }
            
            .header-actions {
                gap: 8px;
            }
            
            .theme-toggle {
                display: flex !important;
            }
            
            /* OCULTAR botón de favoritos en móvil */
            .header-icon:not(.theme-toggle) {
                display: none !important;
            }
            
            .header-icon.whatsapp {
                display: none;
            }
            
            
            .hero {
            padding: 50px 0; 
            border-radius: 0 0 30px 30px;

            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .hero-stats {
                flex-direction: column;
                gap: 20px;
                margin-top: 30px;
            }
            
            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .whatsapp-float {
                display: flex;
                bottom: 100px; /* Bajado para no tapar menú móvil */
                right: 20px;
                width: 65px; /* Un poco más grande en móvil */
                height: 65px;
                font-size: 32px;
            }
            
            .whatsapp-float-count {
                font-size: 0.85rem;
                min-width: 24px;
                height: 24px;
                top: -8px;
                right: -8px;
            }
            
            .btn-filtros-flotante {
                display: flex;
                bottom: 180px; /* Separado del WhatsApp */
                right: 20px;
                width: 65px;
                height: 65px;
                font-size: 26px;
            }

            .btn-filtros-flotante .contador {
                font-size: 0.8rem;
                min-width: 22px;
                height: 22px;
                top: -6px;
                right: -6px;
            }            
            
            .barra-filtros-fija {
                display: none;
            }
            
            .detalle-producto-body {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .slider-container {
                height: 300px;
            }
            
            .product-details-grid {
                grid-template-columns: 1fr;
            }
            
            .especificacion-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-volver-arriba {
                left: auto; /* Eliminar left */
                right: 20px; /* Mover a la derecha */
                bottom: 260px; /* Encima de los otros dos botones */
                width: 65px;
                height: 65px;
                font-size: 26px;
            }
            
            .filtros-chips-container {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .compartir-opciones {
                grid-template-columns: 1fr;
            }
            
            .product-price {
                font-size: 1.5rem;
            }
            
            .detalle-price {
                font-size: 2rem;
            }
        }
        
        @media (min-width: 769px) {
            body {
                padding-bottom: 0;
            }
            
            .mobile-menu {
                display: none;
            }
            
            .header-actions {
                display: flex;
            }
            
            .header-icon.whatsapp {
                display: none !important;
            }
            
            .whatsapp-float {
                display: flex;
                bottom: 40px;
                right: 40px;
                width: 75px; /* Aún más grande en escritorio */
                height: 75px;
                font-size: 36px;                
            }

            .whatsapp-float-count {
                top: -12px;
                right: -12px;
                min-width: 28px;
                height: 28px;
                font-size: 1rem;
            }            
            
            .btn-filtros-flotante {
                display: none;
                bottom: 130px; /* Separado del WhatsApp */
                right: 40px;
                width: 70px;
                height: 70px;                
            }
            
            .btn-volver-arriba {
                bottom: 220px; /* Encima del botón de filtros */
                right: 40px;
                width: 70px;
                height: 70px;
            }
            
            .theme-toggle {
                display: flex;
            }
        }
        
        @media (min-width: 1024px) {
            .products-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .whatsapp-float {
                bottom: 40px;
                right: 40px;
            }
        }
        
        @media (min-width: 1280px) {
            .products-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header role="banner">
        <div class="container header-container">
            <div class="logo-container">
                <img src="FOTO/LOGO/Logo_01.webp" 
                     alt="Logo Gallos Mármol - Outlet de mármol y granito" 
                     class="logo-image"
                     height="60"
                     loading="eager"
                     onerror="this.src='https://via.placeholder.com/150x60/6b0000/ffffff?text=Gallos+Mármol'"
                >
            </div>
            
            <!-- Búsqueda -->
            <div class="search-section" id="search-section">
                <div class="search-container">
                    <label for="search-input" class="sr-only">Buscar productos de mármol y granito</label>
                    <input type="text" 
                           class="search-input" 
                           id="search-input" 
                           placeholder="Buscar por código, material, acabado..." 
                           aria-label="Buscar productos en Gallos Mármol"
                           aria-describedby="search-hint">
                    <i class="fas fa-search search-icon" aria-hidden="true"></i>
                    <span id="search-hint" class="sr-only">Presiona Enter para buscar o usa las flechas para navegar resultados</span>
                </div>
                <div class="search-results" id="search-results" role="region" aria-live="polite" aria-label="Resultados de búsqueda">
                    <!-- Resultados dinámicos -->
                </div>
            </div>
            
            <div class="header-actions">
                <!-- Botón de modo oscuro -->
                <button class="theme-toggle" id="theme-toggle" aria-label="Cambiar tema claro/oscuro" aria-pressed="false">
                    <i class="fas fa-moon"></i>
                </button>
                               
                <!-- Favoritos (OCULTAR en móvil) -->
                <button class="header-icon" id="header-favoritos" aria-label="Ver favoritos" aria-describedby="favoritos-count">
                    <i class="fas fa-heart"></i>
                    <span class="header-icon-text" id="favoritos-count" aria-hidden="true">0</span>
                    <span class="sr-only">0 productos en favoritos</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Botón WhatsApp flotante -->
    <button class="whatsapp-float" id="whatsapp-float" aria-label="Contactar asesor de ventas">
        <i class="fab fa-whatsapp"></i>
        <span class="whatsapp-float-count" id="whatsapp-count">0</span>
    </button>

    <!-- Hero section -->
    <section class="hero" aria-labelledby="hero-title">
        <div class="hero-content">
            <h2 id="hero-title">Outlet de Mármol 2025</h2>
            <p>Accede a nuestra selección especial de mármoles con precios outlet exclusivos por tiempo limitado. Calidad premium a precios increíbles.</p>
            <div class="cta-buttons">
                <a href="#products" class="btn btn-primary" aria-label="Ver catálogo completo de mármoles y granitos">
                    <i class="fas fa-gem"></i> Explorar Outlet
                </a>
            </div>
        </div>
    </section>

    <!-- Barra de filtros fija -->
    <nav class="barra-filtros-fija" id="barra-filtros" aria-label="Filtros de productos">
        <div class="container">
            <div class="filtros-horizontal">
                <button class="btn-filtro-grupo" data-target="familia" aria-expanded="false" aria-controls="filtros-opciones">
                    <i class="fas fa-layer-group"></i> Familia
                </button>
                <button class="btn-filtro-grupo" data-target="material" aria-expanded="false" aria-controls="filtros-opciones">
                    <i class="fas fa-mountain"></i> Material
                </button>
                <button class="btn-filtro-grupo" data-target="acabado" aria-expanded="false" aria-controls="filtros-opciones">
                    <i class="fas fa-paint-roller"></i> Acabado
                </button>
                <button class="btn-filtro-grupo" data-target="medida" aria-expanded="false" aria-controls="filtros-opciones">
                    <i class="fas fa-ruler-combined"></i> Medida
                </button>
                <button class="btn-filtro-grupo" data-target="precio" aria-expanded="false" aria-controls="filtros-opciones">
                    <i class="fas fa-tags"></i> Rango de Precio
                </button>
            </div>
            
            <!-- Contenedor de opciones de filtro -->
            <div class="filtros-opciones-container" id="filtros-opciones" role="region" aria-labelledby="filtros-opciones-title" aria-hidden="true">
                <!-- Contenido dinámico -->
            </div>
        </div>
    </nav>

    <!-- Overlay de filtros para móvil -->
    <div class="filtros-overlay" id="filtros-overlay" role="dialog" aria-modal="true" aria-labelledby="filtros-title" aria-hidden="true">
        <div class="filtros-contenedor-movil">
            <div class="filtros-header-movil">
                <h3 id="filtros-title"><i class="fas fa-filter"></i> Filtrar Materiales</h3>
                <button class="modal-close" onclick="cerrarFiltrosMovil()" aria-label="Cerrar filtros">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="filtros-content-movil" id="filtros-content-movil">
                <!-- Contenido dinámico -->
            </div>
            
            <div class="filtros-footer-movil">
                <div class="filtros-acciones-movil">
                    <button class="btn btn-primary" onclick="aplicarFiltrosMovil()" aria-label="Aplicar filtros seleccionados">
                        <i class="fas fa-check"></i> Aplicar Filtros
                    </button>
                    <button class="btn btn-secondary" onclick="reiniciarFiltrosMovil()" aria-label="Limpiar todos los filtros">
                        <i class="fas fa-redo"></i> Limpiar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Botón flotante para filtros en móvil -->
    <button class="btn-filtros-flotante" id="btn-filtros-movil" aria-label="Abrir filtros" aria-expanded="false" aria-controls="filtros-overlay">
        <i class="fas fa-filter"></i>
        <span class="contador" id="contador-filtros-movil">0</span>
    </button>

    <!-- Botón volver arriba -->
    <button class="btn-volver-arriba" id="btn-volver-arriba" aria-label="Volver al inicio de la página">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Productos -->
    <main class="container" id="main-content">
        <section class="products-section" id="products" aria-labelledby="products-title">
            <div class="section-header">
                <div>
                    <h2 id="products-title" class="section-title">Outlet de Materiales</h2>
                    <p class="products-stats" id="products-stats">Mostrando <span id="products-count">0</span> materiales con precios outlet</p>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="abrirFiltrosMovil()" style="display: none;" id="btn-filtrar-movil">
                        <i class="fas fa-filter"></i> Filtrar
                    </button>
                </div>
            </div>
            
            <div class="products-grid" id="products-grid" role="list" aria-label="Lista de materiales de mármol y granito">
                <!-- Los productos se cargarán dinámicamente desde JSON -->
            </div>
            
            <!-- Paginación -->
            <nav class="pagination" id="pagination" aria-label="Paginación de productos">
                <!-- La paginación se generará dinámicamente -->
            </nav>
        </section>
    </main>

    <!-- Modal para ver productos seleccionados -->
    <div class="modal" id="productos-seleccionados-modal" role="dialog" aria-modal="true" aria-labelledby="productos-seleccionados-titulo" aria-hidden="true">
        <div class="modal-content productos-seleccionados-container">
            <div class="modal-header">
                <h3 id="productos-seleccionados-titulo">Materiales Seleccionados</h3>
                <button class="modal-close" onclick="cerrarProductosSeleccionadosModal()" aria-label="Cerrar modal de productos seleccionados">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="productos-seleccionados-list" id="productos-seleccionados-list">
                <!-- Productos dinámicos -->
            </div>
            
            <div class="productos-total">
                <span>Total de materiales:</span>
                <span class="total" id="productos-seleccionados-total">0</span>
            </div>
            
            <div class="seleccion-acciones">
                <button class="btn btn-primary" onclick="continuarConAsesor()" id="btn-continuar-asesor" aria-label="Continuar con la selección de asesor">
                    <i class="fas fa-arrow-right"></i> Continuar con Asesor
                </button>
                <button class="btn btn-secondary" onclick="cerrarProductosSeleccionadosModal()" aria-label="Seguir agregando materiales">
                    <i class="fas fa-plus"></i> Seguir Agregando
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para seleccionar tipo de cliente y asesor -->
    <div class="modal" id="asesor-seleccion-modal" role="dialog" aria-modal="true" aria-labelledby="asesor-seleccion-titulo" aria-hidden="true">
        <div class="modal-content asesor-seleccion-container">
            <div class="modal-header">
                <h3 id="asesor-seleccion-titulo">Contactar Asesor</h3>
                <button class="modal-close" onclick="cerrarAsesorSeleccionModal()" aria-label="Cerrar selección de asesor">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="productos-consulta-preview">
                <h4><i class="fas fa-list"></i> Materiales para cotizar</h4>
                <div class="productos-seleccionados-list" id="productos-consulta-preview" style="max-height: 150px; margin: 10px 0;">
                    <!-- Vista previa dinámica -->
                </div>
            </div>
            
            <div class="cliente-tipo-seleccion">
                <h4><i class="fas fa-user-check"></i> Tipo de Cliente</h4>
                <div class="cliente-opciones">
                    <label class="cliente-opcion" onclick="seleccionarTipoCliente('nuevo')">
                        <input type="radio" name="tipo-cliente" value="nuevo">
                        <div class="opcion-info">
                            <h5>Cliente Nuevo</h5>
                            <p>Te asignaremos un asesor disponible</p>
                        </div>
                    </label>
                    <label class="cliente-opcion" onclick="seleccionarTipoCliente('existente')">
                        <input type="radio" name="tipo-cliente" value="existente">
                        <div class="opcion-info">
                            <h5>Cliente Existente</h5>
                            <p>Puedes elegir a tu asesor</p>
                        </div>
                    </label>
                </div>
            </div>
            
            <div id="asesor-contenido">
                <!-- Contenido dinámico según tipo de cliente -->
            </div>
            
            <div class="seleccion-acciones" id="asesor-acciones" style="display: none; gap: 20px;">
                <button class="btn btn-primary" id="contactar-asesor" onclick="contactarAsesorSeleccionado()" aria-label="Contactar asesor seleccionado">
                    <i class="fab fa-whatsapp"></i> Contactar por WhatsApp
                </button>
                <button class="btn btn-secondary" onclick="cerrarAsesorSeleccionModal()" aria-label="Volver a productos seleccionados">
                    <i class="fas fa-arrow-left"></i> Volver
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de lista de favoritos -->
    <div class="modal" id="favoritos-modal" role="dialog" aria-modal="true" aria-labelledby="favoritos-titulo" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="favoritos-titulo">Mis Materiales Favoritos</h3>
                <button class="modal-close" id="close-favoritos-modal" aria-label="Cerrar modal de favoritos">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="favoritos-list" id="favoritos-list" role="list" aria-label="Lista de materiales favoritos">
                <!-- Los materiales favoritos se cargarán dinámicamente -->
            </div>
            
            <div class="seleccion-acciones" style="border-top: none; margin-top: 20px;">
                <button class="btn btn-primary" id="agregar-favoritos-consulta" aria-label="Agregar todos los favoritos para consultar con asesor">
                    <i class="fas fa-comments"></i> Cotizar Favoritos
                </button>
                <button class="btn btn-secondary" id="limpiar-favoritos" aria-label="Eliminar todos los materiales de favoritos">
                    <i class="fas fa-trash"></i> Limpiar Favoritos
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de detalles de producto -->
    <div class="modal" id="detalle-producto-modal" role="dialog" aria-modal="true" aria-labelledby="detalle-producto-titulo" aria-hidden="true">
        <div class="modal-content detalle-producto-contenido">
            <div class="detalle-producto-header">
                <h3 id="detalle-producto-titulo">Detalles del Material</h3>
                <button class="modal-close" onclick="cerrarDetalleProductoModal()" aria-label="Cerrar detalles del material">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="detalle-producto-body" id="detalle-producto-contenido">
                <!-- Contenido dinámico -->
            </div>
        </div>
    </div>

    <!-- Modal de compartir producto -->
    <div class="modal" id="compartir-modal" role="dialog" aria-modal="true" aria-labelledby="compartir-titulo" aria-hidden="true">
        <div class="modal-content compartir-modal-content">
            <div class="modal-header">
                <h3 id="compartir-titulo">Compartir Material</h3>
                <button class="modal-close" onclick="cerrarCompartirModal()" aria-label="Cerrar modal de compartir">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <p>Comparte este material con tus contactos:</p>
            
            <div class="compartir-opciones" id="compartir-opciones">
                <!-- Opciones dinámicas -->
            </div>
            
            <div class="compartir-url-container">
                <p>O copia el enlace directo:</p>
                <div class="compartir-url">
                    <input type="text" id="compartir-url-input" readonly aria-label="Enlace para compartir">
                    <button onclick="copiarEnlaceCompartir()" aria-label="Copiar enlace al portapapeles">
                        <i class="fas fa-copy"></i> Copiar
                    </button>
                </div>
            </div>
            
            <div class="seleccion-acciones" style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="cerrarCompartirModal()" aria-label="Cerrar">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Menú móvil -->
    <nav class="mobile-menu" aria-label="Navegación móvil principal">
        <a href="#" class="mobile-menu-item active" aria-label="Inicio" aria-current="page">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </a>
        <a href="#products" class="mobile-menu-item" aria-label="Outlet de materiales">
            <i class="fas fa-tags"></i>
            <span>Outlet</span>
        </a>
        <button class="mobile-menu-item" aria-label="Buscar materiales" id="mobile-menu-search" aria-expanded="false" aria-controls="search-section">
            <i class="fas fa-search"></i>
            <span>Buscar</span>
        </button>
        <button class="mobile-menu-item" aria-label="Ver favoritos" id="mobile-menu-favoritos">
            <i class="fas fa-heart"></i>
            <span>Favoritos</span>
            <span class="mobile-menu-badge" id="mobile-favoritos-count">0</span>
        </button>
    </nav>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="modal" role="status" aria-live="polite" aria-label="Cargando materiales">
        <div class="modal-content" style="background: transparent; box-shadow: none; text-align: center;">
            <div class="loading-spinner" style="width: 60px; height: 60px; border: 4px solid var(--gray-light); border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
            <p style="color: white; margin-top: 20px; font-size: 1.1rem;">Cargando outlet...</p>
        </div>
    </div>

    <script>
        // ===== VARIABLES GLOBALES =====
        let productos = [];
        let asesores = [];
        let productosFiltrados = [];
        let paginaActual = 1;
        const productosPorPagina = 8;
        let productosParaAsesor = [];
        let productosFavoritos = [];
        let busquedaTimeout = null;
        let tipoClienteSeleccionado = null;
        let asesorSeleccionado = null;
        let currentSlideIndex = 0;
        let productoParaCompartir = null;

        // URLs de los archivos JSON
        const PRODUCTOS_JSON_URL = 'JSON/producto.json';
        const ASESORES_JSON_URL = 'JSON/asesor.json';

        // Estado de los filtros (inicialmente vacíos para mostrar todos)
        const estadoFiltros = {
            familias: [],
            materiales: [],
            acabados: [],
            medidas: [],
            calidades: [],
            bordes: [],
            rangoPrecio: { min: 0, max: 10000 },
            busqueda: ''
        };

        // ===== INICIALIZACIÓN =====
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                mostrarLoading();
                
                // Cargar datos de manera concurrente
                await Promise.all([
                    cargarProductos(),
                    cargarAsesoresDesdeJSON()
                ]);
                
                inicializarAplicacion();
                
                console.log('Aplicación inicializada correctamente');
                ocultarLoading();
            } catch (error) {
                console.error('Error al inicializar la aplicación:', error);
                mostrarError('Error al cargar los datos. Por favor, recarga la página.');
                ocultarLoading();
            }
        });

        // ===== FUNCIONES DE CARGA DE DATOS =====
        async function cargarProductos() {
            try {
                const response = await fetch(PRODUCTOS_JSON_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                // Validar y transformar datos
                if (Array.isArray(data)) {
                    productos = data.map(producto => ({
                        id: producto.codigo, // Usar código como ID
                        codigo: producto.codigo,
                        nombre: producto.nombre,
                        familia: producto.familia,
                        material: producto.material,
                        acabado: producto.acabado,
                        medida: producto.medida,
                        borde: producto.borde,
                        calidad: producto.calidad,
                        unidad: producto.unidad,
                        precio: producto.precio || 0,
                        precioOriginal: producto.precioOriginal || producto.precio || 0,
                        descuento: producto.descuento || 0,
                        imagenes: producto.imagenes || [],
                        etiqueta: producto.etiqueta || '',
                        destacado: producto.destacado === 'SI',
                        descripcion: `${producto.familia} ${producto.material} ${producto.acabado} - ${producto.medida}`,
                        enFavoritos: false,
                        agregadoParaAsesor: false
                    }));
                } else {
                    throw new Error('Formato de JSON inválido');
                }
                
                console.log(`${productos.length} productos cargados correctamente`);
                return productos;
            } catch (error) {
                console.error('Error cargando productos:', error);
                
                // Datos de ejemplo en caso de error
                productos = obtenerProductosEjemplo();
                mostrarToast('Usando datos de ejemplo. Verifique la conexión con el servidor.');
                return productos;
            }
        }

        async function cargarAsesoresDesdeJSON() {
            try {
                const response = await fetch(ASESORES_JSON_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                // Validar y transformar datos según nueva estructura
                if (Array.isArray(data)) {
                    asesores = data.map(asesor => ({
                        id: asesor.codigo, // Usar código como ID
                        codigo: asesor.codigo,
                        nombre: asesor.nombre,
                        especialidad: asesor.especialidad,
                        foto: asesor.foto,
                        celular: asesor.celular
                    }));
                } else {
                    throw new Error('Formato de JSON de asesores inválido');
                }
                
                console.log(`${asesores.length} asesores cargados correctamente`);
                return asesores;
            } catch (error) {
                console.error('Error cargando asesores:', error);
                
                // Datos de ejemplo en caso de error
                asesores = obtenerAsesoresEjemplo();
                mostrarToast('Usando asesores de ejemplo.');
                return asesores;
            }
        }

        function obtenerProductosEjemplo() {
            return [
                {
                    id: "BTMR1TRX08241",
                    codigo: "BTMR1TRX08241",
                    nombre: "BALDOSAS TEMPORA RECTO TRANQUERA X",
                    familia: "BALDOSAS",
                    material: "TRANQUERA X",
                    acabado: "TEMPORA",
                    medida: "24'' x 8'' x 1 cm",
                    borde: "RECTO",
                    calidad: "PRIMERA",
                    unidad: "m²",
                    precio: 85.50,
                    precioOriginal: 120.00,
                    descuento: 29,
                    imagenes: [
                        "FOTO/PRODUCTO/BTMR1TRX08241/foto_01.png",
                        "FOTO/PRODUCTO/BTMR1TRX08241/foto_02.png"
                    ],
                    etiqueta: "OFERTA",
                    destacado: true,
                    descripcion: "Baldosas de alta calidad para acabados elegantes",
                    enFavoritos: false,
                    agregadoParaAsesor: false
                },
                {
                    id: "MRBL2MCR06302",
                    codigo: "MRBL2MCR06302",
                    nombre: "MÁRMOL BLANCO CARRARA",
                    familia: "MÁRMOL",
                    material: "BLANCO CARRARA",
                    acabado: "PULIDO",
                    medida: "30'' x 60'' x 2 cm",
                    borde: "RECTILÍNEO",
                    calidad: "EXTRA",
                    unidad: "m²",
                    precio: 120.00,
                    precioOriginal: 150.00,
                    descuento: 20,
                    imagenes: [
                        "FOTO/PRODUCTO/MRBL2MCR06302/foto_01.png"
                    ],
                    etiqueta: "NUEVO",
                    destacado: true,
                    descripcion: "Mármol blanco Carrara de alta pureza",
                    enFavoritos: false,
                    agregadoParaAsesor: false
                },
                {
                    id: "GRNT3NGR09403",
                    codigo: "GRNT3NGR09403",
                    nombre: "GRANITO NEGRO ABSOLUTO",
                    familia: "GRANITO",
                    material: "NEGRO ABSOLUTO",
                    acabado: "PULIDO",
                    medida: "40'' x 90'' x 3 cm",
                    borde: "RECTILÍNEO",
                    calidad: "PRIMERA",
                    unidad: "m²",
                    precio: 0,
                    precioOriginal: 0,
                    descuento: 0,
                    imagenes: [
                        "FOTO/PRODUCTO/GRNT3NGR09403/foto_01.png"
                    ],
                    etiqueta: "DISPONIBLE",
                    destacado: false,
                    descripcion: "Granito negro absoluto para encimeras",
                    enFavoritos: false,
                    agregadoParaAsesor: false
                }
            ];
        }

        function obtenerAsesoresEjemplo() {
            return [
                {
                    id: 1,
                    codigo: 1,
                    nombre: "Carlos Rodríguez",
                    especialidad: "Asesor Comercial",
                    foto: "https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80",
                    celular: "+51987654321"
                },
                {
                    id: 2,
                    codigo: 2,
                    nombre: "María Gómez",
                    especialidad: "Especialista en Mármol",
                    foto: "https://images.unsplash.com/photo-1580489944761-15a19d654956?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80",
                    celular: "+51987654322"
                },
                {
                    id: 3,
                    codigo: 3,
                    nombre: "Juan Pérez",
                    especialidad: "Proyectos Especiales",
                    foto: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80",
                    celular: "+51987654323"
                }
            ];
        }

        function inicializarAplicacion() {
            try {
                cargarDatosLocalStorage();
                inicializarTema();
                inicializarFiltrosFijos();
                inicializarBusqueda();
                inicializarProductos();
                inicializarModales();
                inicializarMenuMovil();
                inicializarFiltrosMovil();
                inicializarBotonVolverArriba();
                configurarNavegacionTeclado();
                configurarScrollBusquedaMovil();
                actualizarContadorFavoritos();
                actualizarContadorAsesor();
                actualizarContadorFiltros();
                                
                // Extraer valores únicos para filtros
                extraerValoresFiltros();
                
                // Aplicar filtros iniciales (mostrar todos)
                aplicarFiltros();
                
                console.log('Aplicación inicializada correctamente');
                
                verificarParametroURL();
                
            } catch (error) {
                console.error('Error al inicializar:', error);
                mostrarError('Error al cargar. Recarga la página.');
            }
        }

        // ===== FUNCIÓN PARA VERIFICAR PARÁMETROS DE URL =====
        function verificarParametroURL() {
            try {
                // Obtener parámetros de la URL
                const urlParams = new URLSearchParams(window.location.search);
                const productoId = urlParams.get('producto');
                
                if (productoId) {
                    console.log('Producto compartido detectado en URL:', productoId);
                    
                    // Esperar a que los productos estén cargados
                    if (productos.length > 0) {
                        mostrarProductoCompartido(productoId);
                    } else {
                        // Si los productos no están cargados aún, esperar un momento
                        setTimeout(() => {
                            mostrarProductoCompartido(productoId);
                        }, 500);
                    }
                }
            } catch (error) {
                console.error('Error al leer parámetros de URL:', error);
            }
        }

        function mostrarProductoCompartido(productoId) {
            // Buscar el producto por ID o código
            const producto = productos.find(p => p.id === productoId || p.codigo === productoId);
            
            if (producto) {
                console.log('Producto encontrado:', producto.nombre);
                
                // Mostrar mensaje informativo
                mostrarToast(`Producto compartido: ${producto.nombre}`);
                
                // Aplicar filtros para mostrar solo este producto
                aplicarFiltroParaProductoCompartido(producto);
                
                // Desplazarse a la sección de productos
                setTimeout(() => {
                    const productsSection = document.getElementById('products');
                    if (productsSection) {
                        productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                    
                    // Opcional: Abrir el modal de detalles
                    setTimeout(() => {
                        verDetallesProducto(producto.id);
                    }, 1000);
                }, 500);
                
            } else {
                console.warn('Producto no encontrado con ID:', productoId);
                mostrarToast('Producto no encontrado. Mostrando todos los materiales.');
            }
        }

        function aplicarFiltroParaProductoCompartido(producto) {
            // Limpiar filtros existentes
            reiniciarFiltros();
            
            // Establecer filtros específicos para este producto
            estadoFiltros.familias = [producto.familia];
            estadoFiltros.materiales = [producto.material];
            
            // Aplicar búsqueda por código/nombre
            estadoFiltros.busqueda = producto.codigo;
            
            // Aplicar los filtros
            aplicarFiltros();
            
            // Actualizar barra de búsqueda
            const inputBusqueda = document.getElementById('search-input');
            if (inputBusqueda) {
                inputBusqueda.value = producto.codigo;
            }
        }

        function extraerValoresFiltros() {
            // Extraer valores únicos de los productos para los filtros
            estadoFiltros.familias = [...new Set(productos.map(p => p.familia))];
            estadoFiltros.materiales = [...new Set(productos.map(p => p.material))];
            estadoFiltros.acabados = [...new Set(productos.map(p => p.acabado))];
            estadoFiltros.medidas = [...new Set(productos.map(p => p.medida))];
            estadoFiltros.calidades = [...new Set(productos.map(p => p.calidad))];
            estadoFiltros.bordes = [...new Set(productos.map(p => p.borde))];
            
            // Calcular rango de precios
            const precios = productos.filter(p => p.precio > 0).map(p => p.precio);
            if (precios.length > 0) {
                estadoFiltros.rangoPrecio.min = Math.floor(Math.min(...precios));
                estadoFiltros.rangoPrecio.max = Math.ceil(Math.max(...precios));
            }
        }

        function mostrarLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('activo');
                loadingOverlay.setAttribute('aria-hidden', 'false');
            }
        }

        function ocultarLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('activo');
                loadingOverlay.setAttribute('aria-hidden', 'true');
            }
        }

        // ===== FUNCIONES DE ALMACENAMIENTO =====
        function cargarDatosLocalStorage() {
            try {
                // Cargar favoritos
                const favoritosGuardados = localStorage.getItem('favoritosGallosMarmol');
                if (favoritosGuardados) {
                    productosFavoritos = JSON.parse(favoritosGuardados);
                    
                    // Actualizar estado en productos
                    productos.forEach(producto => {
                        producto.enFavoritos = productosFavoritos.includes(producto.id);
                    });
                }
                
                // Cargar productos para asesor
                const productosAsesorGuardados = localStorage.getItem('productosAsesorGallosMarmol');
                if (productosAsesorGuardados) {
                    productosParaAsesor = JSON.parse(productosAsesorGuardados);
                    
                    // Actualizar estado en productos
                    productos.forEach(producto => {
                        producto.agregadoParaAsesor = productosParaAsesor.some(item => item.id === producto.id);
                    });
                }
                
                // Cargar tema
                const temaGuardado = localStorage.getItem('temaGallosMarmol');
                if (temaGuardado === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun"></i>';
                    document.getElementById('theme-toggle').setAttribute('aria-pressed', 'true');
                }
                
                // Cargar tipo de cliente guardado
                const tipoClienteGuardado = localStorage.getItem('tipoClienteGallosMarmol');
                if (tipoClienteGuardado) {
                    tipoClienteSeleccionado = tipoClienteGuardado;
                }
            } catch (error) {
                console.error('Error al cargar datos de localStorage:', error);
                productosFavoritos = [];
                productosParaAsesor = [];
            }
        }

        function guardarFavoritos() {
            try {
                localStorage.setItem('favoritosGallosMarmol', JSON.stringify(productosFavoritos));
            } catch (error) {
                console.error('Error al guardar favoritos:', error);
                mostrarError('No se pudieron guardar los favoritos');
            }
        }

        function guardarProductosAsesor() {
            try {
                localStorage.setItem('productosAsesorGallosMarmol', JSON.stringify(productosParaAsesor));
            } catch (error) {
                console.error('Error al guardar productos para asesor:', error);
                mostrarError('No se pudieron guardar los productos para consulta');
            }
        }

        function guardarTipoCliente(tipo) {
            try {
                localStorage.setItem('tipoClienteGallosMarmol', tipo);
            } catch (error) {
                console.error('Error al guardar tipo de cliente:', error);
            }
        }

        // ===== TEMA OSCURO/CLARO =====
        function inicializarTema() {
            const themeToggle = document.getElementById('theme-toggle');
            const mobileThemeToggle = document.getElementById('mobile-menu-theme');
            
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    toggleTema();
                });
            }
            
            if (mobileThemeToggle) {
                mobileThemeToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    toggleTema();
                });
            }
        }

        function toggleTema() {
            const themeToggle = document.getElementById('theme-toggle');
            document.body.classList.toggle('dark-mode');
            
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                themeToggle.setAttribute('aria-pressed', 'true');
                localStorage.setItem('temaGallosMarmol', 'dark');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                themeToggle.setAttribute('aria-pressed', 'false');
                localStorage.setItem('temaGallosMarmol', 'light');
            }
        }

        // ===== BOTÓN VOLVER ARRIBA =====
        function inicializarBotonVolverArriba() {
            const btnVolverArriba = document.getElementById('btn-volver-arriba');
            
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    btnVolverArriba.classList.add('visible');
                } else {
                    btnVolverArriba.classList.remove('visible');
                }
            });
            
            btnVolverArriba.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                document.getElementById('main-content').focus();
            });
        }

        // ===== FILTROS FIJOS =====
        function inicializarFiltrosFijos() {
            document.querySelectorAll('.btn-filtro-grupo').forEach(boton => {
                boton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const target = this.getAttribute('data-target');
                    mostrarOpcionesFiltro(target, this);
                });
                
                boton.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const target = this.getAttribute('data-target');
                        mostrarOpcionesFiltro(target, this);
                    }
                });
            });
            
            cargarOpcionesFiltro('familia');
            
            document.addEventListener('click', function(e) {
                const opcionesContainer = document.getElementById('filtros-opciones');
                const barraFiltros = document.getElementById('barra-filtros');
                
                if (opcionesContainer && opcionesContainer.classList.contains('visible')) {
                    if (!barraFiltros.contains(e.target)) {
                        cerrarOpcionesFiltro();
                    }
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    cerrarOpcionesFiltro();
                }
            });
        }

        function mostrarOpcionesFiltro(tipo, boton) {
            document.querySelectorAll('.btn-filtro-grupo').forEach(b => {
                b.classList.remove('activo');
                b.setAttribute('aria-expanded', 'false');
            });
            
            boton.classList.add('activo');
            boton.setAttribute('aria-expanded', 'true');
            
            cargarOpcionesFiltro(tipo);
            
            const opcionesContainer = document.getElementById('filtros-opciones');
            opcionesContainer.classList.add('visible');
            opcionesContainer.setAttribute('aria-hidden', 'false');
            
            // Enfocar el primer elemento del filtro
            setTimeout(() => {
                const firstInput = opcionesContainer.querySelector('input, button');
                if (firstInput) firstInput.focus();
            }, 100);
        }

        function cargarOpcionesFiltro(tipo) {
            const container = document.getElementById('filtros-opciones');
            if (!container) return;
            
            let html = '';
            let titulo = '';
            let icono = '';
            
            switch(tipo) {
                case 'familia':
                    titulo = 'Familia';
                    icono = 'fas fa-layer-group';
                    const familiasUnicas = [...new Set(productos.map(p => p.familia))];
                    html = `
                        <div class="filtro-opcion">
                            <h4><i class="${icono}"></i> ${titulo}</h4>
                            <div class="filtro-opciones">
                                ${familiasUnicas.map(familia => `
                                    <label class="filtro-checkbox">
                                        <input type="checkbox" name="familia-fijo" value="${familia}" 
                                               ${estadoFiltros.familias && estadoFiltros.familias.includes(familia) ? 'checked' : ''}
                                               onchange="actualizarFiltroDesdeFijo('familias', '${familia}', this.checked)"
                                               aria-label="Filtrar por familia ${familia}">
                                        <span>${familia}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'material':
                    titulo = 'Material';
                    icono = 'fas fa-mountain';
                    const materialesUnicos = [...new Set(productos.map(p => p.material))];
                    html = `
                        <div class="filtro-opcion">
                            <h4><i class="${icono}"></i> ${titulo}</h4>
                            <div class="filtro-opciones">
                                ${materialesUnicos.map(material => `
                                    <label class="filtro-checkbox">
                                        <input type="checkbox" name="material-fijo" value="${material}" 
                                               ${estadoFiltros.materiales && estadoFiltros.materiales.includes(material) ? 'checked' : ''}
                                               onchange="actualizarFiltroDesdeFijo('materiales', '${material}', this.checked)"
                                               aria-label="Filtrar por material ${material}">
                                        <span>${material}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'acabado':
                    titulo = 'Acabado';
                    icono = 'fas fa-paint-roller';
                    const acabadosUnicos = [...new Set(productos.map(p => p.acabado))];
                    html = `
                        <div class="filtro-opcion">
                            <h4><i class="${icono}"></i> ${titulo}</h4>
                            <div class="filtro-opciones">
                                ${acabadosUnicos.map(acabado => `
                                    <label class="filtro-checkbox">
                                        <input type="checkbox" name="acabado-fijo" value="${acabado}" 
                                               ${estadoFiltros.acabados && estadoFiltros.acabados.includes(acabado) ? 'checked' : ''}
                                               onchange="actualizarFiltroDesdeFijo('acabados', '${acabado}', this.checked)"
                                               aria-label="Filtrar por acabado ${acabado}">
                                        <span>${acabado}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'medida':
                    titulo = 'Medida';
                    icono = 'fas fa-ruler-combined';
                    const medidasUnicas = [...new Set(productos.map(p => p.medida))];
                    html = `
                        <div class="filtro-opcion">
                            <h4><i class="${icono}"></i> ${titulo}</h4>
                            <div class="filtro-opciones">
                                ${medidasUnicas.map(medida => `
                                    <label class="filtro-checkbox">
                                        <input type="checkbox" name="medida-fijo" value="${medida}" 
                                               ${estadoFiltros.medidas && estadoFiltros.medidas.includes(medida) ? 'checked' : ''}
                                               onchange="actualizarFiltroDesdeFijo('medidas', '${medida}', this.checked)"
                                               aria-label="Filtrar por medida ${medida}">
                                        <span>${medida}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'precio':
                    titulo = 'Rango de Precio';
                    icono = 'fas fa-tags';
                    const minPrecio = estadoFiltros.rangoPrecio.min;
                    const maxPrecio = estadoFiltros.rangoPrecio.max;
                    html = `
                        <div class="filtro-opcion">
                            <h4><i class="${icono}"></i> ${titulo}</h4>
                            <div style="padding: 15px;">
                                <div style="margin-bottom: 15px;">
                                    <label for="precio-min" style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Mínimo: S/. <span id="precio-min-value">${minPrecio}</span></label>
                                    <input type="range" id="precio-min" min="0" max="${maxPrecio}" value="${minPrecio}" 
                                           style="width: 100%;" 
                                           oninput="actualizarRangoPrecio('min', this.value)">
                                </div>
                                <div>
                                    <label for="precio-max" style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Máximo: S/. <span id="precio-max-value">${maxPrecio}</span></label>
                                    <input type="range" id="precio-max" min="0" max="${maxPrecio * 1.5}" value="${maxPrecio}" 
                                           style="width: 100%;"
                                           oninput="actualizarRangoPrecio('max', this.value)">
                                </div>
                                <div style="margin-top: 20px; padding: 10px; background: var(--gray-light); border-radius: var(--radius-sm); text-align: center;">
                                    <strong>Rango seleccionado:</strong><br>
                                    S/. ${minPrecio} - S/. ${maxPrecio}
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            html += `
                <div class="filtros-acciones">
                    <button class="btn btn-primary" onclick="aplicarFiltrosDesdeFijo()" aria-label="Aplicar filtros seleccionados">
                        <i class="fas fa-check"></i> Aplicar
                    </button>
                    <button class="btn btn-secondary" onclick="cerrarOpcionesFiltro()" aria-label="Cerrar opciones de filtro">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function actualizarFiltroDesdeFijo(tipo, valor, checked) {
            // Asegurarse de que el array exista
            if (!estadoFiltros[tipo]) {
                estadoFiltros[tipo] = [];
            }
            
            const arrayFiltro = estadoFiltros[tipo];
            
            if (checked) {
                if (!arrayFiltro.includes(valor)) {
                    arrayFiltro.push(valor);
                }
            } else {
                const indice = arrayFiltro.indexOf(valor);
                if (indice !== -1) {
                    arrayFiltro.splice(indice, 1);
                }
            }
        }

        function actualizarRangoPrecio(tipo, valor) {
            estadoFiltros.rangoPrecio[tipo] = parseFloat(valor);
            document.getElementById(`precio-${tipo}-value`).textContent = parseInt(valor);
        }

        function aplicarFiltrosDesdeFijo() {
            aplicarFiltros();
            cerrarOpcionesFiltro();
        }

        function cerrarOpcionesFiltro() {
            const container = document.getElementById('filtros-opciones');
            if (container) {
                container.classList.remove('visible');
                container.setAttribute('aria-hidden', 'true');
            }
            
            document.querySelectorAll('.btn-filtro-grupo').forEach(b => {
                b.classList.remove('activo');
                b.setAttribute('aria-expanded', 'false');
            });
            
            // Enfocar el botón que abrió el filtro
            const activeBtn = document.querySelector('.btn-filtro-grupo.activo');
            if (activeBtn) activeBtn.focus();
        }

        // ===== BÚSQUEDA =====
        function inicializarBusqueda() {
            const inputBusqueda = document.getElementById('search-input');
            const resultadosBusqueda = document.getElementById('search-results');
            const seccionBusqueda = document.getElementById('search-section');
            const toggleBusquedaMovil = document.getElementById('mobile-search-toggle');
            const menuBusquedaMovil = document.getElementById('mobile-menu-search');
            
            if (inputBusqueda) {
                inputBusqueda.addEventListener('input', function() {
                    clearTimeout(busquedaTimeout);
                    
                    busquedaTimeout = setTimeout(() => {
                        const consulta = this.value.trim().toLowerCase();
                        
                        if (consulta.length > 0) {
                            estadoFiltros.busqueda = consulta;
                            buscarProductos(consulta);
                        } else {
                            estadoFiltros.busqueda = '';
                            if (resultadosBusqueda) {
                                resultadosBusqueda.classList.remove('active');
                                resultadosBusqueda.innerHTML = '';
                            }
                        }
                    }, 300);
                });
                
                inputBusqueda.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        const consulta = this.value.trim().toLowerCase();
                        if (consulta.length > 0) {
                            estadoFiltros.busqueda = consulta;
                            aplicarFiltros();
                            if (resultadosBusqueda) {
                                resultadosBusqueda.classList.remove('active');
                            }
                            
                            if (window.innerWidth < 768 && seccionBusqueda) {
                                setTimeout(() => {
                                    seccionBusqueda.classList.remove('active');
                                }, 500);
                            }
                        }
                    } else if (e.key === 'Escape') {
                        this.value = '';
                        estadoFiltros.busqueda = '';
                        if (resultadosBusqueda) {
                            resultadosBusqueda.classList.remove('active');
                        }
                        aplicarFiltros();
                    } else if (e.key === 'ArrowDown' && resultadosBusqueda.classList.contains('active')) {
                        e.preventDefault();
                        const firstResult = resultadosBusqueda.querySelector('.search-result-item');
                        if (firstResult) firstResult.focus();
                    }
                });
                
                document.addEventListener('click', function(e) {
                    if (inputBusqueda && !inputBusqueda.contains(e.target) && 
                        resultadosBusqueda && !resultadosBusqueda.contains(e.target)) {
                        resultadosBusqueda.classList.remove('active');
                    }
                });
                
                if (resultadosBusqueda) {
                    resultadosBusqueda.addEventListener('click', function(e) {
                        e.stopPropagation();
                    });
                    
                    // Navegación por teclado en resultados
                    resultadosBusqueda.addEventListener('keydown', function(e) {
                        const items = this.querySelectorAll('.search-result-item');
                        const currentIndex = Array.from(items).findIndex(item => item === document.activeElement);
                        
                        if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            const nextIndex = (currentIndex + 1) % items.length;
                            if (items[nextIndex]) items[nextIndex].focus();
                        } else if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            const prevIndex = (currentIndex - 1 + items.length) % items.length;
                            if (items[prevIndex]) items[prevIndex].focus();
                        } else if (e.key === 'Escape') {
                            inputBusqueda.focus();
                            this.classList.remove('active');
                        }
                    });
                }
            }

            if (menuBusquedaMovil) {
                menuBusquedaMovil.addEventListener('click', function(e) {
                    e.preventDefault();
                    // MODIFICAR ESTA LÍNEA - sin referencia a toggleBusquedaMovil
                    if (seccionBusqueda) {
                        seccionBusqueda.classList.add('active');
                        // Solo enfocar el input si existe
                        setTimeout(() => {
                            if (inputBusqueda) inputBusqueda.focus();
                        }, 100);
                    }
                });
            }
        }

        function configurarScrollBusquedaMovil() {
            let ultimoScroll = 0;
            
            window.addEventListener('scroll', function() {
                if (window.innerWidth < 768) {
                    const seccionBusqueda = document.getElementById('search-section');
                    if (seccionBusqueda && seccionBusqueda.classList.contains('active')) {
                        const scrollActual = window.pageYOffset;
                        
                        if (Math.abs(scrollActual - ultimoScroll) > 50) {
                            seccionBusqueda.classList.remove('active');
                        }
                        
                        ultimoScroll = scrollActual;
                    }
                }
            });
        }

        function buscarProductos(consulta) {
            const resultadosBusqueda = document.getElementById('search-results');
            if (!resultadosBusqueda) return;
            
            if (consulta.length < 2) {
                resultadosBusqueda.classList.remove('active');
                resultadosBusqueda.innerHTML = '';
                return;
            }
            
            const resultados = productos.filter(producto => {
                const enCodigo = producto.codigo.toLowerCase().includes(consulta);
                const enNombre = producto.nombre.toLowerCase().includes(consulta);
                const enMaterial = producto.material.toLowerCase().includes(consulta);
                const enFamilia = producto.familia.toLowerCase().includes(consulta);
                
                return enCodigo || enNombre || enMaterial || enFamilia;
            }).slice(0, 5);
            
            if (resultados.length > 0) {
                let htmlResultados = '';
                
                resultados.forEach(producto => {
                    const precioTexto = producto.precio > 0 ? `S/. ${producto.precio.toFixed(2)}` : 'Consultar precio';
                    
                    htmlResultados += `
                        <div class="search-result-item" data-id="${producto.id}" 
                             onclick="verDetallesProducto('${producto.id}')" 
                             onkeydown="if(event.key === 'Enter') verDetallesProducto('${producto.id}')"
                             role="button" 
                             tabindex="0"
                             aria-label="${producto.nombre}. ${producto.familia}. ${producto.material}. ${precioTexto}">
                            <img src="${producto.imagenes[0]}" alt="${producto.nombre}" 
                                 onerror="this.src='https://via.placeholder.com/50x50/f5f5f5/333?text=Mármol'">
                            <div class="search-result-info">
                                <h4>${producto.nombre}</h4>
                                <p>${producto.familia} - ${producto.material}</p>
                                <span class="search-result-code">${producto.codigo}</span>
                                <small><strong>${precioTexto}</strong></small>
                            </div>
                        </div>
                    `;
                });
                
                resultadosBusqueda.innerHTML = htmlResultados;
                resultadosBusqueda.classList.add('active');
            } else {
                resultadosBusqueda.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                        <p>No se encontraron materiales para "${consulta}"</p>
                    </div>
                `;
                resultadosBusqueda.classList.add('active');
            }
        }

        // ===== FILTROS =====
        function aplicarFiltros() {
            mostrarSkeletonLoading();
            
            setTimeout(() => {
                productosFiltrados = productos.filter(producto => {
                    // Filtro por familia
                    if (estadoFiltros.familias && estadoFiltros.familias.length > 0 && !estadoFiltros.familias.includes(producto.familia)) {
                        return false;
                    }
                    
                    // Filtro por material
                    if (estadoFiltros.materiales && estadoFiltros.materiales.length > 0 && !estadoFiltros.materiales.includes(producto.material)) {
                        return false;
                    }
                    
                    // Filtro por acabado
                    if (estadoFiltros.acabados && estadoFiltros.acabados.length > 0 && !estadoFiltros.acabados.includes(producto.acabado)) {
                        return false;
                    }
                    
                    // Filtro por medida
                    if (estadoFiltros.medidas && estadoFiltros.medidas.length > 0 && !estadoFiltros.medidas.includes(producto.medida)) {
                        return false;
                    }
                    
                    // Filtro por calidad
                    if (estadoFiltros.calidades && estadoFiltros.calidades.length > 0 && !estadoFiltros.calidades.includes(producto.calidad)) {
                        return false;
                    }
                    
                    // Filtro por borde
                    if (estadoFiltros.bordes && estadoFiltros.bordes.length > 0 && !estadoFiltros.bordes.includes(producto.borde)) {
                        return false;
                    }
                    
                    // Filtro por rango de precio
                    if (producto.precio > 0) {
                        if (producto.precio < estadoFiltros.rangoPrecio.min || producto.precio > estadoFiltros.rangoPrecio.max) {
                            return false;
                        }
                    }
                    
                    // Filtro por búsqueda
                    if (estadoFiltros.busqueda) {
                        const busquedaMin = estadoFiltros.busqueda.toLowerCase();
                        const enCodigo = producto.codigo.toLowerCase().includes(busquedaMin);
                        const enNombre = producto.nombre.toLowerCase().includes(busquedaMin);
                        const enMaterial = producto.material.toLowerCase().includes(busquedaMin);
                        const enFamilia = producto.familia.toLowerCase().includes(busquedaMin);
                        const enAcabado = producto.acabado.toLowerCase().includes(busquedaMin);
                        
                        if (!enCodigo && !enNombre && !enMaterial && !enFamilia && !enAcabado) {
                            return false;
                        }
                    }
                    
                    return true;
                });
                
                paginaActual = 1;
                actualizarEstadisticasProductos();
                renderizarProductos();
                
                if (window.innerWidth < 768) {
                    cerrarFiltrosMovil();
                }
                
                if (estadoFiltros.busqueda || 
                    (estadoFiltros.familias && estadoFiltros.familias.length > 0) || 
                    (estadoFiltros.materiales && estadoFiltros.materiales.length > 0) || 
                    (estadoFiltros.acabados && estadoFiltros.acabados.length > 0) || 
                    (estadoFiltros.medidas && estadoFiltros.medidas.length > 0) || 
                    (estadoFiltros.calidades && estadoFiltros.calidades.length > 0) || 
                    (estadoFiltros.bordes && estadoFiltros.bordes.length > 0)) {
                    mostrarToast(`${productosFiltrados.length} materiales encontrados`);
                }
            }, 300);
        }

        function reiniciarFiltros() {
            estadoFiltros.familias = [];
            estadoFiltros.materiales = [];
            estadoFiltros.acabados = [];
            estadoFiltros.medidas = [];
            estadoFiltros.calidades = [];
            estadoFiltros.bordes = [];
            estadoFiltros.busqueda = '';
            
            const inputBusqueda = document.getElementById('search-input');
            if (inputBusqueda) inputBusqueda.value = '';
            
            const resultadosBusqueda = document.getElementById('search-results');
            if (resultadosBusqueda) resultadosBusqueda.classList.remove('active');
            
            productosFiltrados = [...productos];
            paginaActual = 1;
                       
            actualizarEstadisticasProductos();
            renderizarProductos();
            
            mostrarToast('Filtros restablecidos');
            
            if (window.innerWidth < 768) {
                const seccionBusqueda = document.getElementById('search-section');
                if (seccionBusqueda) {
                    seccionBusqueda.classList.remove('active');
                }
            }
        }

        // ===== PRODUCTOS =====
        function inicializarProductos() {
            // Eliminada la funcionalidad de ordenamiento
        }

        function mostrarSkeletonLoading() {
            const gridProductos = document.getElementById('products-grid');
            if (!gridProductos) return;
            
            let skeletonHTML = '';
            for (let i = 0; i < 8; i++) {
                skeletonHTML += `
                    <div class="skeleton-card skeleton">
                        <div class="skeleton-image"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-title"></div>
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text"></div>
                        </div>
                    </div>
                `;
            }
            
            gridProductos.innerHTML = skeletonHTML;
        }

        function renderizarProductos() {
            const gridProductos = document.getElementById('products-grid');
            const paginacion = document.getElementById('pagination');
            
            if (!gridProductos) return;
            
            const indiceInicio = (paginaActual - 1) * productosPorPagina;
            const indiceFin = indiceInicio + productosPorPagina;
            const productosPaginados = productosFiltrados.slice(indiceInicio, indiceFin);
            
            gridProductos.innerHTML = '';
            
            if (productosPaginados.length === 0) {
                gridProductos.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
                        <i class="fas fa-search" style="font-size: 3rem; color: var(--gray-dark); margin-bottom: 20px;"></i>
                        <h3 style="color: var(--text-light); margin-bottom: 10px;">No se encontraron materiales</h3>
                        <p style="color: var(--gray-dark);">Intenta con otros filtros o términos de búsqueda</p>
                        <button class="btn btn-primary" onclick="reiniciarFiltros()" style="margin-top: 20px;" aria-label="Ver todos los materiales">
                            <i class="fas fa-redo"></i> Ver todos los materiales
                        </button>
                    </div>
                `;
                if (paginacion) paginacion.innerHTML = '';
                return;
            }
            
            productosPaginados.forEach(producto => {
                const tarjetaProducto = crearTarjetaProducto(producto);
                gridProductos.appendChild(tarjetaProducto);
            });
            
            renderizarPaginacion();
            actualizarEstadisticasProductos();
        }

        function crearTarjetaProducto(producto) {
            const tarjeta = document.createElement('article');
            tarjeta.className = 'product-card';
            tarjeta.setAttribute('data-id', producto.id);
            tarjeta.setAttribute('aria-label', `${producto.nombre}. ${producto.descripcion.substring(0, 100)}...`);
            
            const textoEtiqueta = producto.etiqueta === 'NUEVO' ? 'Nuevo' : 
                                 producto.etiqueta === 'OFERTA' ? 'Oferta' : 
                                 producto.etiqueta === 'DISPONIBLE' ? 'Disponible' :
                                 producto.etiqueta === 'AGOTADO' ? 'Agotado' : null;
            const claseEtiqueta = producto.etiqueta ? producto.etiqueta.toLowerCase() : '';
            const enFavoritos = producto.enFavoritos;
            const agregadoParaAsesor = producto.agregadoParaAsesor;
            const tienePrecio = producto.precio > 0;
            const precioFormateado = tienePrecio ? `S/. ${producto.precio.toFixed(2)}` : 'Consultar precio';
            const precioUnitario = tienePrecio ? ` x ${producto.unidad}` : '';
            const descuento = producto.descuento > 0 ? producto.descuento : 0;
            
            tarjeta.innerHTML = `
                ${textoEtiqueta ? `<div class="product-badge ${claseEtiqueta}" aria-label="${textoEtiqueta}">${textoEtiqueta}</div>` : ''}
                
                <div class="product-image-container">
                    <img src="${producto.imagenes[0]}" 
                         alt="${producto.nombre} - ${producto.familia}" 
                         class="product-image"
                         loading="lazy"
                         width="280"
                         height="250"
                         onerror="this.src='https://via.placeholder.com/280x250/f5f5f5/333?text=Mármol'">
                    <button class="product-wishlist ${enFavoritos ? 'activo' : ''}" 
                            aria-label="${enFavoritos ? 'Quitar de favoritos' : 'Añadir a favoritos'}"
                            aria-pressed="${enFavoritos}"
                            onclick="alternarFavorito('${producto.id}')">
                        <i class="${enFavoritos ? 'fas' : 'far'} fa-heart"></i>
                    </button>
                </div>
                
                <div class="product-info">
                    <span class="product-code">${producto.codigo}</span>
                    <h3 class="product-title">${producto.nombre}</h3>
                    
                    <div class="product-price-container">
                        ${tienePrecio ? `
                            <div class="product-price">${precioFormateado}</div>
                            <div class="product-price-unit">${precioUnitario}</div>
                            ${descuento > 0 ? `<span class="price-badge">-${descuento}% OFF</span>` : ''}
                        ` : `
                            <div class="product-price-consult">Consultar precio</div>
                        `}
                    </div>
                    
                    <div class="product-details-grid">
                        <div class="product-detail-item">
                            <span class="product-detail-label">Familia</span>
                            <span class="product-detail-value">${producto.familia}</span>
                        </div>
                        <div class="product-detail-item">
                            <span class="product-detail-label">Material</span>
                            <span class="product-detail-value">${producto.material}</span>
                        </div>
                        <div class="product-detail-item">
                            <span class="product-detail-label">Acabado</span>
                            <span class="product-detail-value">${producto.acabado}</span>
                        </div>
                        <div class="product-detail-item">
                            <span class="product-detail-label">Medida</span>
                            <span class="product-detail-value">${producto.medida}</span>
                        </div>
                    </div>
                    
                    <div class="product-details-grid">
                        <div class="product-detail-item">
                            <span class="product-detail-label">Borde</span>
                            <span class="product-detail-value">${producto.borde}</span>
                        </div>
                        <div class="product-detail-item">
                            <span class="product-detail-label">Calidad</span>
                            <span class="product-detail-value">${producto.calidad}</span>
                        </div>
                    </div>
                    
                    <div class="product-actions">
                        <button class="product-btn asesor" ${agregadoParaAsesor ? 'disabled' : ''} onclick="agregarParaAsesor('${producto.id}')" aria-label="${agregadoParaAsesor ? 'Material ya agregado para consultar' : 'Agregar ' + producto.nombre + ' para consultar con asesor'}">
                            <i class="fas fa-plus-circle"></i> ${agregadoParaAsesor ? 'Agregado' : 'Cotizar'}
                        </button>
                        <button class="product-btn view" onclick="verDetallesProducto('${producto.id}')" aria-label="Ver detalles de ${producto.nombre}">
                            <i class="fas fa-eye"></i> Detalles
                        </button>
                        <button class="product-btn share" onclick="compartirProducto('${producto.id}')" aria-label="Compartir ${producto.nombre}" style="background: linear-gradient(135deg, #584038, #3d2c25); color: white; flex: 0.5;">
                            <i class="fas fa-share-alt"></i>
                        </button>
                    </div>
                </div>
            `;
            
            return tarjeta;
        }

        function renderizarPaginacion() {
            const paginacion = document.getElementById('pagination');
            if (!paginacion) return;
            
            const totalPaginas = Math.ceil(productosFiltrados.length / productosPorPagina);
            
            if (totalPaginas <= 1) {
                paginacion.innerHTML = '';
                return;
            }
            
            let htmlPaginacion = '';
            
            htmlPaginacion += `
                <button class="page-btn ${paginaActual === 1 ? 'disabled' : ''}" 
                        onclick="cambiarPagina(${paginaActual - 1})"
                        ${paginaActual === 1 ? 'disabled aria-disabled="true"' : ''}
                        aria-label="Página anterior">
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            for (let i = 1; i <= totalPaginas; i++) {
                if (i === 1 || i === totalPaginas || (i >= paginaActual - 1 && i <= paginaActual + 1)) {
                    htmlPaginacion += `
                        <button class="page-btn ${i === paginaActual ? 'active' : ''}" 
                                onclick="cambiarPagina(${i})"
                                aria-label="Página ${i}"
                                ${i === paginaActual ? 'aria-current="page"' : ''}>
                            ${i}
                        </button>
                    `;
                } else if (i === paginaActual - 2 || i === paginaActual + 2) {
                    htmlPaginacion += `<span class="page-btn disabled">...</span>`;
                }
            }
            
            htmlPaginacion += `
                <button class="page-btn ${paginaActual === totalPaginas ? 'disabled' : ''}" 
                        onclick="cambiarPagina(${paginaActual + 1})"
                        ${paginaActual === totalPaginas ? 'disabled aria-disabled="true"' : ''}
                        aria-label="Página siguiente">
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            paginacion.innerHTML = htmlPaginacion;
            
            // Configurar navegación por teclado en paginación
            paginacion.querySelectorAll('.page-btn:not(.disabled)').forEach(btn => {
                btn.addEventListener('keydown', function(e) {
                    const buttons = Array.from(paginacion.querySelectorAll('.page-btn:not(.disabled)'));
                    const currentIndex = buttons.indexOf(this);
                    
                    if (e.key === 'ArrowRight' && currentIndex < buttons.length - 1) {
                        e.preventDefault();
                        buttons[currentIndex + 1].focus();
                    } else if (e.key === 'ArrowLeft' && currentIndex > 0) {
                        e.preventDefault();
                        buttons[currentIndex - 1].focus();
                    } else if (e.key === 'Home') {
                        e.preventDefault();
                        buttons[0].focus();
                    } else if (e.key === 'End') {
                        e.preventDefault();
                        buttons[buttons.length - 1].focus();
                    }
                });
            });
        }

        function cambiarPagina(pagina) {
            const totalPaginas = Math.ceil(productosFiltrados.length / productosPorPagina);
            
            if (pagina < 1 || pagina > totalPaginas || pagina === paginaActual) return;
            
            paginaActual = pagina;
            renderizarProductos();
            
            const productsSection = document.getElementById('products');
            if (productsSection) {
                productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // Enfocar el primer producto de la nueva página
            setTimeout(() => {
                const firstProduct = document.querySelector('.product-card');
                if (firstProduct) firstProduct.focus();
            }, 300);
        }

        function actualizarEstadisticasProductos() {
            const contadorProductos = document.getElementById('products-count');
            const estadisticasProductos = document.getElementById('products-stats');
            const productosFiltradosCount = document.getElementById('productos-filtrados-count');
            
            if (contadorProductos) {
                contadorProductos.textContent = productosFiltrados.length;
            }
            
            if (estadisticasProductos) {
                const indiceInicio = (paginaActual - 1) * productosPorPagina + 1;
                const indiceFin = Math.min(paginaActual * productosPorPagina, productosFiltrados.length);
                
                if (productosFiltrados.length > 0) {
                    estadisticasProductos.textContent = `Mostrando ${indiceInicio}-${indiceFin} de ${productosFiltrados.length} materiales`;
                } else {
                    estadisticasProductos.textContent = 'No hay materiales que coincidan';
                }
            }
            
            if (productosFiltradosCount) {
                if (productosFiltrados.length === productos.length) {
                    productosFiltradosCount.textContent = 'Mostrando todos los materiales';
                } else {
                    productosFiltradosCount.textContent = `${productosFiltrados.length} materiales encontrados`;
                }
            }
        }

        // ===== MODALES =====
        function inicializarModales() {
            // Configurar botón WhatsApp flotante
            const whatsappFloat = document.getElementById('whatsapp-float');
            
            if (whatsappFloat) {
                whatsappFloat.addEventListener('click', function() {
                    abrirModalProductosSeleccionados();
                });
            }
                        
            // Modal de favoritos
            const modalFavoritos = document.getElementById('favoritos-modal');
            
            document.getElementById('header-favoritos').addEventListener('click', abrirModalFavoritos);
            document.getElementById('mobile-menu-favoritos').addEventListener('click', function(e) {
                e.preventDefault();
                abrirModalFavoritos();
            });
            document.getElementById('close-favoritos-modal').addEventListener('click', cerrarModalFavoritos);
            document.getElementById('agregar-favoritos-consulta').addEventListener('click', agregarFavoritosAConsulta);
            document.getElementById('limpiar-favoritos').addEventListener('click', limpiarFavoritos);
            
            if (modalFavoritos) {
                modalFavoritos.addEventListener('click', function(e) {
                    if (e.target === modalFavoritos) {
                        cerrarModalFavoritos();
                    }
                });
            }
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const productosModal = document.getElementById('productos-seleccionados-modal');
                    if (productosModal && productosModal.classList.contains('activo')) {
                        cerrarProductosSeleccionadosModal();
                    }
                    
                    const asesorModal = document.getElementById('asesor-seleccion-modal');
                    if (asesorModal && asesorModal.classList.contains('activo')) {
                        cerrarAsesorSeleccionModal();
                    }
                    
                    if (modalFavoritos && modalFavoritos.classList.contains('activo')) {
                        cerrarModalFavoritos();
                    }
                    
                    const detalleModal = document.getElementById('detalle-producto-modal');
                    if (detalleModal && detalleModal.classList.contains('activo')) {
                        cerrarDetalleProductoModal();
                    }
                    
                    const compartirModal = document.getElementById('compartir-modal');
                    if (compartirModal && compartirModal.classList.contains('activo')) {
                        cerrarCompartirModal();
                    }
                    
                    const filtrosOverlay = document.getElementById('filtros-overlay');
                    if (filtrosOverlay && filtrosOverlay.classList.contains('activo')) {
                        cerrarFiltrosMovil();
                    }
                }
            });
        }

        // ===== PRODUCTOS SELECCIONADOS =====
        function abrirModalProductosSeleccionados() {
            console.log('Abrir modal - Productos en lista:', productosParaAsesor.length);
            
            // Verificar si hay productos
            if (productosParaAsesor.length === 0) {
                mostrarToast('Agrega materiales para solicitar cotización');
                return;
            }
            
            const modal = document.getElementById('productos-seleccionados-modal');
            const lista = document.getElementById('productos-seleccionados-list');
            const total = document.getElementById('productos-seleccionados-total');
            const btnContinuar = document.getElementById('btn-continuar-asesor');
            
            if (!modal || !lista) {
                console.error('Elementos del modal no encontrados');
                return;
            }
            
            // Inmediatamente habilitar el botón si hay productos
            if (btnContinuar) {
                btnContinuar.disabled = false;
                btnContinuar.style.opacity = '1';
                btnContinuar.style.cursor = 'pointer';
            }
            
            // Mostrar modal inmediatamente (vacío primero)
            modal.classList.add('activo');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            
            // Mostrar mensaje de carga mientras se genera el contenido
            lista.innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <div class="loading-spinner" style="width: 40px; height: 40px; border: 3px solid var(--gray-light); border-top: 3px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                    <p style="margin-top: 15px; color: var(--text-light);">Cargando materiales...</p>
                </div>
            `;
            
            if (total) {
                total.textContent = productosParaAsesor.length;
            }
            
            // Generar contenido después de un pequeño delay (para animación suave)
            setTimeout(() => {
                generarContenidoModal(lista, total, btnContinuar);
                
                // Enfocar después de cargar
                setTimeout(() => {
                    if (btnContinuar) {
                        btnContinuar.focus();
                    }
                }, 50);
                
            }, 100); // Solo 100ms de delay
        }

        // ===== FUNCIÓN PARA GENERAR CONTENIDO DEL MODAL =====
        function generarContenidoModal(lista, total, btnContinuar) {
            let htmlLista = '';
            let contadorValidos = 0;
            
            productosParaAsesor.forEach((item, index) => {
                const producto = productos.find(p => p.id === item.id);
                if (producto) {
                    contadorValidos++;
                    const precioTexto = producto.precio > 0 ? 
                        `S/. ${producto.precio.toFixed(2)} x ${producto.unidad}` : 
                        'Consultar precio';
                    
                    htmlLista += `
                        <div class="producto-seleccionado-item" data-id="${producto.id}">
                            <img src="${producto.imagenes[0] || 'https://via.placeholder.com/60x60/f5f5f5/333?text=Mármol'}" 
                                alt="${producto.nombre}"
                                width="60"
                                height="60"
                                onerror="this.src='https://via.placeholder.com/60x60/f5f5f5/333?text=Mármol'">
                            <div class="producto-seleccionado-info">
                                <h5>${producto.nombre}</h5>
                                <p>${producto.familia} - ${producto.material}</p>
                                <span class="producto-seleccionado-price">${precioTexto}</span>
                            </div>
                            <button class="producto-seleccionado-remover" 
                                    onclick="removerProductoSeleccionado('${producto.id}')" 
                                    aria-label="Eliminar ${producto.nombre}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                }
            });
            
            // Si no se encontraron productos válidos
            if (contadorValidos === 0) {
                htmlLista = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-light);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Error al cargar los productos</p>
                        <button class="btn btn-primary" onclick="cerrarProductosSeleccionadosModal()" style="margin-top: 15px;">
                            Cerrar
                        </button>
                    </div>
                `;
                
                // Deshabilitar botón si no hay productos válidos
                if (btnContinuar) {
                    btnContinuar.disabled = true;
                    btnContinuar.style.opacity = '0.6';
                    btnContinuar.style.cursor = 'not-allowed';
                }
            } else {
                // Asegurar que el botón esté habilitado
                if (btnContinuar) {
                    btnContinuar.disabled = false;
                    btnContinuar.style.opacity = '1';
                    btnContinuar.style.cursor = 'pointer';
                }
            }
            
            // Actualizar lista con animación suave
            lista.style.opacity = '0.7';
            lista.style.transition = 'opacity 0.2s ease';
            
            setTimeout(() => {
                lista.innerHTML = htmlLista;
                
                if (total && contadorValidos > 0) {
                    total.textContent = contadorValidos;
                }
                
                setTimeout(() => {
                    lista.style.opacity = '1';
                }, 50);
                
            }, 150);
        }

        function cerrarProductosSeleccionadosModal() {
            const modal = document.getElementById('productos-seleccionados-modal');
            if (modal) {
                modal.classList.remove('activo');
                modal.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
                
                // Enfocar el botón que abrió el modal
                document.getElementById('whatsapp-float').focus();
            }
        }

        function removerProductoSeleccionado(idProducto) {
            const indice = productosParaAsesor.findIndex(item => item.id === idProducto);
            
            if (indice !== -1) {
                // Eliminar del array
                productosParaAsesor.splice(indice, 1);
                
                // Actualizar estado del producto
                const producto = productos.find(p => p.id === idProducto);
                if (producto) {
                    producto.agregadoParaAsesor = false;
                }
                
                // Guardar cambios
                guardarProductosAsesor();
                actualizarContadorAsesor();
                
                // ⬇️ AÑADIR ACTUALIZACIÓN DE INTERFAZ ⬇️
                actualizarInterfazDespuesDeEliminar();
                
                // Cerrar modal si no quedan productos
                if (productosParaAsesor.length === 0) {
                    cerrarProductosSeleccionadosModal();
                    mostrarToast('Todos los materiales eliminados');
                } else {
                    // Actualizar el modal actual
                    actualizarModalProductosSeleccionados();
                    mostrarToast('Material eliminado de la lista');
                }
            }
        }

        // ===== FUNCIÓN PARA ACTUALIZAR INTERFAZ DESPUÉS DE ELIMINAR =====
        function actualizarInterfazDespuesDeEliminar() {
            // 1. Actualizar botones en las tarjetas de producto
            productos.forEach(producto => {
                const tarjeta = document.querySelector(`.product-card[data-id="${producto.id}"]`);
                if (tarjeta) {
                    const botonAsesor = tarjeta.querySelector('.product-btn.asesor');
                    if (botonAsesor) {
                        if (producto.agregadoParaAsesor) {
                            botonAsesor.disabled = false;
                            botonAsesor.innerHTML = '<i class="fas fa-plus-circle"></i> Cotizar';
                            botonAsesor.setAttribute('aria-label', `Agregar ${producto.nombre} para consultar con asesor`);
                        } else {
                            botonAsesor.disabled = false;
                            botonAsesor.innerHTML = '<i class="fas fa-plus-circle"></i> Cotizar';
                            botonAsesor.removeAttribute('aria-label');
                        }
                    }
                }
            });
            
            // 2. Actualizar contadores
            actualizarContadorAsesor();
            
            // 3. Si el modal de productos está abierto, actualizarlo
            const modalProductos = document.getElementById('productos-seleccionados-modal');
            if (modalProductos && modalProductos.classList.contains('activo')) {
                actualizarModalProductosSeleccionados();
            }
            
            // 4. Si el modal de asesor está abierto, actualizar la vista previa
            const modalAsesor = document.getElementById('asesor-seleccion-modal');
            if (modalAsesor && modalAsesor.classList.contains('activo')) {
                actualizarVistaPreviaAsesor();
            }
        }

        // ===== FUNCIÓN PARA ACTUALIZAR MODAL DE PRODUCTOS SELECCIONADOS =====
        function actualizarModalProductosSeleccionados() {
            const modal = document.getElementById('productos-seleccionados-modal');
            const lista = document.getElementById('productos-seleccionados-list');
            const total = document.getElementById('productos-seleccionados-total');
            const btnContinuar = document.getElementById('btn-continuar-asesor');
            
            if (!modal || !lista || !total) return;
            
            // Solo actualizar si el modal está abierto
            if (!modal.classList.contains('activo')) return;
            
            // Generar nueva lista HTML
            let htmlLista = '';
            let totalProductos = 0;
            
            if (productosParaAsesor.length === 0) {
                htmlLista = `
                    <div class="empty-state" style="padding: 40px 20px; text-align: center;">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; color: var(--gray-dark); margin-bottom: 15px;"></i>
                        <h3 style="color: var(--text-light); margin-bottom: 10px;">No hay materiales seleccionados</h3>
                        <p style="color: var(--gray-dark);">Agrega materiales para solicitar cotización</p>
                    </div>
                `;
                
                if (btnContinuar) {
                    btnContinuar.disabled = true;
                    btnContinuar.style.opacity = '0.6';
                    btnContinuar.style.cursor = 'not-allowed';
                }
            } else {
                productosParaAsesor.forEach((item, index) => {
                    const producto = productos.find(p => p.id === item.id);
                    if (producto) {
                        totalProductos++;
                        const precioTexto = producto.precio > 0 ? 
                            `S/. ${producto.precio.toFixed(2)} x ${producto.unidad}` : 
                            'Consultar precio';
                        
                        htmlLista += `
                            <div class="producto-seleccionado-item" data-id="${producto.id}">
                                <img src="${producto.imagenes[0]}" alt="${producto.nombre}"
                                    width="60"
                                    height="60"
                                    onerror="this.src='https://via.placeholder.com/60x60/f5f5f5/333?text=Mármol'">
                                <div class="producto-seleccionado-info">
                                    <h5>${producto.nombre}</h5>
                                    <p>${producto.familia} - ${producto.material}</p>
                                    <span class="producto-seleccionado-price">${precioTexto}</span>
                                </div>
                                <button class="producto-seleccionado-remover" 
                                        onclick="removerProductoSeleccionado('${producto.id}')" 
                                        aria-label="Eliminar ${producto.nombre} de la lista">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    }
                });
                
                if (btnContinuar) {
                    btnContinuar.disabled = false;
                    btnContinuar.style.opacity = '1';
                    btnContinuar.style.cursor = 'pointer';
                }
            }
            
            // Actualizar DOM con animación suave
            lista.style.opacity = '0.7';
            lista.style.transition = 'opacity 0.3s ease';
            
            setTimeout(() => {
                lista.innerHTML = htmlLista;
                total.textContent = totalProductos;
                
                setTimeout(() => {
                    lista.style.opacity = '1';
                }, 50);
            }, 150);
            
            // Actualizar botón flotante de WhatsApp
            actualizarContadorAsesor();
        }

        // ===== FUNCIÓN PARA ACTUALIZAR VISTA PREVIA EN MODAL ASESOR =====
        function actualizarVistaPreviaAsesor() {
            const preview = document.getElementById('productos-consulta-preview');
            const acciones = document.getElementById('asesor-acciones');
            const btnContactar = document.getElementById('contactar-asesor');
            
            if (!preview) return;
            
            let htmlPreview = '';
            
            if (productosParaAsesor.length === 0) {
                htmlPreview = `
                    <div style="text-align: center; padding: 20px; color: var(--text-light);">
                        <i class="fas fa-exclamation-circle" style="font-size: 1.5rem; margin-bottom: 10px;"></i>
                        <p>No hay materiales para cotizar</p>
                    </div>
                `;
                
                if (acciones) acciones.style.display = 'none';
                if (btnContactar) btnContactar.disabled = true;
            } else {
                productosParaAsesor.slice(0, 3).forEach((item, index) => {
                    const producto = productos.find(p => p.id === item.id);
                    if (producto) {
                        htmlPreview += `
                            <div class="producto-seleccionado-item">
                                <img src="${producto.imagenes[0]}" alt="${producto.nombre}"
                                    width="40"
                                    height="40"
                                    onerror="this.src='https://via.placeholder.com/40x40/f5f5f5/333?text=Mármol'">
                                <div class="producto-seleccionado-info">
                                    <h5 style="font-size: 0.8rem;">${producto.nombre.substring(0, 30)}...</h5>
                                </div>
                            </div>
                        `;
                    }
                });
                
                if (productosParaAsesor.length > 3) {
                    htmlPreview += `<div style="text-align: center; padding: 10px; color: var(--text-light); font-size: 0.8rem;">y ${productosParaAsesor.length - 3} más...</div>`;
                }
                
                if (acciones) acciones.style.display = 'flex';
                if (btnContactar) btnContactar.disabled = false;
            }
            
            preview.innerHTML = htmlPreview;
        }

        function continuarConAsesor() {
            cerrarProductosSeleccionadosModal();
            setTimeout(() => {
                abrirModalAsesorSeleccion();
            }, 300);
        }

        // ===== ASESORES =====
        function abrirModalAsesorSeleccion() {
            if (productosParaAsesor.length === 0) {
                mostrarToast('Agrega materiales para solicitar cotización');
                return;
            }
            
            const modal = document.getElementById('asesor-seleccion-modal');
            const contenido = document.getElementById('asesor-contenido');
            const acciones = document.getElementById('asesor-acciones');
            const preview = document.getElementById('productos-consulta-preview');
            
            // Actualizar vista previa de productos
            let htmlPreview = '';
            productosParaAsesor.slice(0, 3).forEach((item, index) => {
                const producto = productos.find(p => p.id === item.id);
                if (producto) {
                    htmlPreview += `
                        <div class="producto-seleccionado-item">
                            <img src="${producto.imagenes[0]}" alt="${producto.nombre}"
                                 width="40"
                                 height="40"
                                 onerror="this.src='https://via.placeholder.com/40x40/f5f5f5/333?text=Mármol'">
                            <div class="producto-seleccionado-info">
                                <h5 style="font-size: 0.8rem;">${producto.nombre.substring(0, 30)}...</h5>
                            </div>
                        </div>
                    `;
                }
            });
            
            if (productosParaAsesor.length > 3) {
                htmlPreview += `<div style="text-align: center; padding: 10px; color: var(--text-light); font-size: 0.8rem;">y ${productosParaAsesor.length - 3} más...</div>`;
            }
            
            preview.innerHTML = htmlPreview;
            
            // Resetear selecciones
            tipoClienteSeleccionado = null;
            asesorSeleccionado = null;
            
            // Limpiar contenido anterior
            contenido.innerHTML = '';
            acciones.style.display = 'none';
            
            // Cargar tipo de cliente guardado si existe
            if (tipoClienteSeleccionado) {
                const radio = document.querySelector(`input[value="${tipoClienteSeleccionado}"]`);
                if (radio) radio.checked = true;
                seleccionarTipoCliente(tipoClienteSeleccionado);
            }
            
            modal.classList.add('activo');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            
            // Enfocar el primer radio button
            setTimeout(() => {
                const firstRadio = document.querySelector('input[name="tipo-cliente"]');
                if (firstRadio) firstRadio.focus();
            }, 100);
        }

        function cerrarAsesorSeleccionModal() {
            const modal = document.getElementById('asesor-seleccion-modal');
            if (modal) {
                modal.classList.remove('activo');
                modal.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
                
                // Volver a productos seleccionados
                setTimeout(() => {
                    abrirModalProductosSeleccionados();
                }, 300);
            }
        }

        function seleccionarTipoCliente(tipo) {
            tipoClienteSeleccionado = tipo;
            guardarTipoCliente(tipo);
            
            const contenido = document.getElementById('asesor-contenido');
            const acciones = document.getElementById('asesor-acciones');
            
            if (tipo === 'nuevo') {
                // Asignar asesor aleatorio
                const asesorAleatorio = obtenerAsesorAleatorio();
                asesorSeleccionado = asesorAleatorio;
                
                contenido.innerHTML = `
                    <div class="asesor-card" style="margin-top: 20px; cursor: default;">
                        <img src="${asesorAleatorio.foto}" alt="Foto de ${asesorAleatorio.nombre}" class="asesor-avatar"
                            width="60"
                            height="60"
                            onerror="this.src='https://via.placeholder.com/60x60/f5f5f5/333?text=Asesor'">
                        <div class="asesor-info">
                            <h4>${asesorAleatorio.nombre}</h4>
                            <p>${asesorAleatorio.especialidad}</p>
                            <p><small><i class="fas fa-random"></i> Asignado aleatoriamente</small></p>
                        </div>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-light);">
                        <i class="fas fa-info-circle"></i> Como cliente nuevo, se te ha asignado un asesor disponible para atender tu consulta.
                    </p>
                `;
                
            } else if (tipo === 'existente') {
                // Mostrar lista de todos los asesores
                let htmlAsesores = `
                    <div style="margin-top: 20px;">
                        <p style="margin-bottom: 15px; font-size: 0.9rem; color: var(--text-color);">
                            <i class="fas fa-info-circle"></i> Selecciona el asesor con el que deseas contactarte:
                        </p>
                `;
                
                asesores.forEach(asesor => {
                    htmlAsesores += `
                        <div class="asesor-card ${asesorSeleccionado && asesorSeleccionado.id === asesor.id ? 'selected' : ''}" 
                             data-id="${asesor.id}" 
                             onclick="seleccionarAsesor('${asesor.id}')"
                             tabindex="0"
                             onkeydown="if(event.key === 'Enter' || event.key === ' ') seleccionarAsesor('${asesor.id}')">
                            <img src="${asesor.foto}" alt="Foto de ${asesor.nombre}" class="asesor-avatar"
                                width="60"
                                height="60"
                                onerror="this.src='https://via.placeholder.com/60x60/f5f5f5/333?text=Asesor'">
                            <div class="asesor-info">
                                <h4>${asesor.nombre}</h4>
                                <p>${asesor.especialidad}</p>
                            </div>
                            <div style="width: 20px; height: 20px; border-radius: 50%; border: 2px solid ${asesorSeleccionado && asesorSeleccionado.id === asesor.id ? 'var(--primary-color)' : 'var(--gray-medium)'}; 
                                 background-color: ${asesorSeleccionado && asesorSeleccionado.id === asesor.id ? 'var(--primary-color)' : 'transparent'};">
                                ${asesorSeleccionado && asesorSeleccionado.id === asesor.id ? '<i class="fas fa-check" style="color: white; font-size: 10px; display: flex; align-items: center; justify-content: center; height: 100%;"></i>' : ''}
                            </div>
                        </div>
                    `;
                });
                
                htmlAsesores += `</div>`;
                contenido.innerHTML = htmlAsesores;
                
                // Seleccionar primer asesor por defecto si no hay selección
                if (!asesorSeleccionado && asesores.length > 0) {
                    seleccionarAsesor(asesores[0].id);
                }
            }
            
            acciones.style.display = 'flex';
            
            // Enfocar el botón de contacto
            setTimeout(() => {
                document.getElementById('contactar-asesor').focus();
            }, 100);
        }

        function obtenerAsesorAleatorio() {
            if (asesores.length === 0) {
                return null;
            }
            
            // Selección aleatoria uniforme
            const indiceAleatorio = Math.floor(Math.random() * asesores.length);
            return asesores[indiceAleatorio];
        }

        function seleccionarAsesor(id) {
            const asesor = asesores.find(a => a.id == id);
            if (!asesor) return;
            
            asesorSeleccionado = asesor;
            
            // Actualizar interfaz
            document.querySelectorAll('.asesor-card').forEach(card => {
                const check = card.querySelector('div[style*="border-radius: 50%"]');
                if (check) {
                    if (card.getAttribute('data-id') == id) {
                        card.classList.add('selected');
                        check.style.backgroundColor = 'var(--primary-color)';
                        check.style.borderColor = 'var(--primary-color)';
                        check.innerHTML = '<i class="fas fa-check" style="color: white; font-size: 10px; display: flex; align-items: center; justify-content: center; height: 100%;"></i>';
                    } else {
                        card.classList.remove('selected');
                        check.style.backgroundColor = '';
                        check.style.borderColor = 'var(--gray-medium)';
                        check.innerHTML = '';
                    }
                }
            });
        }

        function contactarAsesorSeleccionado() {
            if (!asesorSeleccionado) {
                mostrarToast('Por favor, selecciona un asesor');
                return;
            }
            
            const mensaje = generarMensajeWhatsApp();
            const urlWhatsApp = `https://wa.me/${asesorSeleccionado.celular}?text=${encodeURIComponent(mensaje)}`;
            
            // Limpiar productos para asesor después de contactar
            productosParaAsesor.forEach(item => {
                const producto = productos.find(p => p.id === item.id);
                if (producto) {
                    producto.agregadoParaAsesor = false;
                }
            });
            
            productosParaAsesor = [];
            guardarProductosAsesor();
            actualizarContadorAsesor();
            renderizarProductos();
            
            // Abrir WhatsApp
            window.open(urlWhatsApp, '_blank');
            
            cerrarAsesorSeleccionModal();
            mostrarToast('¡Mensaje preparado para WhatsApp!');
        }

        function generarMensajeWhatsApp() {
            try {
                const nombreAsesor = asesorSeleccionado ? asesorSeleccionado.nombre : "equipo";
                
                let mensaje = `GALLOS MÁRMOL - SOLICITUD DE COTIZACIÓN\n\n`;
                mensaje += `¡Hola ${nombreAsesor}!\n`;
                mensaje += `Me interesa los siguientes productos:\n\n`;
                
                // Lista compacta de productos
                productosParaAsesor.forEach((item, index) => {
                    const producto = productos.find(p => p.id === item.id);
                    if (producto) {
                        mensaje += `${index + 1}. ${producto.nombre}\n`;
                        mensaje += `${producto.codigo} | ${producto.medida}\n`;
                        
                        if (producto.precio > 0) {
                            mensaje += `S/. ${producto.precio.toFixed(2)} x ${producto.unidad}`;
                            mensaje += `\n`;
                        } else {
                            mensaje += ` Consultar Precio\n`;
                        }
                        mensaje += `\n`;
                    }
                });
                
                mensaje += `\n*Resumen: ${productosParaAsesor.length} materiales seleccionados\n\n`;
                
                // Solicitud específica
                mensaje += `Solicito:*\n`;
                mensaje += `• Cotización formal detallada\n`;
                mensaje += `• Disponibilidad y stock\n`;
                mensaje += `• Tiempos de entrega\n`;
                mensaje += `• Términos de pago\n\n`;
                
                mensaje += `\n*Gallos Mármol Outlet 2025*`;
                
                return mensaje;
                
            } catch (error) {
                console.error('Error al generar mensaje WhatsApp:', error);
                return "¡Hola! Solicito cotización de materiales Gallos Mármol. ¡Gracias!";
            }
        }

        // ===== AGREGAR PRODUCTO PARA ASESOR =====
        function agregarParaAsesor(idProducto) {
            const producto = productos.find(p => p.id === idProducto);
            if (!producto) {
                mostrarError('Material no encontrado');
                return;
            }
            
            // Verificar si ya está en la lista
            const indiceExistente = productosParaAsesor.findIndex(item => item.id === idProducto);
            
            if (indiceExistente !== -1) {
                // Ya está agregado, no hacer nada
                return;
            }
            
            // Agregar producto con todos sus atributos predefinidos
            const productoAsesor = {
                id: producto.id,
                codigo: producto.codigo,
                nombre: producto.nombre,
                familia: producto.familia,
                material: producto.material,
                acabado: producto.acabado,
                medida: producto.medida,
                borde: producto.borde,
                calidad: producto.calidad,
                unidad: producto.unidad,
                precio: producto.precio,
                descuento: producto.descuento
            };
            
            productosParaAsesor.push(productoAsesor);
            producto.agregadoParaAsesor = true;
            
            guardarProductosAsesor();
            actualizarContadorAsesor();
            renderizarProductos();
            
            mostrarToast('Material agregado para cotización');
        }

        // ===== FAVORITOS =====
        function abrirModalFavoritos() {
            const modal = document.getElementById('favoritos-modal');
            const listaFavoritos = document.getElementById('favoritos-list');
            
            if (!modal || !listaFavoritos) return;
            
            if (productosFavoritos.length === 0) {
                listaFavoritos.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-heart"></i>
                        <h3>No tienes favoritos aún</h3>
                        <p>Agrega materiales a tus favoritos haciendo clic en el corazón</p>
                    </div>
                `;
            } else {
                let htmlFavoritos = '';
                
                productosFavoritos.forEach(id => {
                    const producto = productos.find(p => p.id === id);
                    if (producto) {
                        const precioTexto = producto.precio > 0 ? `S/. ${producto.precio.toFixed(2)} x ${producto.unidad}` : 'Consultar precio';
                        
                        htmlFavoritos += `
                            <div class="favorito-item" data-id="${producto.id}">
                                <img src="${producto.imagenes[0]}" alt="${producto.nombre}"
                                     width="80"
                                     height="80"
                                     onerror="this.src='https://via.placeholder.com/80x80/f5f5f5/333?text=Mármol'">
                                <div class="favorito-info">
                                    <h4>${producto.nombre}</h4>
                                    <p>${producto.familia} - ${producto.material}</p>
                                    <span class="favorito-code">${producto.codigo}</span>
                                    <small><strong>${precioTexto}</strong></small>
                                </div>
                                <div class="favorito-actions">
                                    <button class="favorito-btn consultar" onclick="agregarParaAsesor('${producto.id}'); cerrarModalFavoritos()" aria-label="Solicitar cotización de ${producto.nombre}">
                                        <i class="fas fa-file-invoice-dollar"></i> Cotizar
                                    </button>
                                    <button class="favorito-btn favorito-remove" onclick="removerDeFavoritos('${producto.id}')" aria-label="Eliminar ${producto.nombre} de favoritos">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                });
                
                listaFavoritos.innerHTML = htmlFavoritos;
            }
            
            modal.classList.add('activo');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            
            // Enfocar el primer favorito o el botón de limpiar
            setTimeout(() => {
                const firstFavorito = document.querySelector('.favorito-btn');
                if (firstFavorito) {
                    firstFavorito.focus();
                }
            }, 100);
        }

        function cerrarModalFavoritos() {
            const modal = document.getElementById('favoritos-modal');
            if (modal) {
                modal.classList.remove('activo');
                modal.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
                
                // Enfocar el botón que abrió el modal
                document.getElementById('header-favoritos').focus();
            }
        }

        function agregarFavoritosAConsulta() {
            if (productosFavoritos.length === 0) {
                mostrarToast('No hay materiales en favoritos');
                return;
            }
            
            // Agregar todos los favoritos a la lista de consulta
            productosFavoritos.forEach(id => {
                const producto = productos.find(p => p.id === id);
                if (producto && !producto.agregadoParaAsesor) {
                    agregarParaAsesor(id);
                }
            });
            
            cerrarModalFavoritos();
            abrirModalProductosSeleccionados();
        }

        function limpiarFavoritos() {
            productosFavoritos = [];
            
            productos.forEach(producto => {
                producto.enFavoritos = false;
            });
            
            guardarFavoritos();
            actualizarContadorFavoritos();
            cerrarModalFavoritos();
            renderizarProductos();
            mostrarToast('Favoritos limpiados');
        }

        // ===== INTERACCIÓN DEL USUARIO =====
        function alternarFavorito(idProducto) {
            const producto = productos.find(p => p.id === idProducto);
            if (!producto) return;
            
            const indice = productosFavoritos.indexOf(idProducto);
            
            if (indice === -1) {
                productosFavoritos.push(idProducto);
                producto.enFavoritos = true;
                mostrarToast('Añadido a favoritos');
            } else {
                productosFavoritos.splice(indice, 1);
                producto.enFavoritos = false;
                mostrarToast('Eliminado de favoritos');
            }
            
            guardarFavoritos();
            actualizarContadorFavoritos();
            renderizarProductos();
        }

        function removerDeFavoritos(idProducto) {
            const indice = productosFavoritos.indexOf(idProducto);
            
            if (indice !== -1) {
                productosFavoritos.splice(indice, 1);
                
                const producto = productos.find(p => p.id === idProducto);
                if (producto) {
                    producto.enFavoritos = false;
                }
                
                guardarFavoritos();
                actualizarContadorFavoritos();
                abrirModalFavoritos();
                mostrarToast('Eliminado de favoritos');
            }
        }

        // ===== COMPARTIR PRODUCTO =====
        function compartirProducto(idProducto) {
            const producto = productos.find(p => p.id === idProducto);
            if (!producto) return;
            
            productoParaCompartir = producto;
            
            // Generar URL completa con parámetros
            const urlBase = window.location.origin + window.location.pathname;
            const urlProducto = `${urlBase}?producto=${producto.id}&ref=share`;
            
            // Guardar en el input de compartir
            const urlInput = document.getElementById('compartir-url-input');
            if (urlInput) {
                urlInput.value = urlProducto;
            }
            
            abrirCompartirModal();
        }

        function abrirCompartirModal() {
            if (!productoParaCompartir) return;
            
            const modal = document.getElementById('compartir-modal');
            const opciones = document.getElementById('compartir-opciones');
            const urlInput = document.getElementById('compartir-url-input');
            
            if (!modal || !opciones || !urlInput) return;
            
            // Generar enlace único
            const urlBase = window.location.origin + window.location.pathname;
            const urlProducto = `${urlBase}?producto=${productoParaCompartir.id}`;
            urlInput.value = urlProducto;
            
            // Opciones de compartir
            const opcionesCompartir = [
                { nombre: 'WhatsApp', icono: 'fab fa-whatsapp', color: '#25D366' },
                { nombre: 'Facebook', icono: 'fab fa-facebook', color: '#1877F2' },
                { nombre: 'Correo', icono: 'fas fa-envelope', color: '#EA4335' },
                { nombre: 'Copiar', icono: 'fas fa-copy', color: '#6c757d' }
            ];
            
            let htmlOpciones = '';
            opcionesCompartir.forEach(opcion => {
                htmlOpciones += `
                    <div class="compartir-opcion" onclick="compartirPor('${opcion.nombre.toLowerCase()}')" 
                         style="border-color: ${opcion.color};" tabindex="0"
                         onkeydown="if(event.key === 'Enter' || event.key === ' ') compartirPor('${opcion.nombre.toLowerCase()}')">
                        <i class="${opcion.icono}" style="color: ${opcion.color};"></i>
                        <span>${opcion.nombre}</span>
                    </div>
                `;
            });
            
            opciones.innerHTML = htmlOpciones;
            
            modal.classList.add('activo');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            
            // Enfocar primera opción
            setTimeout(() => {
                const primeraOpcion = opciones.querySelector('.compartir-opcion');
                if (primeraOpcion) primeraOpcion.focus();
            }, 100);
        }

        function cerrarCompartirModal() {
            const modal = document.getElementById('compartir-modal');
            if (modal) {
                modal.classList.remove('activo');
                modal.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
                
                productoParaCompartir = null;
            }
        }

        // ===== FUNCIÓN COMPARTIR POR REDES SOCIALES =====
        function compartirPor(metodo) {
            if (!productoParaCompartir) return;
            
            const urlBase = window.location.origin + window.location.pathname;
            const urlProducto = `${urlBase}?producto=${productoParaCompartir.id}&ref=share`;
            
            // Mensaje mejorado con emojis y formato
            const textoCompartir = 
                `🌟 *GALLOS MÁRMOL - OUTLET 2025* 🌟\n\n` +
                `*${productoParaCompartir.nombre}*\n\n` +
                `📋 *Código:* ${productoParaCompartir.codigo}\n` +
                `🏷️ *Familia:* ${productoParaCompartir.familia}\n` +
                `💎 *Material:* ${productoParaCompartir.material}\n` +
                `✨ *Acabado:* ${productoParaCompartir.acabado}\n` +
                `📏 *Medida:* ${productoParaCompartir.medida}\n` +
                `⚡ *Calidad:* ${productoParaCompartir.calidad}\n` +
                `💰 *Precio:* ${productoParaCompartir.precio > 0 ? 'S/. ' + productoParaCompartir.precio.toFixed(2) + ' x ' + productoParaCompartir.unidad : 'CONSULTAR PRECIO'}\n` +
                `${productoParaCompartir.descuento > 0 ? `🎯 *Descuento:* ${productoParaCompartir.descuento}% OFF\n` : ''}\n` +
                `🔗 *Ver detalles y comprar:*\n${urlProducto}\n\n` +
                `📞 *Contacto:* +51 987 654 321\n` +
                `📍 *Ubicación:* Lima, Perú\n\n` +
                `*¡Oferta especial por tiempo limitado!* 🚀`;
            
            const textoCompartirSimple = 
                `Gallos Mármol - Outlet 2025\n\n` +
                `${productoParaCompartir.nombre}\n` +
                `Código: ${productoParaCompartir.codigo}\n` +
                `Material: ${productoParaCompartir.material}\n` +
                `Precio: ${productoParaCompartir.precio > 0 ? 'S/. ' + productoParaCompartir.precio.toFixed(2) : 'Consultar'}\n\n` +
                `Ver detalles: ${urlProducto}`;
            
            try {
                switch(metodo.toLowerCase()) {
                    case 'whatsapp':
                        // WhatsApp (usa texto con formato)
                        window.open(`https://wa.me/?text=${encodeURIComponent(textoCompartir)}`, '_blank', 'noopener,noreferrer');
                        break;
                        
                    case 'facebook':
                        // Facebook (solo URL)
                        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(urlProducto)}&quote=${encodeURIComponent(productoParaCompartir.nombre + ' - Gallos Mármol Outlet')}`, '_blank', 'noopener,noreferrer');
                        break;
                        
                    case 'correo':
                        // Correo electrónico
                        const subject = `Gallos Mármol - ${productoParaCompartir.nombre}`;
                        const body = `${textoCompartirSimple}\n\n---\nGallos Mármol Outlet 2025\nCalidad premium a precios outlet\n`;
                        window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`, '_blank', 'noopener,noreferrer');
                        break;
                        
                    case 'copiar':
                        // Copiar al portapapeles
                        copiarEnlaceCompartir();
                        return; // No cerrar modal para que vean el mensaje de copiado
                        
                    default:
                        console.error('Método de compartir no reconocido:', metodo);
                        mostrarError('Método no disponible');
                        return;
                }
                
                // Registrar evento de compartir (opcional para analytics)
                console.log(`Producto compartido por ${metodo}:`, productoParaCompartir.codigo);
                
                // Mostrar mensaje de éxito
                mostrarToast(`¡Producto compartido por ${metodo}!`);
                
                // Cerrar modal después de compartir (excepto para copiar)
                if (metodo.toLowerCase() !== 'copiar') {
                    setTimeout(() => {
                        cerrarCompartirModal();
                    }, 500);
                }
                
            } catch (error) {
                console.error(`Error al compartir por ${metodo}:`, error);
                mostrarError(`No se pudo compartir por ${metodo}. Intenta nuevamente.`);
            }
        }

        function copiarEnlaceCompartir() {
            const urlInput = document.getElementById('compartir-url-input');
            if (!urlInput) return;
            
            urlInput.select();
            urlInput.setSelectionRange(0, 99999);
            
            navigator.clipboard.writeText(urlInput.value).then(() => {
                mostrarToast('Enlace copiado al portapapeles');
            }).catch(err => {
                console.error('Error al copiar:', err);
                mostrarError('No se pudo copiar el enlace');
            });
        }

        // ===== DETALLES DE PRODUCTO =====
        function verDetallesProducto(idProducto) {
            const producto = productos.find(p => p.id === idProducto);
            if (!producto) {
                mostrarError('Material no encontrado');
                return;
            }
            
            const modal = document.getElementById('detalle-producto-modal');
            const titulo = document.getElementById('detalle-producto-titulo');
            const contenido = document.getElementById('detalle-producto-contenido');
            
            if (!modal || !titulo || !contenido) {
                mostrarError('Error al cargar el detalle del material');
                return;
            }
            
            titulo.textContent = producto.nombre;
            
            const tienePrecio = producto.precio > 0;
            const precioFormateado = tienePrecio ? `S/. ${producto.precio.toFixed(2)}` : 'Consultar precio';
            const precioUnitario = tienePrecio ? ` x ${producto.unidad}` : '';
            const descuento = producto.descuento > 0 ? producto.descuento : 0;
            const precioOriginal = producto.precioOriginal > 0 ? producto.precioOriginal : 0;
            
            contenido.innerHTML = `
                <div class="producto-slider" id="producto-slider-${producto.id}">
                    <!-- Slider se cargará dinámicamente -->
                </div>
                
                <div class="producto-detalle-info">
                    <span class="producto-detalle-code">${producto.codigo}</span>
                    <h2 class="producto-detalle-titulo">${producto.nombre}</h2>
                    
                    ${tienePrecio ? `
                        <div class="detalle-price-container">
                            <div class="detalle-price">${precioFormateado}</div>
                            <div class="detalle-price-unit">${precioUnitario}</div>
                            ${descuento > 0 ? `
                                <div style="margin-top: 10px;">
                                    <span class="price-badge">-${descuento}% OFF</span>
                                    ${precioOriginal > 0 ? `<span style="font-size: 0.9rem; color: var(--text-light); text-decoration: line-through; margin-left: 10px;">S/. ${precioOriginal.toFixed(2)}</span>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    ` : `
                        <div class="detalle-price-consult">Consultar precio</div>
                    `}
                    
                    <p class="producto-detalle-descripcion">${producto.descripcion}</p>
                    
                    <div class="producto-detalle-especificaciones">
                        <div class="especificacion-grid">
                            <div class="especificacion-item">
                                <span class="especificacion-label">Familia</span>
                                <span class="especificacion-valor">${producto.familia}</span>
                            </div>
                            <div class="especificacion-item">
                                <span class="especificacion-label">Material</span>
                                <span class="especificacion-valor">${producto.material}</span>
                            </div>
                            <div class="especificacion-item">
                                <span class="especificacion-label">Acabado</span>
                                <span class="especificacion-valor">${producto.acabado}</span>
                            </div>
                            <div class="especificacion-item">
                                <span class="especificacion-label">Medida</span>
                                <span class="especificacion-valor">${producto.medida}</span>
                            </div>
                            <div class="especificacion-item">
                                <span class="especificacion-label">Borde</span>
                                <span class="especificacion-valor">${producto.borde}</span>
                            </div>
                            <div class="especificacion-item">
                                <span class="especificacion-label">Calidad</span>
                                <span class="especificacion-valor">${producto.calidad}</span>
                            </div>
                            <div class="especificacion-item">
                                <span class="especificacion-label">Unidad</span>
                                <span class="especificacion-valor">${producto.unidad}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detalle-acciones">
                        <button class="btn btn-primary" onclick="agregarParaAsesor('${producto.id}'); cerrarDetalleProductoModal()" ${producto.agregadoParaAsesor ? 'disabled' : ''} aria-label="${producto.agregadoParaAsesor ? 'Material ya agregado' : 'Solicitar cotización de ' + producto.nombre}">
                            <i class="fas fa-file-invoice-dollar"></i> ${producto.agregadoParaAsesor ? 'Ya Agregado' : 'Cotizar Material'}
                        </button>
                        <button class="btn btn-secondary" onclick="compartirProducto('${producto.id}'); cerrarDetalleProductoModal()" aria-label="Compartir ${producto.nombre}">
                            <i class="fas fa-share-alt"></i> Compartir
                        </button>
                        <button class="btn btn-secondary" onclick="cerrarDetalleProductoModal()" aria-label="Cerrar detalles del material">
                            <i class="fas fa-times"></i> Cerrar
                        </button>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                inicializarSlider(producto.imagenes, `producto-slider-${producto.id}`);
            }, 100);         

            // 1. Resetear scroll del contenido
            if (contenido) {
                contenido.scrollTop = 0;
            }
            
            // 2. Resetear scroll del modal principal
            const modalContent = modal.querySelector('.detalle-producto-contenido');
            if (modalContent) {
                modalContent.scrollTop = 0;
            }            

            modal.classList.add('activo');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';

            // 4. Forzar scroll al inicio después de abrir
            setTimeout(() => {
                if (contenido) {
                    contenido.scrollTo({ top: 0, behavior: 'instant' });
                }
                if (modalContent) {
                    modalContent.scrollTo({ top: 0, behavior: 'instant' });
                }
            }, 50);           
            
            // Enfocar el primer botón del modal
            setTimeout(() => {
                const firstButton = contenido.querySelector('.btn');
                if (firstButton) firstButton.focus();
            }, 100);
        }

        // ===== FUNCIÓN PARA RESETEAR SCROLL DEL MODAL =====
        function resetearScrollModal() {
            const modal = document.getElementById('detalle-producto-modal');
            if (!modal) return;
            
            // Resetear scroll del contenido interno
            const contenido = document.getElementById('detalle-producto-contenido');
            if (contenido) {
                contenido.scrollTop = 0;
            }
            
            // Resetear scroll del modal principal
            const modalContent = modal.querySelector('.modal-content');
            if (modalContent) {
                modalContent.scrollTop = 0;
            }
            
            // Resetear scroll del body del modal
            const modalBody = modal.querySelector('.detalle-producto-body');
            if (modalBody) {
                modalBody.scrollTop = 0;
            }
        }

        function cerrarDetalleProductoModal() {
            const modal = document.getElementById('detalle-producto-modal');
            if (modal) {
                // ⬇️ RESETEAR SCROLL ANTES DE CERRAR ⬇️
                resetearScrollModal();
                
                modal.classList.remove('activo');
                modal.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
            }
        }

        function inicializarSlider(imagenes, containerId) {
            const container = document.getElementById(containerId);
            if (!container || !imagenes || imagenes.length === 0) return;
            
            currentSlideIndex = 0;
            
            let html = `
                <div class="slider-container">
                    <div class="slider-track">
                        ${imagenes.map((img, index) => `
                            <div class="slider-slide" data-index="${index}">
                                <img src="${img}" alt="Imagen ${index + 1} del material" 
                                     loading="lazy" 
                                     width="500"
                                     height="500"
                                     onerror="this.src='https://via.placeholder.com/500x500/f5f5f5/333?text=Imagen+${index + 1}'">
                            </div>
                        `).join('')}
                    </div>
                    
                    ${imagenes.length > 1 ? `
                        <button class="slider-btn slider-prev" onclick="cambiarSlide('${containerId}', -1)" aria-label="Imagen anterior">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="slider-btn slider-next" onclick="cambiarSlide('${containerId}', 1)" aria-label="Imagen siguiente">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    ` : ''}
                </div>
                
                ${imagenes.length > 1 ? `
                    <div class="slider-dots">
                        ${imagenes.map((_, index) => `
                            <button class="slider-dot ${index === 0 ? 'active' : ''}" 
                                    onclick="irASlide('${containerId}', ${index})"
                                    aria-label="Ir a imagen ${index + 1}"
                                    ${index === 0 ? 'aria-current="true"' : ''}></button>
                        `).join('')}
                    </div>
                ` : ''}
            `;
            
            container.innerHTML = html;
            
            // Configurar navegación por teclado
            const prevBtn = container.querySelector('.slider-prev');
            const nextBtn = container.querySelector('.slider-next');
            const dots = container.querySelectorAll('.slider-dot');
            
            if (prevBtn) {
                prevBtn.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        cambiarSlide(containerId, -1);
                    }
                });
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        cambiarSlide(containerId, 1);
                    }
                });
            }
            
            dots.forEach((dot, index) => {
                dot.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        irASlide(containerId, index);
                    }
                });
            });
        }

        function cambiarSlide(containerId, direccion) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const track = container.querySelector('.slider-track');
            const slides = container.querySelectorAll('.slider-slide');
            const dots = container.querySelectorAll('.slider-dot');
            
            currentSlideIndex = (currentSlideIndex + direccion + slides.length) % slides.length;
            
            track.style.transform = `translateX(-${currentSlideIndex * 100}%)`;
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlideIndex);
                dot.setAttribute('aria-current', index === currentSlideIndex ? 'true' : 'false');
            });
            
            // Actualizar etiquetas ARIA para accesibilidad
            slides.forEach((slide, index) => {
                slide.setAttribute('aria-hidden', index !== currentSlideIndex);
            });
        }

        function irASlide(containerId, index) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const track = container.querySelector('.slider-track');
            const slides = container.querySelectorAll('.slider-slide');
            const dots = container.querySelectorAll('.slider-dot');
            
            currentSlideIndex = index;
            track.style.transform = `translateX(-${currentSlideIndex * 100}%)`;
            
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === currentSlideIndex);
                dot.setAttribute('aria-current', i === currentSlideIndex ? 'true' : 'false');
            });
            
            slides.forEach((slide, i) => {
                slide.setAttribute('aria-hidden', i !== currentSlideIndex);
            });
        }

        // ===== FILTROS MÓVIL MEJORADO =====
        function inicializarFiltrosMovil() {
            const btnFiltrosMovil = document.getElementById('btn-filtros-movil');
            const btnFiltrarMovil = document.getElementById('btn-filtrar-movil');
            
            if (btnFiltrosMovil) {
                btnFiltrosMovil.addEventListener('click', abrirFiltrosMovil);
            }
            
            if (btnFiltrarMovil) {
                btnFiltrarMovil.addEventListener('click', abrirFiltrosMovil);
            }
            
            cargarFiltrosContentMovil();
        }

        function cargarFiltrosContentMovil() {
            const container = document.getElementById('filtros-content-movil');
            if (!container) return;
            
            try {
                let html = `
                    <div class="filter-grid">
                        <div class="filter-group-mobile">
                            <h4><i class="fas fa-layer-group"></i> Familia</h4>
                            <div class="filter-options-mobile">
                                ${[...new Set(productos.map(p => p.familia))].map(familia => `
                                    <button class="filter-option-mobile ${estadoFiltros.familias && estadoFiltros.familias.includes(familia) ? 'selected' : ''}" 
                                            onclick="toggleFiltroMovil('familias', '${familia}', this)"
                                            aria-label="${estadoFiltros.familias && estadoFiltros.familias.includes(familia) ? 'Quitar filtro ' : 'Aplicar filtro '}${familia}"
                                            aria-pressed="${estadoFiltros.familias && estadoFiltros.familias.includes(familia)}">
                                        ${familia}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="filter-group-mobile">
                            <h4><i class="fas fa-mountain"></i> Material</h4>
                            <div class="filter-options-mobile">
                                ${[...new Set(productos.map(p => p.material))].map(material => `
                                    <button class="filter-option-mobile ${estadoFiltros.materiales && estadoFiltros.materiales.includes(material) ? 'selected' : ''}" 
                                            onclick="toggleFiltroMovil('materiales', '${material}', this)"
                                            aria-label="${estadoFiltros.materiales && estadoFiltros.materiales.includes(material) ? 'Quitar filtro ' : 'Aplicar filtro '}${material}"
                                            aria-pressed="${estadoFiltros.materiales && estadoFiltros.materiales.includes(material)}">
                                        ${material}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="filter-group-mobile">
                            <h4><i class="fas fa-paint-roller"></i> Acabado</h4>
                            <div class="filter-options-mobile">
                                ${[...new Set(productos.map(p => p.acabado))].map(acabado => `
                                    <button class="filter-option-mobile ${estadoFiltros.acabados && estadoFiltros.acabados.includes(acabado) ? 'selected' : ''}" 
                                            onclick="toggleFiltroMovil('acabados', '${acabado}', this)"
                                            aria-label="${estadoFiltros.acabados && estadoFiltros.acabados.includes(acabado) ? 'Quitar filtro ' : 'Aplicar filtro '}${acabado}"
                                            aria-pressed="${estadoFiltros.acabados && estadoFiltros.acabados.includes(acabado)}">
                                        ${acabado}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="filter-group-mobile">
                            <h4><i class="fas fa-ruler-combined"></i> Medida</h4>
                            <div class="filter-options-mobile">
                                ${[...new Set(productos.map(p => p.medida))].map(medida => `
                                    <button class="filter-option-mobile ${estadoFiltros.medidas && estadoFiltros.medidas.includes(medida) ? 'selected' : ''}" 
                                            onclick="toggleFiltroMovil('medidas', '${medida}', this)"
                                            aria-label="${estadoFiltros.medidas && estadoFiltros.medidas.includes(medida) ? 'Quitar filtro ' : 'Aplicar filtro '}${medida}"
                                            aria-pressed="${estadoFiltros.medidas && estadoFiltros.medidas.includes(medida)}">
                                        ${medida}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="filter-group-mobile">
                            <h4><i class="fas fa-award"></i> Calidad</h4>
                            <div class="filter-options-mobile">
                                ${[...new Set(productos.map(p => p.calidad))].map(calidad => `
                                    <button class="filter-option-mobile ${estadoFiltros.calidades && estadoFiltros.calidades.includes(calidad) ? 'selected' : ''}" 
                                            onclick="toggleFiltroMovil('calidades', '${calidad}', this)"
                                            aria-label="${estadoFiltros.calidades && estadoFiltros.calidades.includes(calidad) ? 'Quitar filtro ' : 'Aplicar filtro '}${calidad}"
                                            aria-pressed="${estadoFiltros.calidades && estadoFiltros.calidades.includes(calidad)}">
                                        ${calidad}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="filter-group-mobile">
                            <h4><i class="fas fa-border-style"></i> Borde</h4>
                            <div class="filter-options-mobile">
                                ${[...new Set(productos.map(p => p.borde))].map(borde => `
                                    <button class="filter-option-mobile ${estadoFiltros.bordes && estadoFiltros.bordes.includes(borde) ? 'selected' : ''}" 
                                            onclick="toggleFiltroMovil('bordes', '${borde}', this)"
                                            aria-label="${estadoFiltros.bordes && estadoFiltros.bordes.includes(borde) ? 'Quitar filtro ' : 'Aplicar filtro '}${borde}"
                                            aria-pressed="${estadoFiltros.bordes && estadoFiltros.bordes.includes(borde)}">
                                        ${borde}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="filter-group-mobile">
                            <h4><i class="fas fa-tags"></i> Rango de Precio</h4>
                            <div style="padding: 15px;">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Mínimo: S/. <span id="precio-min-movil">${estadoFiltros.rangoPrecio.min}</span></label>
                                    <input type="range" id="precio-min-movil" min="0" max="${estadoFiltros.rangoPrecio.max}" value="${estadoFiltros.rangoPrecio.min}" 
                                           style="width: 100%;" 
                                           oninput="actualizarRangoPrecioMovil('min', this.value)">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem;">Máximo: S/. <span id="precio-max-movil">${estadoFiltros.rangoPrecio.max}</span></label>
                                    <input type="range" id="precio-max-movil" min="0" max="${estadoFiltros.rangoPrecio.max * 1.5}" value="${estadoFiltros.rangoPrecio.max}" 
                                           style="width: 100%;"
                                           oninput="actualizarRangoPrecioMovil('max', this.value)">
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error al cargar filtros móvil:', error);
                container.innerHTML = '<p>Error al cargar los filtros</p>';
            }
        }

        function toggleFiltroMovil(tipo, valor, elemento) {
            // Asegurarse de que el array exista
            if (!estadoFiltros[tipo]) {
                estadoFiltros[tipo] = [];
            }
            
            const arrayFiltro = estadoFiltros[tipo];
            const estaSeleccionado = arrayFiltro.includes(valor);
            
            if (estaSeleccionado) {
                const indice = arrayFiltro.indexOf(valor);
                if (indice !== -1) {
                    arrayFiltro.splice(indice, 1);
                }
                elemento.classList.remove('selected');
                elemento.setAttribute('aria-pressed', 'false');
            } else {
                arrayFiltro.push(valor);
                elemento.classList.add('selected');
                elemento.setAttribute('aria-pressed', 'true');
            }
        }

        function actualizarRangoPrecioMovil(tipo, valor) {
            estadoFiltros.rangoPrecio[tipo] = parseFloat(valor);
            document.getElementById(`precio-${tipo}-movil`).textContent = parseInt(valor);
            actualizarContadorFiltros();
        }

        function abrirFiltrosMovil() {
            const overlay = document.getElementById('filtros-overlay');
            if (overlay) {
                overlay.classList.add('activo');
                overlay.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';
                cargarFiltrosContentMovil();
                actualizarContadorFiltros();
                
                // Enfocar el primer botón de filtro
                setTimeout(() => {
                    const firstButton = document.querySelector('.filter-option-mobile');
                    if (firstButton) firstButton.focus();
                }, 100);
            }
        }

        function cerrarFiltrosMovil() {
            const overlay = document.getElementById('filtros-overlay');
            if (overlay) {
                overlay.classList.remove('activo');
                overlay.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
                
                // Enfocar el botón flotante o el botón de filtrar
                if (window.innerWidth < 768) {
                    document.getElementById('btn-filtros-movil').focus();
                } else {
                    document.getElementById('btn-filtrar-movil').focus();
                }
            }
        }

        function aplicarFiltrosMovil() {
            aplicarFiltros();
        }

        function reiniciarFiltrosMovil() {
            reiniciarFiltros();
            cargarFiltrosContentMovil();
        }

        function actualizarContadorFiltros() {
            const contador = document.getElementById('contador-filtros-movil');
            if (!contador) return;
            
            let count = 0;
            const tipos = ['familias', 'materiales', 'acabados', 'medidas', 'calidades', 'bordes'];
            tipos.forEach(tipo => {
                if (estadoFiltros[tipo] && estadoFiltros[tipo].length > 0) {
                    count++;
                }
            });
            
            // Contar rango de precio si está configurado
            if (estadoFiltros.rangoPrecio && (estadoFiltros.rangoPrecio.min > 0 || estadoFiltros.rangoPrecio.max < 10000)) {
                count++;
            }
            
            // Contar búsqueda si existe
            if (estadoFiltros.busqueda) {
                count++;
            }
            
            contador.textContent = count;
        }

        // ===== CONTADORES =====
        function actualizarContadorFavoritos() {
            const contadorFavoritos = document.getElementById('favoritos-count');
            const contadorFavoritosMovil = document.getElementById('mobile-favoritos-count');
            
            if (contadorFavoritos) {
                contadorFavoritos.textContent = productosFavoritos.length;
            }
            
            if (contadorFavoritosMovil) {
                contadorFavoritosMovil.textContent = productosFavoritos.length;
            }
        }

        function actualizarContadorAsesor() {
            const contadorAsesor = document.getElementById('asesor-count');
            const contadorAsesorMovil = document.getElementById('mobile-asesor-count');
            const whatsappCount = document.getElementById('whatsapp-count');
            
            if (contadorAsesor) {
                contadorAsesor.textContent = productosParaAsesor.length;
            }
            
            if (contadorAsesorMovil) {
                contadorAsesorMovil.textContent = productosParaAsesor.length;
            }
            
            if (whatsappCount) {
                whatsappCount.textContent = productosParaAsesor.length;
            }
        }

        // ===== MENÚ MÓVIL =====
        function inicializarMenuMovil() {
            document.querySelectorAll('.mobile-menu-item').forEach(item => {
                if (item.tagName === 'A') {
                    item.addEventListener('click', function(e) {
                        if (this.getAttribute('href') === '#') {
                            e.preventDefault();
                        }
                        
                        document.querySelectorAll('.mobile-menu-item').forEach(i => {
                            i.classList.remove('active');
                            i.removeAttribute('aria-current');
                        });
                        
                        this.classList.add('active');
                        this.setAttribute('aria-current', 'page');
                    });
                }
            });
        }

        // ===== NAVEGACIÓN TECLADO =====
        function configurarNavegacionTeclado() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 'f':
                            e.preventDefault();
                            document.getElementById('search-input').focus();
                            break;
                        case 'h':
                            e.preventDefault();
                            toggleTema();
                            break;
                    }
                }
                
                // Navegación por teclado general
                if (e.key === 'Tab') {
                    // Asegurar que el foco esté visible
                    const focused = document.activeElement;
                    if (focused && focused.scrollIntoViewIfNeeded) {
                        focused.scrollIntoViewIfNeeded({ behavior: 'smooth', block: 'center' });
                    }
                }
            });
        }

        // ===== UTILIDADES =====
        function mostrarToast(mensaje) {
            const toastExistente = document.querySelector('.toast');
            if (toastExistente) {
                toastExistente.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'polite');
            toast.setAttribute('aria-atomic', 'true');
            toast.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${mensaje}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }

        function mostrarError(mensaje) {
            const toastExistente = document.querySelector('.toast');
            if (toastExistente) {
                toastExistente.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            toast.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                <span>${mensaje}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }

        // Agregar animación de spinner
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
        
        console.log('Código JavaScript completamente cargado con todas las mejoras');
    </script>
</body>

</html>

