<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="../../FOTOS/ICONOS/Icono_6.ico">
    <title>Gallos Mármol</title>
    <style>
        /* Variables CSS para modo claro/oscuro */
        :root {
            /* Colores base modo claro */
            --color-primary: #000000;
            --color-secondary: #CB3E2C;
            --color-success: #4CAF50;
            --color-warning: #FF9800;
            --color-danger: #CB3E2C;
            --color-text: #333333;
            --color-text-light: #777777;
            --color-bg: #ffffff;
            --color-bg-secondary: #f5f5f5;
            --color-bg-tertiary: #f9f9f9;
            --color-border: #dddddd;
            --color-shadow: rgba(0, 0, 0, 0.1);
            --color-card-bg: #ffffff;
            --color-card-shadow: rgba(0, 0, 0, 0.1);
            --color-toast-bg: #ffffff;
            --color-toast-text: #333333;
            --color-modal-bg: #ffffff;
            --color-modal-text: #333333;
            --color-input-bg: #ffffff;
            --color-input-text: #333333;
            --color-input-border: #dddddd;
        }

        /* Modo oscuro */
        @media (prefers-color-scheme: dark) {
            :root {
                --color-primary: #ffffff;
                --color-secondary: #e74c3c;
                --color-success: #2ecc71;
                --color-warning: #f39c12;
                --color-danger: #e74c3c;
                --color-text: #f0f0f0;
                --color-text-light: #b0b0b0;
                --color-bg: #121212;
                --color-bg-secondary: #1e1e1e;
                --color-bg-tertiary: #252525;
                --color-border: #333333;
                --color-shadow: rgba(0, 0, 0, 0.3);
                --color-card-bg: #1e1e1e;
                --color-card-shadow: rgba(0, 0, 0, 0.3);
                --color-toast-bg: #2d2d2d;
                --color-toast-text: #f0f0f0;
                --color-modal-bg: #1e1e1e;
                --color-modal-text: #f0f0f0;
                --color-input-bg: #252525;
                --color-input-text: #f0f0f0;
                --color-input-border: #333333;
            }

            /* Ajustes específicos para modo oscuro */
            .product-image {
                background-color: #252525 !important;
            }
            
            .no-image-placeholder {
                color: #555 !important;
            }
            
            .asesor-avatar {
                border-color: var(--color-primary) !important;
            }
        }

        /* Reset y estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            color: var(--color-text);
            background-color: var(--color-bg);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .btn {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--color-primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            background-color: var(--color-secondary);
            transform: translateY(-2px);
        }

        /* Detalle de producto */
        .product-detail-page {
            padding-top: 40px;
            padding-bottom: 60px;
            position: relative;
        }

        .product-detail {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 60px;
        }

        .product-gallery {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 15px;
            position: relative;
        }

        .thumbnail-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .thumbnail {
            width: 100%;
            height: 80px;
            object-fit: cover;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .thumbnail.active, .thumbnail:hover {
            border-color: var(--color-primary);
        }

        .main-image {
            width: 100%;
            height: 500px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 5px 15px var(--color-shadow);
        }

        .product-info {
            padding: 20px;
        }

        .product-title {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--color-primary);
        }

        .product-subtitle {
            font-size: 1.2rem;
            color: var(--color-primary);
            margin-bottom: 20px;
        }

        .product-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }

        .meta-item {
            background-color: var(--color-bg-secondary);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .product-price {
            font-size: 1.8rem;
            color: var(--color-secondary);
            font-weight: 700;
            margin-bottom: 20px;
        }

        /* Estilos para cuando no hay imágenes */
        .no-images-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 500px;
            background-color: var(--color-bg-tertiary);
            border-radius: 8px;
            color: var(--color-text-light);
            text-align: center;
            padding: 20px;
            margin-bottom: 40px;
            grid-column: 1 / -1;
        }

        .no-images-message i {
            font-size: 50px;
            margin-bottom: 15px;
            color: var(--color-border);
        }

        @media (max-width: 768px) {
            .no-images-message {
                height: 300px;
            }
        }

        /* Resto de estilos existentes... */
        .product-stock-info {
            display: flex;
            justify-content: space-between;
            background-color: var(--color-bg-tertiary);
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        .stock-amount {
            font-weight: 600;
            color: var(--color-text);
        }
        
        .stock-date {
            color: var(--color-text-light);
            font-style: italic;
        }

        .product-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .favorite-btn {
            background-color: var(--color-bg-secondary);
            color: var(--color-text);
        }

        .favorite-btn:hover {
            background-color: var(--color-primary);
            color: var(--color-bg);
        }

        .favorite-btn.active {
            background-color: var(--color-secondary);

        }

        .quote-btn {
            background-color: var(--color-bg-secondary);
            color: var(--color-text);
        }

        .quote-btn:hover {
            background-color: var(--color-primary);
            color: var(--color-bg);
        }

        .quote-btn:disabled {
            background-color: var(--color-border);
            color: var(--color-text-light);
            cursor: not-allowed;
        }

        .quote-btn.active {
            background-color: var(--color-secondary);
        }

        .request-price-btn {
            background-color: var(--color-bg-secondary);
            color: var(--color-primary);
            border: 1px solid var(--color-border);
            padding: 12px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            margin-bottom: 15px;
        }

        .request-price-btn:hover {
            background-color: var(--color-primary);
            color: var(--color-bg);
        }

        .request-price-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-light);
        }

        .request-price-btn:disabled:hover {
            background-color: var(--color-bg-secondary);
            color: var(--color-text-light);
        }

        .no-price-text {
            color: var(--color-text-light);
            font-style: italic;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .product-description {
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .tech-specs h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .specs-list {
            list-style: none;
        }

        .specs-list li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
        }

        .specs-list li:before {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            left: 0;
            color: var(--color-primary);
        }

        .stock-status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin-bottom: 15px;
            display: inline-block;
        }

        .in-stock {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--color-success);
        }

        .out-of-stock {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--color-danger);
        }

        .low-stock {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--color-warning);
        }

        .product-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .badge-Nuevo {
            background-color: #2196F3;
            color: white;
        }
        
        .badge-Destacado {
            background-color: #8B7355;
            color: white;
        }
        
        .badge-Oferta {
            background-color: var(--color-secondary);
            color: white;
        }
        
        .badge-Sin-Etiqueta {
            background-color: #ffffff00;  
            color: #ffffff00;  
        }

        .status-Disponible {
            background-color: var(--color-success);
            color: white;
        }
        
        .status-Agotado {
            background-color: var(--color-danger);
            color: white;
        }

        .status-Stock-bajo {
            background-color: var(--color-warning);
            color: white;
        }

        /* Productos relacionados */
        .related-products {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 1px solid var(--color-border);
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.2rem;
            color: var(--color-primary);
        }

        .section-title:after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background-color: var(--color-secondary);
            margin: 15px auto;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }
        
        .product-card {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px var(--color-card-shadow);
            transition: all 0.3s ease;
            position: relative;
            background-color: var(--color-card-bg);
        }
        
        .product-image {
            height: 220px;
            overflow: hidden;
            position: relative;
            background-color: var(--color-bg-secondary);
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .product-image img.loaded {
            opacity: 1;
        }
        
        .product-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .product-status {
            position: absolute;
            top: 15px;
            left: 15px;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.8rem;
        }
        
        .product-info-card {
            padding: 15px;
            background-color: var(--color-card-bg);
        }
        
        .product-title-card {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .product-material-card {
            color: var(--color-primary);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .product-specs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
            font-size: 0.8rem;
        }
        
        .spec-item {
            background-color:rgba(245, 245, 245, 0.1);
            padding: 3px 8px;
            border-radius: 3px;
        }

        .product-stock-card {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 0.8rem;
            color: var(--color-text-light);
        }
        
        .stock-amount-card {
            font-weight: 600;
        }
        
        .stock-date-card {
            font-style: italic;
        }
        
        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .product-price-card {
            font-weight: 700;
            color: var(--color-secondary);
            font-size: 1.1rem;
        }
        
        .price-contact-card {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .no-price-card {
            color: var(--color-text-light);
            font-style: italic;
            font-size: 0.9rem;
        }
        
        .contact-btn-card {
            background-color: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: 18px;
            padding: 10px 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text);

        }
        
        .contact-btn-card:hover {
            background-color: var(--color-text);  
            color:  var(--color-bg-secondary); 
        }

        .contact-btn-card:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: var(--color-bg-secondary);
            color: var(--color-text-light);
        }

        .contact-btn-card:disabled:hover {
            background-color: var(--color-bg-secondary);
            color: var(--color-text-light);
        }

        .contact-btn-card span {
            padding: 3px;
        }


        .product-actions-card {
            display: flex;
            gap: 8px;
        }
        
        .action-btn-card {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(245, 245, 245, 0.1);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--color-text);
        }
        
        .action-btn-card:hover {
            background-color: var(--color-text);  
            color:  var(--color-bg-secondary); 
        }
        
        .action-btn-card:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: var(--color-bg-secondary);
        }
        
        .favorite-btn-card.active {
            background-color: var(--color-secondary);
            color: white;
        }
        
        .quote-btn-card.active {
            background-color: var(--color-success);
            color: white;
        }

        .share-btn-card.active {
            background-color: #25D366;
            color: white;
        }
        
        .details-btn {
            display: block;
            text-align: center;
            padding: 8px;
            background-color: rgba(245, 245, 245, 0.1);
            border-radius: 4px;
            margin-top: 10px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            color: var(--color-text);
        }
        
        .details-btn:hover {
            background-color: var(--color-text);  
            color:  var(--color-bg-secondary); 
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 4px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: fadeInOut 3s forwards;
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: var(--color-toast-bg);
            color: var(--color-toast-text);
        }

        .toast-success {
            background-color: var(--color-success);
        }

        .toast-error {
            background-color: var(--color-danger);
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0); }
            90% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(20px); }
        }

        /* Estilos para lazy loading */
        img[data-src] {
            background-color: var(--color-bg-secondary);
            min-height: 100px;
        }

        img {
            transition: opacity 0.3s ease;
        }

        img:not([src]) {
            opacity: 0;
        }

        img[src] {
            opacity: 1;
        }

        /* Botón flotante para vista 3D */
        .view-3d-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--color-primary);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px var(--color-shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            transition: all 0.3s ease;
        }

        .view-3d-btn:hover {
            background-color: var(--color-secondary);
            transform: scale(1.1);
        }

        .view-3d-btn i {
            font-size: 24px;
        }

        /* Botón flotante para WhatsApp */
        .whatsapp-float-btn {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #25D366;
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px var(--color-shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            transition: all 0.3s ease;
        }

        .whatsapp-float-btn:hover {
            background-color: #128C7E;
            transform: scale(1.1);
        }

        .whatsapp-float-btn i {
            font-size: 24px;
        }

        /* Modal para vista 3D */
        .modal-3d {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }

        .modal-3d.active {
            display: flex;
        }

        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            width: auto;
            height: auto;
            text-align: center;
        }

        .modal-image {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 8px;
        }

        .close-modal {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 30px;
            cursor: pointer;
        }

        .modal-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            transform: translateY(-50%);
        }

        .nav-btn {
            background-color: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background-color: var(--color-secondary);
        }

        .image-counter {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 16px;
        }

        /* ============================================= */
        /* MODAL DE SELECCIÓN DE TIPO DE CLIENTE */
        /* ============================================= */
        .client-type-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1003;
            justify-content: center;
            align-items: center;
        }
        
        .client-type-content {
            background-color: var(--color-modal-bg);
            color: var(--color-modal-text);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 25px var(--color-shadow);
            text-align: center;
        }
        
        .client-type-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--color-primary);
        }
        
        .client-type-message {
            margin-bottom: 25px;
            color: var(--color-text-light);
        }
        
        .client-type-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .client-type-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .client-type-btn.existing-client {
            background-color: var(--color-text);  
            color:  var(--color-bg-secondary); 
        }
        
        .client-type-btn.new-client {
            background-color: var(--color-secondary);
            color: white;
        }
        
        .client-type-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* ============================================= */
        /* MODAL DE WHATSAPP PARA NUEVOS CLIENTES */
        /* ============================================= */
        .whatsapp-modal-new {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1004;
            justify-content: center;
            align-items: center;
            overscroll-behavior: contain;
            overflow: auto;
            overflow-y: auto;
            overscroll-behavior-y: contain;
            right: 0;
            bottom: 0;
        }
        
        .whatsapp-content-new {
            background-color: var(--color-modal-bg);
            color: var(--color-modal-text);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 25px var(--color-shadow);
            scroll-behavior: auto !important;
            text-align: center;
        }
        
        .whatsapp-title-new {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--color-primary);
            text-align: center;
        }

        .whatsapp-title-new:after {
            background-color: #25D366;
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            margin: 10px auto;
        }

        .modal-message {
            margin-bottom: 20px;
            color: var(--color-text-light);
            text-align: center;
        }

        /* ============================================= */
        /* MODAL DE WHATSAPP PARA CLIENTES EXISTENTES */
        /* ============================================= */
        .whatsapp-modal-existing {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1005;
            justify-content: center;
            align-items: center;
            overscroll-behavior: contain;
            overflow: auto;
            overflow-y: auto;
            overscroll-behavior-y: contain;
            right: 0;
            bottom: 0;
        }
        
        .whatsapp-content-existing {
            background-color: var(--color-modal-bg);
            color: var(--color-modal-text);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 25px var(--color-shadow);
            scroll-behavior: auto !important;
            text-align: center;
        }
        
        .search-asesores {
            margin: 20px 0;
            position: relative;
        }
        
        .search-asesores input {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid var(--color-input-border);
            border-radius: 30px;
            font-size: 1rem;
            padding-left: 45px;
            transition: all 0.3s;
            background-color: var(--color-input-bg);
            color: var(--color-input-text);
        }
        
        .search-asesores input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(139, 115, 85, 0.2);
        }
        
        .search-asesores i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-light);
        }
        
        .asesores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
 
        .whatsapp-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--color-primary);
            text-align: center;
        }

        .whatsapp-title:after {
            background-color: #25D366;
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            margin: 10px auto;
        }    

        .asesor-card {
            background: var(--color-card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 8px var(--color-card-shadow);
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border: 1px solid var(--color-border);
        }
        
        .asesor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px var(--color-card-shadow);
        }
        
        .asesor-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--color-bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
            border: 3px solid var(--color-primary);
        }
        
        .asesor-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .asesor-info {
            width: 100%;
        }
        
        .asesor-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: var(--color-text);
        }
        
        .asesor-phone {
            color: var(--color-text-light);
            font-size: 0.95rem;
            margin-bottom: 10px;
        }
        
        .asesor-specialty {
            background-color: var(--color-bg-secondary);
            padding: 5px 10px;
            border-radius: 20px;
            color: var(--color-secondary);
            font-size: 0.85rem;
            margin-bottom: 15px;
            display: inline-block;
            font-weight: 600;
        }
        
        .btn-contact {
            background-color: #25D366;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            transition: all 0.3s;
            font-weight: 600;
            margin-top: auto;
        }
        
        .btn-contact:hover {
            background-color: #128C7E;
            transform: translateY(-2px);
        }
        
        .btn-contact i {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        
        .whatsapp-buttons {
            display: flex;
            justify-content: center;
            margin-top: 25px;
        }
        
        .whatsapp-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .whatsapp-cancel {
            background-color: rgba(245, 245, 245, 0.1); 
            color: var(--color-text); 
            width: 100%;
        }
        
        .whatsapp-cancel:hover {
            background-color: var(--color-text);  
            color:  var(--color-bg-secondary); 
        }

        /* Modal para confirmación de WhatsApp en productos relacionados */
        .modal-confirm {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1002;
            align-items: center;
            justify-content: center;
        }

        .modal-confirm.active {
            display: flex;
        }

        .modal-confirm-content {
            background-color: var(--color-modal-bg);
            color: var(--color-modal-text);
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 5px 15px var(--color-shadow);
            position: relative;
        }

        .modal-confirm-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--color-text-light);
        }

        .modal-confirm-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--color-primary);
        }

        .modal-confirm-text {
            margin-bottom: 25px;
            line-height: 1.6;
            color: var(--color-text-light);
        }

        .modal-confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal-confirm-btn {
            padding: 10px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .modal-confirm-primary {
            background-color: var(--color-success);
            color: white;
        }

        .modal-confirm-primary:hover {
            color: var(--color-bg);
        }

        .modal-confirm-secondary {
            background-color: var(--color-text); 
            color:  var(--color-bg-secondary); 
        }

        .modal-confirm-secondary:hover {
            background-color: var(--color-secondary);
            color: #ffffff;
        }

        /* Modal para confirmación de descarga de ficha técnica */
        .tech-spec-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1002;
            align-items: center;
            justify-content: center;
        }

        .tech-spec-modal.active {
            display: flex;
        }

        /* Modal para confirmación de descarga de ficha de seguridad */
        .safety-spec-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1002;
            align-items: center;
            justify-content: center;
        }

        .safety-spec-modal.active {
            display: flex;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .product-detail {
                gap: 30px;
            }
        }

        @media (max-width: 768px) {
            .product-detail {
                grid-template-columns: 1fr;
            }
            
            .product-gallery {
                grid-template-columns: 80px 1fr;
            }
            
            .main-image {
                height: 400px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .view-3d-btn, .whatsapp-float-btn {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
            }

            .whatsapp-float-btn {
                bottom: 80px;
            }

            .view-3d-btn i, .whatsapp-float-btn i {
                font-size: 20px;
            }
        }

        @media (max-width: 576px) {
            .product-gallery {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
            }
            
            .thumbnail-list {
                flex-direction: row;
                order: 2;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .thumbnail {
                height: 60px;
                min-width: 60px;
            }
            
            .product-actions {
                flex-direction: column;
            }

            .view-3d-btn, .whatsapp-float-btn {
                width: 45px;
                height: 45px;
                bottom: 15px;
                right: 15px;
            }

            .whatsapp-float-btn {
                bottom: 70px;
            }

            .view-3d-btn i, .whatsapp-float-btn i {
                font-size: 18px;
            }

            .modal-image {
                max-height: 60vh;
            }

            .modal-confirm-buttons {
                flex-direction: column;
            }

            .modal-confirm-btn {
                width: 100%;
            }

            .client-type-options {
                flex-direction: column;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Contenedor para el menú que se cargará externamente -->
    <div id="menu-container"></div>

    <!-- Detalle de Producto -->
    <section class="product-detail-page">
        <div class="container">
            <div class="product-detail" id="product-detail-container">
                <!-- Contenido dinámico -->
            </div>

            <!-- Productos relacionados -->
            <div class="related-products" id="related-products-container">
                <h2 class="section-title">Productos Relacionados</h2>
                <div class="products-grid" id="related-products-grid">
                    <!-- Productos relacionados se cargarán aquí -->
                </div>
            </div>
        </div>
    </section>

    <!-- Botón flotante para vista 3D -->
    <button class="view-3d-btn" id="view3dBtn" style="display: none;">
        <i class="fas fa-cube"></i>
    </button>

    <!-- Botón flotante para WhatsApp -->
    <button class="whatsapp-float-btn" id="whatsappFloatBtn">
        <i class="fab fa-whatsapp"></i>
    </button>

    <!-- Modal para vista 3D -->
    <div class="modal-3d" id="modal3d">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <img class="modal-image" id="modalImage" src="" alt="Vista 3D del producto">
            <div class="modal-nav">
                <button class="nav-btn" id="prevImage"><i class="fas fa-chevron-left"></i></button>
                <button class="nav-btn" id="nextImage"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="image-counter" id="imageCounter"></div>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- MODAL DE SELECCIÓN DE TIPO DE CLIENTE -->
    <!-- ============================================= -->
    <div class="client-type-modal" id="clientTypeModal">
        <div class="client-type-content">
            <h2 class="client-type-title">¿Eres cliente de Gallos Mármol?</h2>
            <p class="client-type-message">Selecciona una opción para continuar con tu solicitud de precio</p>
            <div class="client-type-options">
                <button class="client-type-btn existing-client" id="existingClientBtn">
                    <i class="fas fa-user-check"></i> Soy cliente
                </button>
                <button class="client-type-btn new-client" id="newClientBtn">
                    <i class="fas fa-user-plus"></i> No soy cliente aún
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- MODAL DE WHATSAPP PARA NUEVOS CLIENTES -->
    <!-- ============================================= -->
    <div class="whatsapp-modal-new" id="whatsappModalNewClient">
        <div class="whatsapp-content-new">
            <h2 class="whatsapp-title-new">Contactar a un asesor</h2>
            <p class="modal-message">Uno de nuestros asesores ya está listo para ayudarte con todo lo que necesites.</p>
            <div id="asesorAleatorioContainer"></div>
            <div class="whatsapp-buttons">
                <button class="whatsapp-btn whatsapp-cancel" id="cancelWhatsappNew">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- MODAL DE WHATSAPP PARA CLIENTES EXISTENTES -->
    <!-- ============================================= -->
    <div class="whatsapp-modal-existing" id="whatsappModalExistingClient">
        <div class="whatsapp-content-existing">
            <h2 class="modal-title whatsapp-title">Selecciona tu asesor</h2>
            <p class="modal-message">Por favor, selecciona al asesor con el que trabajaste anteriormente.</p>
            
            <div class="search-asesores">
                <i class="fas fa-search"></i>
                <input type="text" id="searchAsesorInput" placeholder="Buscar asesor por nombre o especialidad...">
            </div>
            
            <div class="asesores-grid" id="asesoresListContainer"></div>
            
            <div class="whatsapp-buttons">
                <button class="whatsapp-btn whatsapp-cancel" id="cancelWhatsappExisting">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para confirmación de WhatsApp en productos relacionados -->
    <div class="modal-confirm" id="whatsappModalRelated">
        <div class="modal-confirm-content">
            <button class="modal-confirm-close" id="closeWhatsappModalRelated">&times;</button>
            <h3 class="modal-confirm-title">Compartir producto</h3>
            <p class="modal-confirm-text">¿Deseas compartir este producto por WhatsApp? Se abrirá la aplicación con los detalles del producto.</p>
            <div class="modal-confirm-buttons">
                <button class="modal-confirm-btn modal-confirm-secondary" id="cancelWhatsappShareRelated">Cancelar</button>
                <button class="modal-confirm-btn modal-confirm-primary" id="confirmWhatsappShareRelated">Compartir</button>
            </div>
        </div>
    </div>

    <!-- Modal para confirmación de descarga de ficha técnica -->
    <div class="tech-spec-modal" id="techSpecModal">
        <div class="modal-confirm-content">
            <button class="modal-confirm-close" id="closeTechSpecModal">&times;</button>
            <h3 class="modal-confirm-title">Descargar ficha técnica</h3>
            <p class="modal-confirm-text">¿Deseas descargar la ficha técnica de este producto? El archivo se descargará inmediatamente.</p>
            <div class="modal-confirm-buttons">
                <button class="modal-confirm-btn modal-confirm-secondary" id="cancelTechSpecDownload">Cancelar</button>
                <button class="modal-confirm-btn modal-confirm-primary" id="confirmTechSpecDownload">Descargar</button>
            </div>
        </div>
    </div>

    <!-- Modal para confirmación de descarga de ficha de seguridad -->
    <div class="safety-spec-modal" id="safetySpecModal">
        <div class="modal-confirm-content">
            <button class="modal-confirm-close" id="closeSafetySpecModal">&times;</button>
            <h3 class="modal-confirm-title">Descargar ficha de seguridad</h3>
            <p class="modal-confirm-text">¿Deseas descargar la ficha de seguridad de este producto? El archivo se descargará inmediatamente.</p>
            <div class="modal-confirm-buttons">
                <button class="modal-confirm-btn modal-confirm-secondary" id="cancelSafetySpecDownload">Cancelar</button>
                <button class="modal-confirm-btn modal-confirm-primary" id="confirmSafetySpecDownload">Descargar</button>
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <div class="toast" id="toastNotification" style="display: none;"></div>

    <!-- Script para cargar el menú -->
    <script src="../JS/cargarMenu.js"></script>

    <!-- Script específico de la página -->
    <script>
        // Variables globales
        let allProducts = [];
        let currentProduct = null;
        let current3DImages = [];
        let currentImageIndex = 0;
        let currentWhatsappProduct = null;
        let currentDownloadUrl = null;
        let asesoresDisponibles = [];
        let asesoresUsados = [];
        let failedImagesCount = 0;
        let totalImagesCount = 0;
        
        // Obtener parámetro de URL
        function getProductCode() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('codigo');
        }
        
        // Mostrar notificación toast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toastNotification');
            toast.textContent = message;
            toast.className = `toast toast-${type}`;
            toast.style.display = 'flex';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // Función para carga diferida de imágenes
        function lazyLoadImages() {
            const lazyImages = document.querySelectorAll('img[data-src]');
            
            // Verificar si el navegador soporta IntersectionObserver
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.onload = () => {
                                img.classList.add('loaded');
                            };
                            img.onerror = () => {
                                handleImageError(img, img.classList.contains('main-image'));
                            };
                            observer.unobserve(img);
                        }
                    });
                });

                lazyImages.forEach(img => imageObserver.observe(img));
            } else {
                // Fallback para navegadores que no soportan IntersectionObserver
                lazyImages.forEach(img => {
                    img.src = img.dataset.src;
                    img.onload = () => {
                        img.classList.add('loaded');
                    };
                    img.onerror = () => {
                        handleImageError(img, img.classList.contains('main-image'));
                    };
                });
            }
        }
        
        // Manejar errores de carga de imágenes
        function handleImageError(imgElement, isMainImage) {
            failedImagesCount++;
            imgElement.style.display = 'none';
            
            // Si es la imagen principal, intentar cargar la primera miniatura
            if (isMainImage) {
                const firstThumbnail = document.querySelector('.thumbnail:not([style*="display: none"])');
                if (firstThumbnail) {
                    document.getElementById('main-image').src = firstThumbnail.src;
                } else {
                    checkImagesStatus();
                }
            } else {
                checkImagesStatus();
            }
        }
        
        // Verificar estado de las imágenes
        function checkImagesStatus() {
            const gallery = document.getElementById('product-gallery');
            const mainImage = document.getElementById('main-image');
            const thumbnails = document.querySelectorAll('.thumbnail');
            
            totalImagesCount = thumbnails.length + 1; // +1 por la imagen principal
            
            // Si todas las imágenes fallaron o no hay imágenes
            if (failedImagesCount >= totalImagesCount || 
                (mainImage && mainImage.complete && mainImage.naturalHeight === 0 && thumbnails.length === 0)) {
                showNoImagesMessage();
            }
        }
        
        // Mostrar mensaje cuando no hay imágenes
        function showNoImagesMessage() {
            const galleryContainer = document.getElementById('product-gallery');
            
            if (!galleryContainer) return;
            
            galleryContainer.innerHTML = `
                <div class="no-images-message">
                    <i class="fas fa-image"></i>
                    <p>Imágenes no disponibles actualmente</p>
                </div>
            `;
            
            // Ocultar botón de vista 3D si existe
            const view3dBtn = document.getElementById('view3dBtn');
            if (view3dBtn) view3dBtn.style.display = 'none';
        }
        
        // Cargar datos del producto desde ambos JSON
        async function loadProductDetail() {
            const productCode = getProductCode();
            
            if (!productCode) {
                window.location.href = 'producto.html';
                return;
            }
            
            try {
                // Cargar todos los archivos JSON necesarios
                const [productosResponse, preciosResponse, asesoresResponse] = await Promise.all([
                    fetch('../JSON/productos_1.json'),
                    fetch('../JSON/productos_2.json'),
                    fetch('../JSON/asesores.json')
                ]);
                
                if (!productosResponse.ok || !preciosResponse.ok || !asesoresResponse.ok) {
                    throw new Error('Error al cargar los datos del producto');
                }
                
                const productosData = await productosResponse.json();
                const preciosData = await preciosResponse.json();
                const asesoresData = await asesoresResponse.json();
                
                // Combinar los datos de ambos JSON de productos
                allProducts = productosData.map(producto => {
                    const precioInfo = preciosData.find(p => p.codigo === producto.codigo) || {};
                    
                    // Manejar casos donde el precio puede ser 0, null o undefined
                    let precio = precioInfo.precio;
                    if (precio === undefined || precio === null) {
                        precio = null; // Marcamos como sin precio
                    } else {
                        precio = parseFloat(precio);
                        if (isNaN(precio)) precio = null;
                    }

                    return {
                        ...producto,
                        precio: precio,
                        stock: precioInfo.stock || 0,
                        fechaActualizada: precioInfo.fechaActualizada || '',
                        estado: precioInfo.estado || 'Desconocido',
                        etiqueta: precioInfo.etiqueta || '',
                        hasPrice: precio !== null && precio > 0 // Nueva propiedad para fácil filtrado
                    };
                });
                
                // Inicializar asesores
                asesoresDisponibles = [...asesoresData];
                asesoresUsados = [];
                todosLosAsesores = [...asesoresData];
                
                // Buscar el producto actual
                currentProduct = allProducts.find(p => p.codigo === productCode);
                
                if (!currentProduct) {
                    window.location.href = 'producto.html';
                    return;
                }
                
                displayProductDetail(currentProduct);
                displayRelatedProducts(currentProduct);
                setupEventListeners(currentProduct);
                setup3DViewer(currentProduct);
                setupWhatsappButton(currentProduct);
                setupDownloadModals();
                
            } catch (error) {
                console.error('Error:', error);
                window.location.href = 'producto.html';
            }
        }
        
        // Mostrar detalle del producto
        function displayProductDetail(product) {
            const container = document.getElementById('product-detail-container');
            
            // Determinar el estado del stock
            let stockStatusClass, stockStatusText;
            if (product.stock <= 0) {
                stockStatusClass = "out-of-stock";
                stockStatusText = "AGOTADO";
                product.estado = "Agotado";
            } else if (product.stock < 10) {
                stockStatusClass = "low-stock";
                stockStatusText = `STOCK BAJO`;
                product.estado = "Stock bajo";
            } else {
                stockStatusClass = "in-stock";
                stockStatusText = `DISPONIBLE`;
                product.estado = "Disponible";
            }
            
            // Determinar qué mostrar en el precio
            let priceContent;
            if (product.hasPrice) {
                priceContent = `
                    <div class="product-price">S/. ${product.precio.toFixed(2)} x ${product.unidadMedida}<p style="font-size: 10px;">Incluido IGV</p></div>
                `;
            } else {
                priceContent = `
                    <p class="no-price-text">Precio bajo consulta</p>
                    <button class="request-price-btn" id="requestPriceBtn" ${product.stock <= 0 ? 'disabled' : ''}>
                        <i class="fas fa-envelope"></i> Solicitar precio
                    </button>
                `;
            }
            
            // Botones para descargas con modales
            const fichaTecnicaBtn = product.fichaTecnica !== "No disponible" ? `
                <button class="btn" id="techSpecBtn" style="margin-top: 20px;">
                    <i class="fas fa-download"></i> Descargar ficha técnica
                </button>
            ` : '';

            const hojaSeguridad = product.fichaSeguridad !== "No disponible" ? `
                <button class="btn" id="safetySpecBtn" style="margin-top: 20px;">
                    <i class="fas fa-download"></i> Descargar hoja de seguridad
                </button>
            ` : '';
            
            container.innerHTML = `
                <div class="product-gallery" id="product-gallery">
                    <div class="thumbnail-list" id="thumbnail-list"></div>
                    ${product.portada ? `
                        <img data-src="${product.portada}" class="main-image" id="main-image" loading="lazy" 
                             onerror="handleImageError(this, true)">
                    ` : ''}
                </div>
                
                <div class="product-info">
                    <h1 class="product-title">${product.familia}</h1>
                    <h2 class="product-subtitle">${product.material} ${product.acabado}</h2>
                                        
                    <div class="stock-status ${stockStatusClass}">${stockStatusText}</div>
                    
                    <div class="product-stock-info">
                        <span class="stock-amount">Stock: ${product.stock} ${product.unidadMedida || 'unidades'}</span>
                        <span class="stock-date">Actualizado: ${product.fechaActualizada}</span>
                    </div>
                    
                    ${priceContent}
                    
                    <div class="product-actions">
                        <button class="action-btn favorite-btn" id="favorite-btn" data-code="${product.codigo}">
                            <i class="fas fa-heart"></i> Favorito
                        </button>
                        <button class="action-btn quote-btn" id="quote-btn" data-code="${product.codigo}" ${product.stock <= 0 ? 'disabled' : ''}>
                            <i class="fas fa-file-alt"></i> ${product.stock <= 0 ? 'Producto Agotado' : 'Cotizar'}
                        </button>
                    </div>
                    
                    <div class="tech-specs">
                        <h3>Especificaciones</h3>
                        <ul class="specs-list">
                            <li>Código: ${product.codigo}</li>
                            <li>Familia: ${product.familia}</li>
                            <li>Material: ${product.material}</li>
                            <li>Acabado: ${product.acabado}</li>
                            <li>Medida: ${product.medida}</li>
                            <li>Borde: ${product.borde}</li>
                            <li>Calidad: ${product.calidad}</li>
                            <li>Unidad de medida: ${product.unidadMedida || 'No especificada'}</li>
                            ${product.especificaciones ? `<li>Especificaciones adicionales: ${product.especificaciones}</li>` : ''}
                        </ul>
                    </div>
                    
                    ${fichaTecnicaBtn}

                    ${hojaSeguridad}
                </div>
            `;
            
            // Generar miniaturas después de que el contenedor exista
            generateThumbnails(product);
            
            // Activar lazy loading para las imágenes
            lazyLoadImages();
            
            // Verificar si no hay imágenes para mostrar
            if (!product.portada && (!product.muestra || product.muestra.length === 0)) {
                showNoImagesMessage();
            }
        }

        // Generar miniaturas para la galería
        function generateThumbnails(product) {
            const thumbnailList = document.getElementById('thumbnail-list');
            
            if (!thumbnailList) return;
            
            let thumbnailsHTML = '';
            
            if (product.muestra && product.muestra.length > 0) {
                product.muestra.forEach((img, index) => {
                    thumbnailsHTML += `
                        <img data-src="${img}" class="thumbnail ${index === 0 ? 'active' : ''}" 
                             loading="lazy" onclick="changeMainImage('${img}', this)"
                             onerror="handleImageError(this, false)">
                    `;
                });
            } else if (product.portada) {
                thumbnailsHTML = `
                    <img data-src="${product.portada}" class="thumbnail active" 
                         loading="lazy" onclick="changeMainImage('${product.portada}', this)"
                         onerror="handleImageError(this, false)">
                `;
            }
            
            thumbnailList.innerHTML = thumbnailsHTML;
            
            // Si no hay miniaturas, ocultar el contenedor
            if (thumbnailsHTML === '') {
                thumbnailList.style.display = 'none';
                const gallery = document.querySelector('.product-gallery');
                if (gallery) {
                    gallery.style.gridTemplateColumns = '1fr';
                }
            }
        }

        // Cambiar imagen principal
        function changeMainImage(src, element) {
            const mainImage = document.getElementById('main-image');
            if (!mainImage) return;
            
            // Si ya está cargada diferida
            if (mainImage.dataset.src) {
                mainImage.src = src;
                mainImage.removeAttribute('data-src');
            } else {
                mainImage.src = src;
            }
            
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('active');
            });
            element.classList.add('active');
        }

        // Mostrar productos relacionados
        function displayRelatedProducts(currentProduct) {
            const relatedContainer = document.getElementById('related-products-grid');
            
            // Obtener productos de la misma familia (excluyendo el actual)
            let relatedProducts = allProducts.filter(p => 
                p.familia === currentProduct.familia && p.codigo !== currentProduct.codigo
            );
            
            // Si no hay suficientes productos relacionados (menos de 6), complementar con productos aleatorios
            if (relatedProducts.length < 6) {
                const remaining = 6 - relatedProducts.length;
                const randomProducts = allProducts
                    .filter(p => 
                        p.familia !== currentProduct.familia && 
                        p.codigo !== currentProduct.codigo
                    )
                    .sort(() => 0.5 - Math.random())
                    .slice(0, remaining);
                
                relatedProducts = [...relatedProducts, ...randomProducts];
            }
            
            // Limitar a 6 productos
            relatedProducts = relatedProducts.slice(0, 6);
            
            // Mostrar mensaje si no hay productos relacionados
            if (relatedProducts.length === 0) {
                relatedContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No hay productos relacionados disponibles</p>';
                return;
            }
            
            // Obtener favoritos y cotizaciones
            let favorites = JSON.parse(localStorage.getItem('favorito-outlet')) || [];
            let quotes = JSON.parse(localStorage.getItem('cotizacion-outlet')) || [];
            
            // Mostrar productos relacionados
            relatedContainer.innerHTML = relatedProducts.map(product => {
                const isFavorite = favorites.includes(product.codigo);
                const isInQuote = quotes.includes(product.codigo);
                const isOutOfStock = product.stock <= 0;
                
                // Determinar el estado basado en el stock
                let estado = product.estado;
                if (product.stock <= 0) {
                    estado = 'Agotado';
                } else if (product.stock < 10) {
                    estado = 'Stock bajo';
                }
                
                // Clase para la etiqueta (badge)
                const badgeClass = product.etiqueta ? `badge-${product.etiqueta.replace(/\s+/g, '-')}` : '';
                
                // Determinar qué mostrar en el precio
                let priceContent;
                if (product.hasPrice) {
                    priceContent = `
                        <span class="product-price-card">S/. ${product.precio.toFixed(2)} x ${product.unidadMedida}<p style="font-size: 10px;">Incluido IGV</p></span>
                    `;
                } else {
                    priceContent = `
                        <div class="price-contact-card">
                            <span class="no-price-card">Precio bajo consulta</span>
                            <button class="contact-btn-card" data-code="${product.codigo}" ${isOutOfStock ? 'disabled' : ''}>
                                <i class="fas fa-envelope"></i><span>Solicitar precio</span>
                            </button>
                        </div>
                    `;
                }
                
                // Manejar imágenes para productos relacionados
                const hasImage = product.portada || (product.muestra && product.muestra.length > 0);
                const imageContent = hasImage ? 
                    `<img data-src="${product.portada}" alt="${product.material}" onerror="this.parentNode.innerHTML='<div class=\'no-image-placeholder\'><i class=\'fas fa-image\'></i></div>'">` :
                    `<div class="no-image-placeholder"><i class="fas fa-image"></i></div>`;
                
                return `
                    <div class="product-card">
                        <div class="product-image">
                            ${imageContent}
                            ${product.etiqueta ? `<span class="product-badge ${badgeClass}">${product.etiqueta}</span>` : ''}
                            <span class="product-status status-${estado.replace(/\s+/g, '-')}">${estado}</span>
                        </div>
                        <div class="product-info-card">
                            <h3 class="product-title-card">${product.familia}</h3>
                            <p class="product-material-card">${product.material} ${product.acabado}</p>
                            
                            <div class="product-specs">
                                <span class="spec-item">${product.medida}</span>
                                <span class="spec-item">${product.borde}</span>
                                <span class="spec-item">${product.calidad}</span>
                            </div>
                            
                            <div class="product-stock-card">
                                <span class="stock-amount-card">Stock: ${product.stock} ${product.unidadMedida || 'unid.'}</span>
                                <span class="stock-date-card">${product.fechaActualizada}</span>
                            </div>
                            
                            <div class="product-footer">
                                ${priceContent}
                                <div class="product-actions-card">
                                    <button class="action-btn-card favorite-btn-card ${isFavorite ? 'active' : ''}" data-code="${product.codigo}">
                                        <i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>
                                    </button>
                                    <button class="action-btn-card quote-btn-card ${isInQuote ? 'active' : ''}" data-code="${product.codigo}" ${isOutOfStock ? 'disabled' : ''}>
                                        <i class="fas fa-file-alt"></i>
                                    </button>
                                    <button class="action-btn-card share-btn-card" data-code="${product.codigo}">
                                        <i class="fab fa-whatsapp"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <a href="detalle.html?codigo=${product.codigo}" class="details-btn">Ver detalles</a>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Configurar event listeners para los botones de los productos relacionados
            setupRelatedProductsEventListeners();
            
            // Activar lazy loading para las imágenes
            lazyLoadImages();
        }
        
        // Configurar el visor 3D
        function setup3DViewer(product) {
            const view3dBtn = document.getElementById('view3dBtn');
            const modal3d = document.getElementById('modal3d');
            const modalImage = document.getElementById('modalImage');
            const closeModal = document.getElementById('closeModal');
            const prevImage = document.getElementById('prevImage');
            const nextImage = document.getElementById('nextImage');
            const imageCounter = document.getElementById('imageCounter');
            
            // Verificar si el producto tiene imágenes 3D
            if (product.veta && product.veta.length > 1) {
                current3DImages = product.veta;
                view3dBtn.style.display = 'flex';
                
                // Mostrar el botón flotante
                view3dBtn.addEventListener('click', () => {
                    currentImageIndex = 0;
                    show3DImage();
                    modal3d.classList.add('active');
                });
                
                // Cerrar modal
                closeModal.addEventListener('click', () => {
                    modal3d.classList.remove('active');
                });
                
                // Navegación entre imágenes
                prevImage.addEventListener('click', () => {
                    currentImageIndex = (currentImageIndex - 1 + current3DImages.length) % current3DImages.length;
                    show3DImage();
                });
                
                nextImage.addEventListener('click', () => {
                    currentImageIndex = (currentImageIndex + 1) % current3DImages.length;
                    show3DImage();
                });
                
                // Cerrar al hacer clic fuera de la imagen
                modal3d.addEventListener('click', (e) => {
                    if (e.target === modal3d) {
                        modal3d.classList.remove('active');
                    }
                });
                
                // Navegación con teclado
                document.addEventListener('keydown', (e) => {
                    if (modal3d.classList.contains('active')) {
                        if (e.key === 'ArrowLeft') {
                            currentImageIndex = (currentImageIndex - 1 + current3DImages.length) % current3DImages.length;
                            show3DImage();
                        } else if (e.key === 'ArrowRight') {
                            currentImageIndex = (currentImageIndex + 1) % current3DImages.length;
                            show3DImage();
                        } else if (e.key === 'Escape') {
                            modal3d.classList.remove('active');
                        }
                    }
                });
            } else {
                view3dBtn.style.display = 'none';
            }
            
            function show3DImage() {
                modalImage.src = current3DImages[currentImageIndex];
                imageCounter.textContent = `${currentImageIndex + 1} / ${current3DImages.length}`;
            }
        }

        // Configurar botón flotante de WhatsApp
        function setupWhatsappButton(product) {
            const whatsappFloatBtn = document.getElementById('whatsappFloatBtn');
            const whatsappModal = document.getElementById('whatsappModalRelated');
            const closeWhatsappModal = document.getElementById('closeWhatsappModalRelated');
            const cancelWhatsappShare = document.getElementById('cancelWhatsappShareRelated');
            const confirmWhatsappShare = document.getElementById('confirmWhatsappShareRelated');
            
            whatsappFloatBtn.addEventListener('click', () => {
                currentWhatsappProduct = product;
                whatsappModal.classList.add('active');
            });
            
            closeWhatsappModal.addEventListener('click', () => {
                whatsappModal.classList.remove('active');
            });
            
            cancelWhatsappShare.addEventListener('click', () => {
                whatsappModal.classList.remove('active');
            });
            
            confirmWhatsappShare.addEventListener('click', () => {
                whatsappModal.classList.remove('active');
                shareProductOnWhatsApp(currentWhatsappProduct);
            });
            
            // Cerrar al hacer clic fuera del modal
            whatsappModal.addEventListener('click', (e) => {
                if (e.target === whatsappModal) {
                    whatsappModal.classList.remove('active');
                }
            });
        }

        // Configurar modales para descargas
        function setupDownloadModals() {
            const techSpecBtn = document.getElementById('techSpecBtn');
            const safetySpecBtn = document.getElementById('safetySpecBtn');
            const techSpecModal = document.getElementById('techSpecModal');
            const safetySpecModal = document.getElementById('safetySpecModal');
            
            if (techSpecBtn) {
                techSpecBtn.addEventListener('click', () => {
                    currentDownloadUrl = currentProduct.fichaTecnica;
                    techSpecModal.classList.add('active');
                });
            }
            
            if (safetySpecBtn) {
                safetySpecBtn.addEventListener('click', () => {
                    currentDownloadUrl = currentProduct.fichaSeguridad;
                    safetySpecModal.classList.add('active');
                });
            }
            
            // Configurar eventos para el modal de ficha técnica
            document.getElementById('closeTechSpecModal').addEventListener('click', () => {
                techSpecModal.classList.remove('active');
            });
            
            document.getElementById('cancelTechSpecDownload').addEventListener('click', () => {
                techSpecModal.classList.remove('active');
            });
            
            document.getElementById('confirmTechSpecDownload').addEventListener('click', () => {
                techSpecModal.classList.remove('active');
                downloadFile(currentDownloadUrl);
            });
            
            // Configurar eventos para el modal de ficha de seguridad
            document.getElementById('closeSafetySpecModal').addEventListener('click', () => {
                safetySpecModal.classList.remove('active');
            });
            
            document.getElementById('cancelSafetySpecDownload').addEventListener('click', () => {
                safetySpecModal.classList.remove('active');
            });
            
            document.getElementById('confirmSafetySpecDownload').addEventListener('click', () => {
                safetySpecModal.classList.remove('active');
                downloadFile(currentDownloadUrl);
            });
            
            // Cerrar modales al hacer clic fuera
            techSpecModal.addEventListener('click', (e) => {
                if (e.target === techSpecModal) {
                    techSpecModal.classList.remove('active');
                }
            });
            
            safetySpecModal.addEventListener('click', (e) => {
                if (e.target === safetySpecModal) {
                    safetySpecModal.classList.remove('active');
                }
            });
        }
        
        // Función para descargar archivos
        function downloadFile(url) {
            if (!url) return;
            
            const link = document.createElement('a');
            link.href = url;
            link.download = url.split('/').pop();
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Descarga iniciada', 'success');
        }
        
        // Configurar event listeners
        function setupEventListeners(product) {
            // Botón de favoritos
            const favoriteBtn = document.getElementById('favorite-btn');
            if (favoriteBtn) {
                const favorites = JSON.parse(localStorage.getItem('favorito-outlet')) || [];
                if (favorites.includes(product.codigo)) {
                    favoriteBtn.classList.add('active');
                    favoriteBtn.innerHTML = '<i class="fas fa-heart"></i> En favoritos';
                }
                
                favoriteBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleFavorite(favoriteBtn.dataset.code, favoriteBtn);
                });
            }
            
            // Botón para cotización (solo si no está agotado)
            const quoteBtn = document.getElementById('quote-btn');
            if (quoteBtn && product.stock > 0) {
                const quoteList = JSON.parse(localStorage.getItem('cotizacion-outlet')) || [];
                if (quoteList.includes(product.codigo)) {
                    quoteBtn.classList.add('active');
                    quoteBtn.innerHTML = '<i class="fas fa-check"></i> En cotización';
                }
                
                quoteBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleQuote(quoteBtn.dataset.code, quoteBtn);
                });
            }
            
            // Botón para solicitar precio
            const requestPriceBtn = document.getElementById('requestPriceBtn');
            if (requestPriceBtn) {
                requestPriceBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    // Mostrar modal de selección de tipo de cliente
                    document.getElementById('clientTypeModal').style.display = 'flex';
                });
            }
        }

        // Configurar event listeners para productos relacionados
        function setupRelatedProductsEventListeners() {
            // Botones de favoritos
            document.querySelectorAll('.favorite-btn-card').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const productCode = btn.dataset.code;
                    toggleFavorite(productCode, btn);
                });
            });
            
            // Botones para cotización
            document.querySelectorAll('.quote-btn-card').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Verificar si el producto está agotado
                    const product = allProducts.find(p => p.codigo === btn.dataset.code);
                    if (product && product.stock <= 0) {
                        return;
                    }
                    
                    const productCode = btn.dataset.code;
                    toggleQuote(productCode, btn);
                });
            });
            
            // Botones para compartir por WhatsApp
            document.querySelectorAll('.share-btn-card').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const productCode = btn.dataset.code;
                    const product = allProducts.find(p => p.codigo === productCode);
                    
                    if (product) {
                        currentWhatsappProduct = product;
                        document.getElementById('whatsappModalRelated').classList.add('active');
                    }
                });
            });
            
            // Botones para solicitar precio en productos relacionados
            document.querySelectorAll('.contact-btn-card').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const productCode = btn.dataset.code;
                    const product = allProducts.find(p => p.codigo === productCode);
                    
                    if (product) {
                        // Mostrar modal de selección de tipo de cliente
                        document.getElementById('clientTypeModal').style.display = 'flex';
                        currentProduct = product; // Actualizar el producto actual para el modal
                    }
                });
            });
            
            // Configurar eventos para el modal de WhatsApp de productos relacionados
            const whatsappModalRelated = document.getElementById('whatsappModalRelated');
            const closeWhatsappModalRelated = document.getElementById('closeWhatsappModalRelated');
            const cancelWhatsappShareRelated = document.getElementById('cancelWhatsappShareRelated');
            const confirmWhatsappShareRelated = document.getElementById('confirmWhatsappShareRelated');
            
            closeWhatsappModalRelated.addEventListener('click', () => {
                whatsappModalRelated.classList.remove('active');
            });
            
            cancelWhatsappShareRelated.addEventListener('click', () => {
                whatsappModalRelated.classList.remove('active');
            });
            
            confirmWhatsappShareRelated.addEventListener('click', () => {
                whatsappModalRelated.classList.remove('active');
            });
            
            // Cerrar al hacer clic fuera del modal
            whatsappModalRelated.addEventListener('click', (e) => {
                if (e.target === whatsappModalRelated) {
                    whatsappModalRelated.classList.remove('active');
                }
            });
        }
        
        // Manejar favoritos
        function toggleFavorite(productCode, btn) {
            let favorites = JSON.parse(localStorage.getItem('favorito-outlet')) || [];
            
            if (favorites.includes(productCode)) {
                favorites = favorites.filter(code => code !== productCode);
                if (btn.classList.contains('favorite-btn-card')) {
                    btn.classList.remove('active');
                    btn.innerHTML = '<i class="far fa-heart"></i>';
                } else {
                    btn.classList.remove('active');
                    btn.innerHTML = '<i class="fas fa-heart"></i> Favorito';
                }
                showToast('Producto eliminado de favoritos', 'error');
            } else {
                favorites.push(productCode);
                if (btn.classList.contains('favorite-btn-card')) {
                    btn.classList.add('active');
                    btn.innerHTML = '<i class="fas fa-heart"></i>';
                } else {
                    btn.classList.add('active');
                    btn.innerHTML = '<i class="fas fa-heart"></i> En favoritos';
                }
                showToast('Producto agregado a favoritos', 'success');
            }
            
            localStorage.setItem('favorito-outlet', JSON.stringify(favorites));
        }
        
        // Manejar lista de cotización
        function toggleQuote(productCode, btn) {
            let quoteList = JSON.parse(localStorage.getItem('cotizacion-outlet')) || [];
            
            if (quoteList.includes(productCode)) {
                quoteList = quoteList.filter(code => code !== productCode);
                if (btn.classList.contains('quote-btn-card')) {
                    btn.classList.remove('active');
                    btn.innerHTML = '<i class="fas fa-file-alt"></i>';
                } else {
                    btn.classList.remove('active');
                    btn.innerHTML = '<i class="fas fa-file-alt"></i> Cotizar';
                }
                showToast('Producto eliminado de la cotización', 'error');
            } else {
                quoteList.push(productCode);
                if (btn.classList.contains('quote-btn-card')) {
                    btn.classList.add('active');
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                } else {
                    btn.classList.add('active');
                    btn.innerHTML = '<i class="fas fa-check"></i> En cotización';
                }
                showToast('Producto agregado a cotización', 'success');
            }
            
            localStorage.setItem('cotizacion-outlet', JSON.stringify(quoteList));
        }

        // Compartir producto por WhatsApp
        function shareProductOnWhatsApp(product) {
            const message = `¡Descubre este producto destacado!\n\n*${product.familia} - ${product.material} ${product.acabado}*\n\n` +
                            `*Código:* ${product.codigo}\n` +
                            `*Medida:* ${product.medida}\n` +
                            `*Borde:* ${product.borde}\n` +
                            `*Calidad:* ${product.calidad}\n` +
                            `*Stock:* ${product.stock} ${product.unidadMedida || 'unidades'} (Actualizado: ${product.fechaActualizada})\n` +
                            `${product.hasPrice ? `*Precio:* S/. ${product.precio.toFixed(2)}\n\n` : '*Precio:* Bajo consulta\n\n'}` +
                            `Conoce más detalles aquí: ${window.location.origin}/HTML/detalle.html?codigo=${product.codigo}`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            showToast('Producto compartido con éxito');
        }

        // Obtener asesor aleatorio
        function getAsesorAleatorio() {
            if (asesoresDisponibles.length === 0) {
                resetAsesoresDisponibles();
            }
            
            if (asesoresDisponibles.length === 1) {
                const asesor = asesoresDisponibles[0];
                asesoresUsados.push(asesor);
                asesoresDisponibles = [];
                return asesor;
            }
            
            if (asesoresDisponibles.length >= 2) {
                const index1 = Math.floor(Math.random() * asesoresDisponibles.length);
                let index2;
                do {
                    index2 = Math.floor(Math.random() * asesoresDisponibles.length);
                } while (index2 === index1);
                
                const selectedIndex = Math.random() < 0.5 ? index1 : index2;
                const asesor = asesoresDisponibles[selectedIndex];
                asesoresUsados.push(asesor);
                asesoresDisponibles.splice(selectedIndex, 1);
                return asesor;
            }
            
            return null;
        }
        
        // Resetear lista de asesores disponibles
        function resetAsesoresDisponibles() {
            asesoresDisponibles = [...asesoresUsados];
            asesoresUsados = [];
        }

        // Mostrar modal de WhatsApp para nuevos clientes
        function showWhatsappModalNewClient(product) {
            const modal = document.getElementById('whatsappModalNewClient');
            const asesorContainer = document.getElementById('asesorAleatorioContainer');
            const asesor = getAsesorAleatorio();
            
            // Limpiar lista de asesores
            asesorContainer.innerHTML = '';
            
            if (asesor) {
                // Crear mensaje predeterminado para solicitud de precio
                const message = `Hola ${asesor.nombre}, me interesa el siguiente producto:\n\n` +
                                `*Código:* ${product.codigo}\n` +
                                `*Familia:* ${product.familia}\n` +
                                `*Material:* ${product.material}\n` +
                                `*Acabado:* ${product.acabado}\n` +
                                `*Medidas:* ${product.medida}\n` +
                                `*Borde:* ${product.borde}\n` +        
                                `*Calidad:* ${product.calidad}\n\n` +                               
                                `Por favor, necesito información sobre el precio y stock disponible.`;
                
                const asesorItem = document.createElement('div');
                asesorItem.className = 'asesor-card';
                
                asesorItem.innerHTML = `
                    <div class="asesor-avatar">
                        <img src="${asesor.foto || '../../FOTOS/ASESORES/Hombre.webp'}" alt="${asesor.nombre}">
                    </div>
                    <div class="asesor-info">
                        <div class="asesor-name">${asesor.nombre} ${asesor.apellidos}</div>
                        <div class="asesor-phone">${asesor.celular}</div>
                        <div class="asesor-specialty">${asesor.especialidad || 'Asesor General'}</div>
                        <button class="btn-contact" data-phone="${asesor.celular}" data-message="${encodeURIComponent(message)}">
                            <i class="fab fa-whatsapp"></i> Contactar por WhatsApp
                        </button>
                    </div>
                `;
                asesorContainer.appendChild(asesorItem);
                
                const whatsappBtn = asesorItem.querySelector('.btn-contact');
                whatsappBtn.addEventListener('click', () => {
                    const phone = whatsappBtn.dataset.phone;
                    const message = decodeURIComponent(whatsappBtn.dataset.message);
                    const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
                    window.open(whatsappUrl, '_blank');
                    modal.style.display = 'none';
                });
            } else {
                // Mostrar mensaje si no hay asesores
                asesorContainer.innerHTML = `
                    <div class="error-container">
                        <div class="error-content">
                            <div class="error-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <h3 class="error-title">¡Error al cargar los asesores!</h3>
                            <p class="error-description">No hay asesores disponibles en este momento. Por favor, inténtalo más tarde.</p>
                            <p class="error-contact">Si el problema persiste, contáctanos: 
                                <a href="mailto:soporte@gallosmarmol.com.pe" class="error-link">
                                    <i class="fas fa-envelope"></i> soporte@gallosmarmol.com.pe
                                </a>
                            </p>
                        </div>
                    </div>
                `;
            }
            
            // Mostrar el modal
            modal.style.display = 'flex';
            
            // Configurar botón de cancelar
            document.getElementById('cancelWhatsappNew').addEventListener('click', () => {
                modal.style.display = 'none';
            });
            
            // Cerrar al hacer clic fuera del modal
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Mostrar modal de WhatsApp para clientes existentes
        function showWhatsappModalExistingClient(product) {
            const modal = document.getElementById('whatsappModalExistingClient');
            const asesoresContainer = document.getElementById('asesoresListContainer');
            const searchInput = document.getElementById('searchAsesorInput');
            const content = modal.querySelector('.whatsapp-content-existing');
            
            // Resetear campo de búsqueda
            searchInput.value = '';

            // Resetear el scroll al abrir
            modal.style.display = 'flex';
            setTimeout(() => {
                searchInput.focus();
                content.scrollTop = 0; // Forzar scroll al inicio
            }, 10);            

            // Limpiar lista de asesores
            asesoresContainer.innerHTML = '';
            
            if (todosLosAsesores.length > 0) {
                // Mostrar todos los asesores disponibles
                todosLosAsesores.forEach(asesor => {
                    // Crear mensaje predeterminado para solicitud de precio
                    const message = `Hola ${asesor.nombre}, me interesa el siguiente producto:\n\n` +
                                    `*Código:* ${product.codigo}\n` +
                                    `*Familia:* ${product.familia}\n` +
                                    `*Material:* ${product.material}\n` +
                                    `*Acabado:* ${product.acabado}\n` +
                                    `*Medidas:* ${product.medida}\n` +
                                    `*Borde:* ${product.borde}\n` +        
                                    `*Calidad:* ${product.calidad}\n\n` +                               
                                    `Por favor, necesito información sobre el precio y stock disponible.`;
                    
                    const asesorItem = document.createElement('div');
                    asesorItem.className = 'asesor-card';
                    
                    asesorItem.innerHTML = `
                        <div class="asesor-avatar">
                            <img src="${asesor.foto || '../../FOTOS/ASESORES/Hombre.webp'}" alt="${asesor.nombre}">
                        </div>
                        <div class="asesor-info">
                            <div class="asesor-name">${asesor.nombre} ${asesor.apellidos}</div>
                            <div class="asesor-phone">${asesor.celular}</div>
                            <div class="asesor-specialty">${asesor.especialidad || 'Asesor General'}</div>
                            <button class="btn-contact" data-phone="${asesor.celular}" data-message="${encodeURIComponent(message)}">
                                <i class="fab fa-whatsapp"></i> Contactar por WhatsApp
                            </button>
                        </div>
                    `;
                    asesoresContainer.appendChild(asesorItem);
                    
                    const whatsappBtn = asesorItem.querySelector('.btn-contact');
                    whatsappBtn.addEventListener('click', () => {
                        const phone = whatsappBtn.dataset.phone;
                        const message = decodeURIComponent(whatsappBtn.dataset.message);
                        const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
                        window.open(whatsappUrl, '_blank');
                        modal.style.display = 'none';
                    });
                });
                
                // Configurar búsqueda de asesores
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const asesorCards = document.querySelectorAll('.asesor-card');
                    
                    asesorCards.forEach(card => {
                        const name = card.querySelector('.asesor-name').textContent.toLowerCase();
                        const specialty = card.querySelector('.asesor-specialty').textContent.toLowerCase();
                        
                        if (name.includes(searchTerm) || specialty.includes(searchTerm)) {
                            card.style.display = 'flex';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            } else {
                // Mostrar mensaje si no hay asesores
                asesoresContainer.innerHTML = `
                    <div class="error-container">
                        <div class="error-content">
                            <div class="error-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <h3 class="error-title">¡Error al cargar los asesores!</h3>
                            <p class="error-description">No hay asesores disponibles en este momento. Por favor, inténtalo más tarde.</p>
                            <p class="error-contact">Si el problema persiste, contáctanos: 
                                <a href="mailto:soporte@gallosmarmol.com.pe" class="error-link">
                                    <i class="fas fa-envelope"></i> soporte@gallosmarmol.com.pe
                                </a>
                            </p>
                        </div>
                    </div>
                `;
            }
            
            // Mostrar el modal
            modal.style.display = 'flex';
            
            // Configurar botón de cancelar
            document.getElementById('cancelWhatsappExisting').addEventListener('click', () => {
                modal.style.display = 'none';
            });
            
            // Cerrar al hacer clic fuera del modal
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Configurar eventos para los modales de selección de cliente
        function setupClientTypeModalListeners() {
            const clientTypeModal = document.getElementById('clientTypeModal');
            const existingClientBtn = document.getElementById('existingClientBtn');
            const newClientBtn = document.getElementById('newClientBtn');
            
            // Botón para clientes existentes
            existingClientBtn.addEventListener('click', () => {
                clientTypeModal.style.display = 'none';
                showWhatsappModalExistingClient(currentProduct);
            });
            
            // Botón para nuevos clientes
            newClientBtn.addEventListener('click', () => {
                clientTypeModal.style.display = 'none';
                showWhatsappModalNewClient(currentProduct);
            });
            
            // Cerrar modal al hacer clic fuera
            clientTypeModal.addEventListener('click', (e) => {
                if (e.target === clientTypeModal) {
                    clientTypeModal.style.display = 'none';
                }
            });
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            loadProductDetail();
            setupClientTypeModalListeners();
        });
        
        // Hacer las funciones accesibles globalmente
        window.changeMainImage = changeMainImage;
        window.handleImageError = handleImageError;
    </script>
</body>
</html>